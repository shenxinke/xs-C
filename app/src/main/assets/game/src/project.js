require=function i(s,a,c){function l(n,e){if(!a[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(u)return u(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var r=a[n]={exports:{}};s[n][0].call(r.exports,function(e){var t=s[n][1][e];return l(t||e)},r,r.exports,i,s,a,c)}return a[n].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({AStarFinder:[function(e,t,n){"use strict";cc._RF.push(t,"3692bwQwU5P6rlmf79WhPPN","AStarFinder"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../PathFindingDef"),I=e("../../Algorithm/Heap"),r=function(){function e(e){this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||o.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=o.DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=o.DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=o.DiagonalMovement.Never),this.diagonalMovement===o.DiagonalMovement.Never?this.heuristic=e.heuristic||o.manhattan:this.heuristic=e.heuristic||o.octile}return e.prototype.findPath=function(e,t,n,o,r){var i,s,a,c,l,u,h,p,d=new I.default(function(e,t){return e.f-t.f}),m=r.getNodeAt(e,t),f=r.getNodeAt(n,o),y=this.heuristic,g=this.diagonalMovement,C=this.weight,_=Math.abs,v=Math.SQRT2;for(m.g=0,m.f=0,d.push(m),m.opened=!0;!d.empty();){if((i=d.pop()).closed=!0,i===f)return this.backtrace(f);for(c=0,l=(s=r.getNeighbors(i,g)).length;c<l;++c)(a=s[c]).closed||(u=a.x,h=a.y,p=i.g+(u-i.x==0||h-i.y==0?1:v),(!a.opened||p<a.g)&&(a.g=p,a.h=a.h||C*y(_(u-n),_(h-o)),a.f=a.g+a.h,a.parent=i,a.opened?d.updateItem(a):(d.push(a),a.opened=!0)))}return[]},e.prototype.findPathInBlackAndBlock=function(e,t,n,o,r){var i,s,a,c,l,u,h,p,d=new I.default(function(e,t){return e.f-t.f}),m=r.getNodeAt(e,t),f=r.getNodeAt(n,o),y=this.heuristic,g=this.diagonalMovement,C=this.weight,_=Math.abs,v=Math.SQRT2;for(m.g=0,m.f=0,d.push(m),m.opened=!0;!d.empty();){if((i=d.pop()).closed=!0,i===f)return this.backtrace(f);for(c=0,l=(s=r.getNeighborsIncludeDiagonal(i,g)).length;c<l;++c)(a=s[c]).closed||(u=a.x,h=a.y,p=i.g+(u-i.x==0||h-i.y==0?1:v),(!a.opened||p<a.g)&&(a.g=p,a.h=a.h||C*y(_(u-n),_(h-o)),a.f=a.g+a.h,a.parent=i,a.opened?d.updateItem(a):(d.push(a),a.opened=!0)))}return[]},e.prototype.backtrace=function(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()},e}();n.default=r,cc._RF.pop()},{"../../Algorithm/Heap":"Heap","../../PathFindingDef":"PathFindingDef"}],AchievementPage:[function(e,t,n){"use strict";cc._RF.push(t,"f8ad5IKtv1I0430jvTOXceA","AchievementPage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../GameGlobal"),r=e("../../Common/CommonDef"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.achievements=new Array,e.isShowPrompt=!1,e.onShowPrompt=null,e}return __extends(e,t),e.prototype.onLoad=function(){o.default.getGlobal().localPlayer.AddObserverList(this.node),this.node.on(r.OnGotAchievementKey,this.OnGotAchievement,this)},e.prototype.start=function(){},e.prototype.onEnable=function(){this.achievements&&0<this.achievements.length&&this.achievements.forEach(function(e){e.node.scale=0})},e.prototype.onDestroy=function(){o.default.getGlobal().localPlayer.RemoveObserverList(this.node),this.achievements&&0<this.achievements.length&&this.achievements.forEach(function(e){})},e.prototype.OnGotAchievement=function(e){cc.log("OnGotAchievement");var t=Number.parseInt(e.detail);cc.log("chapterID:"+t),this.SetPrompt(this.achievements[t-1])},e.prototype.SetPrompt=function(e){var t=this;if(!this.isShowPrompt&&e){this.isShowPrompt=!0;var n=cc.delayTime(1),o=cc.scaleTo(.25,1),r=cc.scaleTo(.25,0);this.onShowPrompt=cc.sequence(o,n,r,cc.callFunc(function(){t.isShowPrompt=!1})),e.node.runAction(this.onShowPrompt)}},__decorate([a({type:[cc.Sprite]})],e.prototype,"achievements",void 0),e=__decorate([s,c("Game/UI/Page/AchievementPage")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal"}],AimAIPrefer:[function(e,t,n){"use strict";cc._RF.push(t,"9f096qXWZxP/4MAcTqGEML5","AimAIPrefer"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../Common/CommonDef"),u=e("../../../Common/CommonDef"),o=e("../ChessBoard"),i=cc._decorator,s=i.ccclass,a=(i.property,i.menu),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e.mOptionalDir=null,e.mDestIndex=null,e.mAimPoint=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mChessBoard=this.getComponentInChildren(o.default),this.mOptionalDir=r.OPTIONAL_DIR},e.prototype.start=function(){},e.prototype.httpServerSetpChess=function(){},e.prototype.httpServerTakeoutChess=function(){},e.prototype.getMapFlagCount=function(){},e.prototype.initData=function(){for(var e=1e7,t=0,n=0,o=0,r=0;r<this.mChessBoard.blackChess.length;r++)for(var i=this.mChessBoard.blackChess[r],s=0;s<this.mChessBoard.destChess.length;s++){var a=this.mChessBoard.destChess[s],c=Math.abs(a.unit.index.x-i.unit.index.x),l=Math.abs(a.unit.index.y-i.unit.index.y);(m=Math.sqrt(Math.pow(c,2)+Math.pow(l,2)))<e&&(e=m,t=s,n=r)}this.mDestIndex=t;var u=this.mChessBoard.destChess[t],h=this.mChessBoard.blackChess[n],p=1e6;for(o=0,s=0;s<this.mChessBoard.whiteChess.length;s++){var d=this.mChessBoard.whiteChess[s],m=(c=Math.abs(u.unit.index.x-d.unit.index.x),l=Math.abs(u.unit.index.y-d.unit.index.y),Math.sqrt(Math.pow(c,2)+Math.pow(l,2))),f=this.qi(d.unit);m<p&&0<f.length&&(p=m,o=s)}var y=this.mChessBoard.whiteChess[o],g=this.PointToLineDistance(y.unit.index.x,y.unit.index.y,u.unit.index.x,u.unit.index.y,h.unit.index.x,h.unit.index.y);g&&(this.mAimPoint=new cc.Vec2(Math.round(g.x),Math.round(g.y)))},e.prototype.trySplit=function(){var e=this.orderedWhiteChess();if(!(e&&0<e.length)){var t=this.mChessBoard.canPassIndexes(r.UnitType.UNIT_TYPE_WHITE);return 0<t.length?{chess:null,index:t[Math.floor(Math.random()*t.length)]}:void 0}var n=e[this.setOptionalDir()],o=this.qi(n.unit);if(0<o.length)return null!=this.mChessBoard.getUnits(this.mAimPoint)&&(this.mAimPoint=this.mChessBoard.destChess[this.mDestIndex].unit.index),{chess:n,index:cc.pAdd(n.unit.index,o[0])}},e.prototype.setOptionalDir=function(){for(var e=0,t=1e6,n=0;n<this.mChessBoard.whiteChess.length;n++){var o=this.mChessBoard.whiteChess[n],r=Math.abs(this.mAimPoint.x-o.unit.index.x),i=Math.abs(this.mAimPoint.y-o.unit.index.y),s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)),a=this.qi(o.unit);s<t&&0<a.length&&(t=s,e=n)}var c=this.mChessBoard.whiteChess[e],l=this.getAngle(c.unit.index,this.mAimPoint);return 180<l&&l<360?l-=180:l<180&&0<l&&(l+=180),0<=l&&l<=45?this.mOptionalDir=u.OPTIONAL_DIR_1:45<=l&&l<=90?this.mOptionalDir=u.OPTIONAL_DIR_2:90<=l&&l<=135?this.mOptionalDir=u.OPTIONAL_DIR_3:135<=l&&l<=180?this.mOptionalDir=u.OPTIONAL_DIR_4:180<=l&&l<=225?this.mOptionalDir=u.OPTIONAL_DIR_5:225<=l&&l<=270?this.mOptionalDir=u.OPTIONAL_DIR_6:270<=l&&l<=315?this.mOptionalDir=u.OPTIONAL_DIR_7:315<=l&&l<=360&&(this.mOptionalDir=u.OPTIONAL_DIR_8),e},e.prototype.getAngle=function(e,t){var n=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y),r=o/Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),i=Math.asin(r),s=Math.floor(180/(Math.PI/i));return e.x<t.x&&e.y>t.y&&(s=180-s),e.x<t.x&&e.y<t.y&&(s=180+s),e.x>t.x&&e.y<t.y&&(s=360-s),t.x<e.x&&t.y==e.y&&(s=180),t.x==e.x&&e.y>t.y&&(s=90),t.x==e.x&&e.y<t.y&&(s=270),s},e.prototype.post=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.qi=function(t){var n=this;return this.mOptionalDir.filter(function(e){return n.mChessBoard.canPass(t,cc.pAdd(t.index,e))},this)},e.prototype.orderedWhiteChess=function(){return this.mChessBoard.whiteChessOrderedByPutIn},e.prototype.orderedBlackChess=function(){return this.mChessBoard.blackChessOrderedByPutIn},e.prototype.PointLine_Disp=function(e,t,n,o,r,i){var s,a,c,l,u,h,p;return 0==(s=Math.sqrt((n-e)*(n-e)+(o-t)*(o-t)))?-1:0==(a=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t)))?-1:0==(c=Math.sqrt((n-r)*(n-r)+(o-i)*(o-i)))?s:s<a?(o==i?l=n<r?0:Math.PI:(1e-5<(p=(r-n)/c)-1&&(p=1),l=Math.acos(p),i<o&&(l=2*Math.PI-l)),1e-5<(p=(e-n)/s)-1&&(p=1),u=Math.acos(p),t<o&&(u=2*Math.PI-u),(h=u-l)<0&&(h=-h),h>Math.PI&&(h=2*Math.PI-h),h>Math.PI/2?s:s*Math.sin(h)):(o==i?l=n<r?Math.PI:0:(1e-5<(p=(n-r)/c)-1&&(p=1),l=Math.acos(p),o<i&&(l=2*Math.PI-l)),1e-5<(p=(e-r)/a)-1&&(p=1),u=Math.acos(p),t<i&&(u=2*Math.PI-u),(h=u-l)<0&&(h=-h),h>Math.PI&&(h=2*Math.PI-h),h>Math.PI/2?a:a*Math.sin(h))},e.prototype.PointToLineDistance=function(e,t,n,o,r,i){var s,a,c,l,u=Math.sqrt((n-e)*(n-e)+(o-t)*(o-t));if(0===u)return{x:n,y:o};var h=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t));if(0===h)return{x:r,y:i};var p=Math.sqrt((n-r)*(n-r)+(o-i)*(o-i));if(0===p)return{x:n,y:o};if(u<h){if(o===i?s=n<r?0:Math.PI:(1e-5<(l=(r-n)/p)-1&&(l=1),s=Math.acos(l),i<o&&(s=2*Math.PI-s)),1e-5<(l=(e-n)/u)-1&&(l=1),a=Math.acos(l),t<o&&(a=2*Math.PI-a),(c=a-s)<0&&(c=-c),c>Math.PI&&(c=2*Math.PI-c),c>Math.PI/2)return{x:n,y:o};if(n===r)return{x:n,y:t};if(o===i)return{x:e,y:o};var d,m=(i-o)/r-n,f=-1/m,y=t-e*f;return{x:d=(i-r*m-y)/(f-m),y:f*d+y}}if(o===i?s=n<r?Math.PI:0:(1e-5<(l=(n-r)/p)-1&&(l=1),s=Math.acos(l),o<i&&(s=2*Math.PI-s)),1e-5<(l=(e-r)/h)-1&&(l=1),a=Math.acos(l),t<i&&(a=2*Math.PI-a),(c=a-s)<0&&(c=-c),c>Math.PI&&(c=2*Math.PI-c),c>Math.PI/2)return{x:r,y:i};if(n===r)return{x:n,y:t};if(o===i)return{x:e,y:o};var g,C=(i-o)/r-n,_=-1/C,v=t-e*_;return{x:g=(i-r*C-v)/(_-C),y:_*g+v}},e=__decorate([s,a("Game/GameLogic/AI/AimAIPrefer")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../../Common/CommonDef":"CommonDef","../ChessBoard":"ChessBoard"}],AudioEngineManager:[function(e,t,n){"use strict";cc._RF.push(t,"c702fVU9EBHlKEQOXNFrW4U","AudioEngineManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Common/CommonDef"),r=e("../GameGlobal"),i=cc._decorator,s=i.ccclass,a=(i.property,i.menu),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.musicVolume=0,e.soundVolume=0,e.backgroundMusicId=-1,e.gameMusicId=-1,e.sceneSoundId=-1,e.backgroundMusic=null,e.gameMusic=null,e.buttonSound=null,e.closeButtonSound=null,e.returnButtonSound=null,e.confirmButtonSound=null,e.deliveryUpSound=null,e.deliveryDownSound=null,e.startGameSound=null,e.whiteButtonSound=null,e.blackButtonSound=null,e.winSound=null,e.loseSound=null,e.sceneSound1=null,e.sceneSound2=null,e.sceneSound3=null,e.sceneSound4=null,e.sceneSound5=null,e.sceneSound6=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.musicVolume=Number.parseFloat(null==cc.sys.localStorage.getItem(o.MusicVolumeKey)?1:cc.sys.localStorage.getItem(o.MusicVolumeKey)),this.soundVolume=Number.parseFloat(null==cc.sys.localStorage.getItem(o.SoundVolumeKey)?1:cc.sys.localStorage.getItem(o.SoundVolumeKey))},e.prototype.LoadBGMusic=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return this.backgroundMusic||cc.loader.loadRes("Audio/Music/BGMusic",function(e,t){n.backgroundMusic=t}),[2]})})},e.prototype.LoadGameMusic=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return this.gameMusic||cc.loader.loadRes("Audio/Music/TestBattleBGMusic001",function(e,t){n.gameMusic=t}),[2]})})},e.prototype.LoadSound=function(){return __awaiter(this,void 0,void 0,function(){var o=this;return __generator(this,function(e){return this.buttonSound&&this.closeButtonSound&&this.returnButtonSound&&this.confirmButtonSound&&this.startGameSound&&this.deliveryUpSound&&this.deliveryDownSound&&this.whiteButtonSound&&this.blackButtonSound&&this.winSound&&this.loseSound&&this.sceneSound1&&this.sceneSound2&&this.sceneSound3&&this.sceneSound4&&this.sceneSound5&&this.sceneSound6||cc.loader.loadResDir("Audio/Sound",function(e,t){t.forEach(function(e){var t=e;console.log("LoadSound---",t);var n=t.split("/");switch(n[n.length-1].split(".")[0]){case"button":o.buttonSound=e;break;case"close_button":o.closeButtonSound=e;break;case"return_button":o.returnButtonSound=e;break;case"confirm_button":o.confirmButtonSound=e;break;case"delivery_up":o.deliveryUpSound=e;break;case"delivery_down":o.deliveryDownSound=e;break;case"start_game":o.startGameSound=e;break;case"white_button":o.whiteButtonSound=e;break;case"black_button":o.blackButtonSound=e;break;case"win":o.winSound=e;break;case"lose":o.loseSound=e;break;case"scene1_caodi":o.sceneSound1=e;break;case"scene2_senlin":o.sceneSound2=e;break;case"scene3_xueshan":o.sceneSound3=e;break;case"scene4_shamo":o.sceneSound4=e;break;case"scene5_huoshan":o.sceneSound5=e;break;case"scene6_yuzhou":o.sceneSound6=e}})}),[2]})})},e.prototype.CanPlayMusic=function(){return 0<this.musicVolume},e.prototype.CanPlaySound=function(){return 0<this.soundVolume},e.prototype.SetMusicVolume=function(e){this.musicVolume=e,0<=this.backgroundMusicId&&cc.audioEngine.setVolume(this.backgroundMusicId,this.musicVolume),0<=this.gameMusicId&&cc.audioEngine.setVolume(this.gameMusicId,this.musicVolume),cc.sys.localStorage.setItem(o.MusicVolumeKey,this.musicVolume)},e.prototype.SetSoundVolume=function(e){this.soundVolume=e,cc.sys.localStorage.setItem(o.SoundVolumeKey,this.soundVolume)},e.prototype.PlayBackgroundMusic=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.backgroundMusic)},e.prototype.PlayGameMusic=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.gameMusic)},e.prototype.PlayButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.buttonSound)},e.prototype.PlayCloseButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.closeButtonSound)},e.prototype.PlayReturnButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.returnButtonSound)},e.prototype.PlayConfirmButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.confirmButtonSound)},e.prototype.PlayDeliveryUpSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.deliveryUpSound)},e.prototype.PlayDeliveryDownSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.deliveryDownSound)},e.prototype.PlayStartGameSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.startGameSound)},e.prototype.PlayWhiteButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.whiteButtonSound)},e.prototype.PlayBlackButtonSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.blackButtonSound)},e.prototype.PlayWinSound=function(){console.log("this.winSound----",this.winSound),r.default.getGlobal().localPlayer.OnPlayeAudio(this.winSound)},e.prototype.PlayLoseSound=function(){r.default.getGlobal().localPlayer.OnPlayeAudio(this.loseSound)},e.prototype.PlaySceneMusic=function(e){if(this.CanPlaySound()&&-1==this.sceneSoundId&&cc.audioEngine.getState(this.sceneSoundId)!=cc.audioEngine.AudioState.PLAYING)switch(e){case 1:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound1);break;case 2:case 4:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound2);break;case 3:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound3);break;case 5:case 6:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound4);break;case 7:case 8:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound5);break;case 9:r.default.getGlobal().localPlayer.OnPlayeAudio(this.sceneSound6)}},e.prototype.StopSceneMusic=function(){0<=this.sceneSoundId&&(cc.audioEngine.stop(this.sceneSoundId),this.sceneSoundId=-1)},e=__decorate([s,a("Game/AudioEngine")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../Common/CommonDef":"CommonDef","../GameGlobal":"GameGlobal"}],BasePage:[function(e,t,n){"use strict";cc._RF.push(t,"ea11c87CW1FcZrpEfvHRU+e","BasePage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=null,e.promptGold=null,e.promptPower=null,e.promptExperience=null,e.isContentMove=!1,e.isShowPrompt=!1,e.contentDefaultPosition=cc.Vec2.ZERO,e.onPageEnter=null,e.onPageOut=null,e.onShowPrompt=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.content&&(this.contentDefaultPosition=this.content.getPosition())},e.prototype.onEnable=function(){this.content&&(this.content.position=this.contentDefaultPosition),this.isShowPrompt=!1,this.promptGold&&(this.promptGold.node.scale=0),this.promptPower&&(this.promptPower.node.scale=0),this.promptExperience&&(this.promptExperience.node.scale=0),this.PageEnter()},e.prototype.onDisable=function(){this.isShowPrompt=!1,this.promptGold&&(this.promptGold.node.scale=0),this.promptPower&&(this.promptPower.node.scale=0),this.promptExperience&&(this.promptExperience.node.scale=0),this.DestroyBaseActions()},e.prototype.onDestroy=function(){this.DestroyBaseActions()},e.prototype.PageEnter=function(){var e=this;if(this.content&&!this.isContentMove){this.isContentMove=!0;var t=cc.moveTo(.25,cc.Vec2.ZERO);this.onPageEnter=cc.sequence(t,cc.callFunc(function(){e.isContentMove=!1})),this.content.runAction(this.onPageEnter)}},e.prototype.PageOut=function(){var e=this;if(this.content&&!this.isContentMove){this.isContentMove=!0;var t=cc.moveTo(.25,this.contentDefaultPosition);this.onPageOut=cc.sequence(t,cc.callFunc(function(){e.isContentMove=!1,e.node.active=!1})),this.content.runAction(this.onPageOut)}},e.prototype.RegisterPrompt=function(){this.node.on(o.OnPromptKey,this.OnPrompt,this)},e.prototype.OnPrompt=function(e){var t=null;switch(e.getUserData()){case o.PromptType.GoldInsufficient:t=this.promptGold;break;case o.PromptType.PowerInsufficient:t=this.promptPower;break;case o.PromptType.ExperienceInsufficient:t=this.promptExperience}this.SetPrompt(t),e.stopPropagation()},e.prototype.SetPrompt=function(e){var t=this;if(!this.isShowPrompt&&e){this.isShowPrompt=!0;var n=cc.delayTime(1),o=cc.scaleTo(.25,1),r=cc.scaleTo(.25,0);this.onShowPrompt=cc.sequence(o,n,r,cc.callFunc(function(){t.isShowPrompt=!1})),e.node.runAction(this.onShowPrompt)}},e.prototype.DestroyBaseActions=function(){this.promptGold&&this.onShowPrompt,this.promptPower&&this.onShowPrompt,this.promptExperience&&this.onShowPrompt,this.content&&(this.onPageEnter,this.onPageOut)},__decorate([s(cc.Node)],e.prototype,"content",void 0),__decorate([s(cc.Sprite)],e.prototype,"promptGold",void 0),__decorate([s(cc.Sprite)],e.prototype,"promptPower",void 0),__decorate([s(cc.Sprite)],e.prototype,"promptExperience",void 0),e=__decorate([i],e)}(cc.Component);n.default=a,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],BesiegeAIPrefer:[function(e,t,n){"use strict";cc._RF.push(t,"52bfbluP2hEv4Iu2UfQFl1l","BesiegeAIPrefer"),Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../../Common/CommonDef"),o=e("../ChessBoard"),r=e("../../../Common/PathFinding/Finder/AStarFinder"),i=e("./NewestPrefer"),l=e("../../../GameGlobal"),s=cc._decorator,a=s.ccclass,u=(s.property,s.menu),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e.mPathFinder=null,e.mNewestPrefer=null,e.mBorders=new Array,e.allPolygon=new Array,e.mMapFlag=new Array,e.centerPoints=new Array,e}return __extends(e,t),e.prototype.onLoad=function(){this.mChessBoard=this.getComponentInChildren(o.default),this.mNewestPrefer=this.getComponent(i.default),this.mPathFinder=new r.default({allowDiagonal:!0,dontCrossCorners:!1,weight:0})},e.prototype.start=function(){},e.prototype.initData=function(){},e.prototype.post=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.httpServerSetpChess=function(){},e.prototype.httpServerTakeoutChess=function(){},e.prototype.trySplit=function(){var a=this;this.mBorders.splice(0),this.allPolygon.splice(0),this.mMapFlag.splice(0),this.centerPoints.splice(0),this.mChessBoard.blockChess.forEach(function(e){0!=e.unit.index.x&&0!=e.unit.index.y&&8!=e.unit.index.x&&8!=e.unit.index.y||a.mBorders.push(e.unit.index)});for(var e=function(){var t=o.mChessBoard.blackChess[r],e=c.OPTIONAL_DIR_9.filter(function(e){return null!=a.mChessBoard.getUnits(cc.pAdd(t.unit.index,e))},o);e=e.map(function(e){return cc.pAdd(t.unit.index,e)});var s=new cc.Vec2(t.unit.index.x,t.unit.index.y);console.log("savePoint--1111111-",s),0!=t.unit.index.x&&0!=t.unit.index.y&&8!=t.unit.index.x&&8!=t.unit.index.y||(o.mBorders.push(s),console.log("savePoint-22222--",s)),o.mChessBoard.takeOut(t.unit,!0),e.forEach(function(e,t,n){for(var o=t+1;o<n.length;o++){var r=n[o],i=a.mPathFinder.findPathInBlackAndBlock(e.x,e.y,r.x,r.y,a.mChessBoard);0<i.length&&(i.push(new Array(s.x,s.y)),a.allPolygon.push(i)),a.mChessBoard.clearPath()}});var n=l.default.getGlobal().resourceMgr.getBlackChess();o.mChessBoard.addUnit(n,s)},o=this,r=this.mChessBoard.blackChess.length-1;-1<r;r--)e();var i=[];this.mBorders.forEach(function(e,t,n){for(var o=t+1;o<n.length;o++){var r=n[o];(0!=e.x&&8!=e.x||0!=r.y&&8!=r.y)&&(0!=e.y&&8!=e.y||0!=r.x&&8!=r.x)&&e.x!=r.x&&e.y!=r.y||i.push([e,r])}}),i.forEach(function(e){var t=e,n=new cc.Vec2(0,0),o=new cc.Vec2(0,0);n.x=t[0].x,n.y=t[0].y,o.x=t[1].x,o.y=t[1].y;var r=a.mPathFinder.findPathInBlackAndBlock(n.x,n.y,o.x,o.y,a.mChessBoard);if(0<r.length){var i=a.suppleBorderPoint(n,o);if(null!=i){var s=[i.x,i.y];r.push(s),-1==a.centerPoints.findIndex(function(e){return e.x==i.x&&e.y==i.y})&&a.centerPoints.push(i)}a.allPolygon.push(r)}a.mChessBoard.clearPath()}),console.log("allPolygon---",this.allPolygon);for(var t=0;t<9;t++)for(var n=0;n<9;n++){if(null!=this.allPolygon.find(function(e){return"in"==a.rayCasting({x:t,y:n},e)})){var s=new cc.Vec2(t,n);null==this.mChessBoard.getUnits(s)&&this.mMapFlag.push(new cc.Vec2(t,n))}}return console.log("mMapFlag---",this.mMapFlag),this.showMapFlagHandler(),{chess:null,index:cc.v2(0,0)}},e.prototype.showMapFlagHandler=function(){var n=this;this.mMapFlag.forEach(function(e){var t=l.default.getGlobal().resourceMgr.getFlagChess();n.mChessBoard.addUnit(t,e)}),this.centerPoints.forEach(function(e){var t=l.default.getGlobal().resourceMgr.getFlagChess();n.mChessBoard.addUnit(t,e)})},e.prototype.suppleBorderPoint=function(e,t){var n=!1,o=new cc.Vec2(0,0);return e.x==t.x||e.y==t.y?null:(8==e.x||0==e.x?(o.x=e.x,n=!0):8!=e.y&&0!=e.y||(o.y=e.y,n=!0),8==t.x||0==t.x?(o.x=t.x,n=!0):8!=t.y&&0!=t.y||(o.y=t.y,n=!0),n?o:null)},e.prototype.getMapFlagCount=function(){return this.mMapFlag.length+this.centerPoints.length},e.prototype.rayCasting=function(e,t){for(var n=e.x,o=e.y,r=!1,i=0,s=t.length,a=s-1;i<s;a=i,i++){var c=t[i][0],l=t[i][1],u=t[a][0],h=t[a][1];if(c===n&&l===o||u===n&&h===o)return"on";if(l<o&&o<=h||o<=l&&h<o){var p=c+(o-l)*(u-c)/(h-l);if(p===n)return"in";n<p&&(r=!r)}}return r?"in":"out"},e=__decorate([a,u("Game/GameLogic/AI/BesiegeAIPrefer")],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../../Common/CommonDef":"CommonDef","../../../Common/PathFinding/Finder/AStarFinder":"AStarFinder","../../../GameGlobal":"GameGlobal","../ChessBoard":"ChessBoard","./NewestPrefer":"NewestPrefer"}],BlackChess:[function(e,t,n){"use strict";cc._RF.push(t,"f215dvMaqtP2IdSxrBJFbwk","BlackChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Unit"),r=e("../../GameGlobal"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offset=70,e.mUnit=null,e.mAnima=null,e.mWhiteSplitMove=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this.mUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mUnit=this.getComponent(o.default),this.mAnima=this.getComponent(cc.Animation)},e.prototype.splitTo=function(e){var n,t=new Promise(function(e,t){n=e,t});return n(r.default.getGlobal().resourceMgr.getWhiteChess()),t},e.prototype.start=function(){},e.prototype.onPutBoard=function(){},e.prototype.onTakeOutBoard=function(){},__decorate([a],e.prototype,"offset",void 0),e=__decorate([s,c("Game/GameLogic/Chess/BlackChess")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../GameGlobal":"GameGlobal","./Unit":"Unit"}],BlockChess:[function(e,t,n){"use strict";cc._RF.push(t,"4ac68fbU9pNUbyGLy8+zjQS","BlockChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Unit"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.belongChapter=0,e.mUnit=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this.mUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mUnit=this.getComponent(o.default)},e.prototype.start=function(){},e.prototype.onPutBoard=function(){},e.prototype.onTakeOutBoard=function(){},e=__decorate([i,s("Game/GameLogic/Chess/BlockChess")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"./Unit":"Unit"}],BoardPreset:[function(e,t,n){"use strict";cc._RF.push(t,"cda7deTCwZPabynwxUrRwTb","BoardPreset"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ChessBoard"),s=e("../../GameGlobal"),a=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,c=(r.property,r.menu),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e.mCfg=null,e.mFile="",e.mLession=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"file",{get:function(){return this.mFile},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mChessBoard=this.getComponent(o.default)},e.prototype.start=function(){},e.prototype.setup=function(e,t){this.mCfg=e,this.mFile=t,this.mLession=parseInt(this.mCfg.chapter+this.mCfg.mission)},e.prototype.presetChess=function(){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,i=this;return __generator(this,function(e){switch(e.label){case 0:if(2==(t=s.default.getGlobal().getData(a.GameType)))return[2];if(!this.mCfg)throw new Error("[BoardPreset.presetChess] config not initialed.");n=0,e.label=1;case 1:return n<this.mCfg.blockChess.length?(o=this.mCfg.blockChess[n],[4,s.default.getGlobal().resourceMgr.getBlockChess(this.mLession)]):[3,4];case 2:r=e.sent(),this.mChessBoard.addUnit(r,cc.v2(o.x,o.y)),e.label=3;case 3:return n++,[3,1];case 4:if(4!=t&&3!=t)return[3,8];n=0,e.label=5;case 5:return n<this.mCfg.destChess.length?(o=this.mCfg.destChess[n],[4,s.default.getGlobal().resourceMgr.getDestChess(this.mLession)]):[3,8];case 6:r=e.sent(),this.mChessBoard.addUnit(r,cc.v2(o.x,o.y)),e.label=7;case 7:return n++,[3,5];case 8:return null!=this.mCfg.content&&(this.mChessBoard.content=this.mCfg.content),[4,s.default.getGlobal().resourceMgr.initChessPrefer(this.mLession)];case 9:return e.sent(),this.mCfg.whiteChess.forEach(function(e){var t=s.default.getGlobal().resourceMgr.getWhiteChess();i.mChessBoard.addUnit(t,cc.v2(e.x,e.y))}),null!=this.mCfg.blackChess&&this.mCfg.blackChess.forEach(function(e){var t=s.default.getGlobal().resourceMgr.getBlackChess();i.mChessBoard.addUnit(t,cc.v2(e.x,e.y)),t.node.emit(a.UnitEvent.ON_CONFIRM)}),[2]}})})},e=__decorate([i,c("Game/GameLogic/Chess/BoardPreset")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","./ChessBoard":"ChessBoard"}],1:[function(e,t,n){var o,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(o===setTimeout)return setTimeout(t,0);if((o===s||!o)&&setTimeout)return o=setTimeout,setTimeout(t,0);try{return o(t,0)}catch(e){try{return o.call(null,t,0)}catch(e){return o.call(this,t,0)}}}(function(){try{o="function"==typeof setTimeout?setTimeout:s}catch(e){o=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}})();var l,u=[],h=!1,p=-1;function d(){h&&l&&(h=!1,l.length?u=l.concat(u):p=-1,u.length&&m())}function m(){if(!h){var e=c(d);h=!0;for(var t=u.length;t;){for(l=u,u=[];++p<t;)l&&l[p].run();p=-1,t=u.length}l=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||h||c(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],CharSetConv:[function(e,t,n){"use strict";cc._RF.push(t,"70979pa+zdNjbGLs4srZdYy","CharSetConv"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=(o.property,o.menu),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.label=this.getComponent(cc.Label)},e.prototype.start=function(){var e=window.location.search,t=new Map;if(-1!=e.indexOf("?"))for(var n=e.substr(1).split("&"),o=0;o<n.length;o++)t.set(n[o].split("=")[0],unescape(n[o].split("=")[1]));t.has("userid")&&t.has("username")&&(this.label.string=decodeURIComponent(t.get("username")))},e=__decorate([r,i("Common/CharSetConv")],e)}(cc.Component);n.default=s,cc._RF.pop()},{}],ChessBoard:[function(e,t,n){"use strict";cc._RF.push(t,"bac99uZoX9DWZDEtDl1QY9T","ChessBoard"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../Common/CommonDef"),o=e("../../Common/linkedlist"),r=e("../../UI/Chess/UIBoard"),s=e("./WhiteChess"),a=e("../../GameGlobal"),c=e("./BlackChess"),l=e("./FlagChess"),u=e("./Unit"),m=e("../../Common/PathFindingDef"),h=e("./DestChess"),p=e("./BlockChess"),d=cc._decorator,f=d.ccclass,y=d.property,g=d.menu,C=function(n){function e(e){var t=n.call(this)||this;return t.units=void 0,t.index=e,t}return __extends(e,n),Object.defineProperty(e.prototype,"x",{get:function(){return this.index.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.index.y},enumerable:!0,configurable:!0}),e.prototype.canPutIn=function(e){return u.default,null==this.units},e.prototype.getUnitType=function(e){return null!=this.units&&this.units.uType==e},e.prototype.putIn=function(e){if(!this.canPutIn(e))throw new Error("chess point already have chess.");(this.units=e).node.emit(i.UnitEvent.ON_PUT_IN,{point:this})},e.prototype.takeOutOne=function(){null!=this.units&&(this.units.node.emit(i.UnitEvent.ON_TAKE_OUT,{point:this}),this.units=null)},e.prototype.takeOutAll=function(){null!=this.units&&(this.units.node.emit(i.UnitEvent.ON_TAKE_OUT,{point:this}),this.units=null)},e}(m.NodeBase),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.column=9,e.row=9,e.mUIBoard=null,e.mPoints=null,e.mWhiteChess=new Array,e.mBlackChess=new Array,e.mDestChess=new Array,e.mBlockChess=new Array,e.mFlagChess=new Array,e.mContent="游戏介绍",e.mSidePoint=new Array,e}return __extends(e,t),Object.defineProperty(e.prototype,"whiteChessOrderedByPutIn",{get:function(){return this.mWhiteChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"whiteChess",{get:function(){return this.mWhiteChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blackChessOrderedByPutIn",{get:function(){return this.mBlackChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blackChess",{get:function(){return this.mBlackChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destChess",{get:function(){return this.mDestChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockChess",{get:function(){return this.mBlockChess},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chessData",{get:function(){var t="";return this.mWhiteChess.forEach(function(e){t+=e.unit.data,t+=";"}),this.mBlackChess.forEach(function(e){t+=e.unit.data,t+=";"}),this.mBlockChess.forEach(function(e){t+=e.unit.data,t+=";"}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this.mContent},set:function(e){this.mContent=e},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mPoints=new Array(this.column);for(var e=0;e<this.column;e++){this.mPoints[e]=new Array(this.row);for(var t=0;t<this.row;t++)this.mPoints[e][t]=new C(cc.v2(e,t))}this.mUIBoard=this.getComponent(r.default),this.mUIBoard.init(this.column,this.row)},e.prototype.start=function(){},e.prototype.onDestroy=function(){cc.log("[ChessBoard.onDestroy]")},e.prototype.cleanup=function(){this.mPoints.forEach(function(e){return e.forEach(function(e){return e.takeOutAll()})}),this.mWhiteChess.forEach(function(e){return a.default.getGlobal().resourceMgr.putWhiteChess(e.unit)}),this.mBlackChess.forEach(function(e){return a.default.getGlobal().resourceMgr.putBlackChess(e.unit)}),this.mFlagChess.forEach(function(e){return a.default.getGlobal().resourceMgr.putFlagChess(e.unit)}),this.mDestChess.forEach(function(e){return a.default.getGlobal().resourceMgr.putDestChess(e.belongChapter,e.unit)}),this.mBlockChess.forEach(function(e){return a.default.getGlobal().resourceMgr.putBlockChess(e.belongChapter,e.unit)}),this.mWhiteChess.splice(0),this.mBlackChess.splice(0),this.mDestChess.splice(0),this.mBlockChess.splice(0),this.mFlagChess.splice(0),this.mSidePoint.splice(0)},e.prototype.addUnit=function(e,t){if(e.uState==i.UnitState.UNIT_STATE_ON_BOARD)throw new Error("[ChessBoard.addUnit] invalid unit state "+e.uState+".");var n=this.getChessPoint(t);if(!n.canPutIn(e))throw new Error("[ChessBoard.addUnit] can not put in "+t.x+" - "+t.y+".");return e.node.parent=this.node,n.putIn(e),e.node.position=this.mUIBoard.getPosition(n.index),e.uType==i.UnitType.UNIT_TYPE_WHITE?this.mWhiteChess.push(e.node.getComponent(s.default)):e.uType==i.UnitType.UNIT_TYPE_BLACK?(this.mBlackChess.push(e.node.getComponent(c.default)),0!=e.index.x&&0!=e.index.y||this.mSidePoint.push(e.node.getComponent(c.default))):e.uType==i.UnitType.UNIT_TYPE_DEST?this.mDestChess.push(e.node.getComponent(h.default)):e.uType==i.UnitType.UNIT_TYPE_BLOCK?this.mBlockChess.push(e.node.getComponent(p.default)):e.uType==i.UnitType.UNIT_TYPE_FLAG&&this.mFlagChess.push(e.node.getComponent(l.default)),!0},e.prototype.takeOut=function(t,e){if(void 0===e&&(e=!1),t.uState!=i.UnitState.UNIT_STATE_ON_BOARD)throw new Error("[ChessBoard.takeOut] invalid unit state "+t.uState+".");this.getChessPoint(t.index).takeOutAll(),e&&this.node.removeChild(t.node),t.uType==i.UnitType.UNIT_TYPE_WHITE?this.mWhiteChess.splice(this.mWhiteChess.findIndex(function(e){return e.unit==t}),1):t.uType==i.UnitType.UNIT_TYPE_BLACK?this.mBlackChess.splice(this.mBlackChess.findIndex(function(e){return e.unit==t}),1):t.uType==i.UnitType.UNIT_TYPE_DEST?this.mDestChess.splice(this.mDestChess.findIndex(function(e){return e.unit==t}),1):t.uType==i.UnitType.UNIT_TYPE_BLOCK?this.mBlockChess.splice(this.mBlockChess.findIndex(function(e){return e.unit==t}),1):t.uType==i.UnitType.UNIT_TYPE_FLAG&&this.mFlagChess.splice(this.mFlagChess.findIndex(function(e){return e.unit==t}),1)},e.prototype.canPass=function(e,t){return!!this.indexValid(t)&&this.mPoints[t.x][t.y].canPutIn(e)},e.prototype.whiteHasQi=function(){var n=this;return!!this.mWhiteChess.find(function(t){return!!i.OPTIONAL_DIR.find(function(e){return n.canPass(t.unit,cc.pAdd(t.unit.index,e))},n)})},e.prototype.whiteQi=function(){var o=this;return this.mWhiteChess.reduce(function(e,n){return e+i.OPTIONAL_DIR.reduce(function(e,t){return o.canPass(n.unit,cc.pAdd(n.unit.index,t))?e+1:e},0)},0)},e.prototype.checkChessLineToLine=function(t){var n=this,o=null;return t==i.UnitType.UNIT_TYPE_WHITE?o=this.mWhiteChess[this.mWhiteChess.length-1]:t==i.UnitType.UNIT_TYPE_BLACK&&(o=this.mBlackChess[this.mBlackChess.length-1]),!!i.OPTIONAL_DIR.find(function(e){return n.checkAroundChessType(cc.pAdd(o.unit.index,e),t)},this)},e.prototype.hasQiChessroundDir9=function(t){var n=this,o=t.uType,e=i.OPTIONAL_DIR_9.find(function(e){return n.checkAroundChessType(cc.pAdd(t.index,e),i.UnitType.UNIT_TYPE_BLOCK)},this),r=i.OPTIONAL_DIR_9.find(function(e){return n.checkAroundChessType(cc.pAdd(t.index,e),o)},this);return null!=e||null!=r},e.prototype.hasQiChessAround=function(t){var n=this,o=t.uType,e=i.OPTIONAL_DIR.find(function(e){return n.checkAroundChessType(cc.pAdd(t.index,e),void 0)},this),r=i.OPTIONAL_DIR.find(function(e){return n.checkAroundChessType(cc.pAdd(t.index,e),o)},this);return null==e||null!=r},e.prototype.checkAroundChessType=function(e,t){return!!this.indexValid(e)&&this.mPoints[e.x][e.y].getUnitType(t)},e.prototype.blackHasQi=function(){var n=this;return!!this.mBlackChess.find(function(t){return!!i.OPTIONAL_DIR.find(function(e){return n.canPass(t.unit,cc.pAdd(t.unit.index,e))},n)})||!!this.mBlockChess.find(function(t){return!!i.OPTIONAL_DIR.find(function(e){return n.canPass(t.unit,cc.pAdd(t.unit.index,e))},n)})},e.prototype.destHasQi=function(){var n=this;return!!this.destChess.find(function(t){return!!i.OPTIONAL_DIR.find(function(e){return n.canPass(t.unit,cc.pAdd(t.unit.index,e))},n)})},e.prototype.getUnits=function(e){if(this.indexValid(e))return this.mPoints[e.x][e.y].units},e.prototype.canPassIndexes=function(t){var n=new Array;return this.mPoints.forEach(function(e){return e.forEach(function(e){e.canPutIn(t)&&n.push(cc.v2(e.index))})}),n},e.prototype.full=function(){return this.whiteChess.length+this.blackChess.length+this.destChess.length+this.mBlockChess.length==this.column*this.row},e.prototype.reuse=function(){},e.prototype.unuse=function(){this.cleanup()},e.prototype.getNodeAt=function(e,t){var n=cc.v2(e,t);return this.indexValid(n)?this.mPoints[n.x][n.y]:null},e.prototype.getNeighbors=function(e,t){var n=new Array,o=e.x,r=e.y,i=!1,s=!1,a=!1,c=!1,l=!1,u=!1,h=!1,p=!1,d=this.mPoints;if(this.isWalkableAt(o,r-1)&&(n.push(d[o][r-1]),i=!0),this.isWalkableAt(o+1,r)&&(n.push(d[o+1][r]),a=!0),this.isWalkableAt(o,r+1)&&(n.push(d[o][r+1]),l=!0),this.isWalkableAt(o-1,r)&&(n.push(d[o-1][r]),h=!0),t===m.DiagonalMovement.Never)return n;if(t===m.DiagonalMovement.OnlyWhenNoObstacles)s=h&&i,c=i&&a,u=a&&l,p=l&&h;else if(t===m.DiagonalMovement.IfAtMostOneObstacle)s=h||i,c=i||a,u=a||l,p=l||h;else{if(t!==m.DiagonalMovement.Always)throw new Error("Incorrect value of diagonalMovement");p=u=c=s=!0}return s&&this.isWalkableAt(o-1,r-1)&&n.push(d[o-1][r-1]),c&&this.isWalkableAt(o+1,r-1)&&n.push(d[o+1][r-1]),u&&this.isWalkableAt(o+1,r+1)&&n.push(d[o+1][r+1]),p&&this.isWalkableAt(o-1,r+1)&&n.push(d[o-1][r+1]),n},e.prototype.getNeighborsIncludeDiagonal=function(e,t){var n=new Array,o=e.x,r=e.y,i=!1,s=!1,a=!1,c=!1,l=this.mPoints;if(this.isWalkableInBlack(o,r-1)&&(n.push(l[o][r-1]),i=!0),this.isWalkableInBlack(o+1,r)&&(n.push(l[o+1][r]),s=!0),this.isWalkableInBlack(o,r+1)&&(n.push(l[o][r+1]),a=!0),this.isWalkableInBlack(o-1,r)&&(n.push(l[o-1][r]),c=!0),t===m.DiagonalMovement.Never)return n;if(t===m.DiagonalMovement.OnlyWhenNoObstacles)c&&i,i&&s,s&&a,a&&c;else if(t===m.DiagonalMovement.IfAtMostOneObstacle)c||i,i||s,s||a,a||c;else{if(t!==m.DiagonalMovement.Always)throw new Error("Incorrect value of diagonalMovement");!0}return this.isWalkableInBlack(o-1,r-1)&&n.push(l[o-1][r-1]),this.isWalkableInBlack(o+1,r-1)&&n.push(l[o+1][r-1]),this.isWalkableInBlack(o+1,r+1)&&n.push(l[o+1][r+1]),this.isWalkableInBlack(o-1,r+1)&&n.push(l[o-1][r+1]),n},e.prototype.clearPath=function(){this.mPoints.forEach(function(e){return e.forEach(function(e){e.closed=!1,e.opened=!1,e.f=0,e.g=0,e.h=0,e.parent=null})})},e.prototype.isWalkableAt=function(e,t){var n=cc.v2(e,t);if(!this.indexValid(n))return!1;var o=this.mPoints[e][t].units;return null==o||o.uType==i.UnitType.UNIT_TYPE_DEST},e.prototype.isWalkableInBlack=function(e,t){var n=cc.v2(e,t);if(!this.indexValid(n))return!1;var o=this.mPoints[e][t].units;return null!=o&&(o.uType==i.UnitType.UNIT_TYPE_BLACK||o.uType==i.UnitType.UNIT_TYPE_BLOCK)},e.prototype.getChessPoint=function(e){if(!this.indexValid(e))throw new Error("[ChessBoard.getChessPoint] invalid index "+e.x+" - "+e.y+".");return this.mPoints[e.x][e.y]},e.prototype.indexValid=function(e){return 0<=e.x&&e.x<this.column&&0<=e.y&&e.y<this.row},e.prototype.isHasCirclePointInSide=function(){return 1<this.mSidePoint.length},e.prototype.isBesiege=function(e){if(this.isHasCirclePointInSide())this.mSidePoint[0]},e.prototype.findNextBesiegePoint=function(t){var n=this;(new o.default).append(t),i.OPTIONAL_DIR_9.filter(function(e){return n.checkAroundChessType(cc.pAdd(t.index,e),i.UnitType.UNIT_TYPE_BLACK)},this).forEach(function(e){})},__decorate([y({range:[2,50]})],e.prototype,"column",void 0),__decorate([y({range:[2,50]})],e.prototype,"row",void 0),e=__decorate([f,g("Game/GameLogic/Chess/ChessBoard")],e)}(cc.Component);n.default=_,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../Common/PathFindingDef":"PathFindingDef","../../Common/linkedlist":"linkedlist","../../GameGlobal":"GameGlobal","../../UI/Chess/UIBoard":"UIBoard","./BlackChess":"BlackChess","./BlockChess":"BlockChess","./DestChess":"DestChess","./FlagChess":"FlagChess","./Unit":"Unit","./WhiteChess":"WhiteChess"}],ChessElement:[function(e,t,n){"use strict";cc._RF.push(t,"ee1c0A1i6FNnrFFT8tJ8LHu","ChessElement"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.snow=null,e.rain=null,e.leave=null,e.star=null,e.shootingStar=null,e.fire=null,e.yunwu=null,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.showElement=function(e){1==e?this.rain.active=!0:2==e?this.leave.active=!0:3==e?this.snow.active=!0:4==e?this.leave.active=!0:5==e?this.yunwu.active=!0:6==e?this.yunwu.active=!0:7==e?this.fire.active=!0:8==e?this.fire.active=!0:9==e&&(this.star.active=!0,this.shootingStar.active=!0)},__decorate([i(cc.Node)],e.prototype,"snow",void 0),__decorate([i(cc.Node)],e.prototype,"rain",void 0),__decorate([i(cc.Node)],e.prototype,"leave",void 0),__decorate([i(cc.Node)],e.prototype,"star",void 0),__decorate([i(cc.Node)],e.prototype,"shootingStar",void 0),__decorate([i(cc.Node)],e.prototype,"fire",void 0),__decorate([i(cc.Node)],e.prototype,"yunwu",void 0),e=__decorate([r,s("Game/GameLogic/Chess/ChessElement")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],ChessPlay:[function(e,t,n){"use strict";cc._RF.push(t,"beac8v3sUxHrpKnb0d3mSIc","ChessPlay"),Object.defineProperty(n,"__esModule",{value:!0});var d,o,m=e("../../Common/CommonDef"),r=e("./ChessBoard"),i=e("./BoardPreset"),f=e("../../GameGlobal"),s=e("../../UI/Chess/UIBoardCtrl"),a=e("./AI/NearestPrefer"),c=e("./AI/NewestPrefer"),l=e("./AI/AimAIPrefer"),u=e("./AI/PlayChessPrefer"),h=e("../../UI/Chess/UICheckOut"),y=e("../../Net/ProtoBuf/Msg"),p=e("./ChessElement"),g=e("./AI/BesiegeAIPrefer"),C=cc._decorator,_=C.ccclass,v=C.property,I=C.menu;(o=d||(d={}))[o.STATE_INVALD=0]="STATE_INVALD",o[o.STATE_INITED=1]="STATE_INITED",o[o.STATE_CHESSING=2]="STATE_CHESSING",o[o.STATE_FINISHED=3]="STATE_FINISHED";var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeLimitSesc=60,e.stepLimit=8,e.userTurn=m.Turn.BLACK_TURN,e.timeLable=null,e.stepLable=null,e.stepItem=null,e.timeItem=null,e.endTurn=null,e.checkOutNode=null,e.checkoutUI=null,e.timeAlert=null,e.alertBoundSecs=10,e.refreshTimeIntevalMS=500,e.stepAnima=null,e.timeAnima=null,e.timeSpine=null,e.returnButton=null,e.chessElement=null,e.qianMo=null,e.btnSprites=new Array,e.btnTextSprites=new Array,e.ResultOkFlag=null,e.ResultErrFlag=null,e.mcountChessNode=null,e.mGameInfo1=null,e.mGameInfo2=null,e.countChessBtn=null,e.mBG=null,e.mCurrentTurn=m.Turn.BLACK_TURN,e.mChessBoard=null,e.mUICtrl=null,e.mBoardPreset=null,e.mState=d.STATE_INVALD,e.mCPUSplitAI=null,e.mResolveDoBlackChess=null,e.mTotalMS=0,e.mTotalSteps=0,e.mStartTime=0,e.mLastRefreshStamp=0,e.mLastUpdateStamp=0,e.mClean=!1,e.mCfg=null,e.mDestChess=null,e.mMissCfgFiles=null,e.mCurrentChaper=0,e.mCurrentMission=0,e.mCurrentUnconfirm=null,e.mAlertShowing=!1,e.mBtnSprite=null,e.mBtnTextSprite=null,e.mBtnAnima=null,e.cfgIndex=-1,e.startCfgIndex=0,e.gameType=1,e.countChessReuslt=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"currentTurn",{get:function(){return this.mCurrentTurn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cpuTurn",{get:function(){return this.userTurn==m.Turn.BLACK_TURN?m.Turn.WHITE_TURN:m.Turn.BLACK_TURN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalMS",{get:function(){return this.mTotalMS},set:function(e){var t=this;this.mTotalMS=e,1==this.gameType||5==this.gameType?(this.refreshTimeUI(),this.mTotalMS>=this.timeLimitSesc&&this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_REACH_DEST)):6==this.gameType&&(this.refreshTimeUI(),this.mTotalMS>=this.timeLimitSesc&&(this.ResultOkFlag.active=!0,this.ResultErrFlag.active=!1,this.mState=d.STATE_FINISHED,setTimeout(function(){t.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_REACH_DEST)},2e3)))},enumerable:!0,configurable:!0}),e.prototype.checkStepCount=function(){4==this.gameType&&this.mTotalSteps>=this.stepLimit&&this.onWin(this.cpuTurn,m.Reason.REASON_STEP_OUT)},Object.defineProperty(e.prototype,"totalStep",{get:function(){return this.mTotalSteps},set:function(e){var t=this;this.mTotalSteps=e,this.refreshStepUI(),1==this.gameType||5==this.gameType||6==this.gameType?this.mTotalMS<this.timeLimitSesc&&this.mTotalSteps>=this.stepLimit&&(6==this.gameType?(this.ResultOkFlag.active=!1,this.ResultErrFlag.active=!0,this.mState=d.STATE_FINISHED,setTimeout(function(){t.onWin(m.Turn.WHITE_TURN,m.Reason.REASON_TIME_OUT)},2e3)):this.onWin(this.cpuTurn,m.Reason.REASON_STEP_OUT)):3==this.gameType&&this.mTotalSteps>=this.stepLimit&&this.onWin(this.cpuTurn,m.Reason.REASON_STEP_OUT)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalSecs",{get:function(){return Math.floor(this.mTotalMS/1e3)},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){f.default.getGlobal().audioEngine.LoadSound(),this.checkOutNode.active=!1,this.mChessBoard=this.getComponentInChildren(r.default),this.mBoardPreset=this.getComponentInChildren(i.default),this.mUICtrl=this.getComponentInChildren(s.default),this.countChessBtn=cc.find("Canvas/Chess/UI/countChessBtn"),this.mBG=this.getComponent(cc.Sprite),this.mBtnSprite=this.endTurn.getComponent(cc.Sprite),this.mBtnTextSprite=cc.find("Value",this.endTurn.node).getComponent(cc.Sprite),this.mBtnAnima=cc.find("ConfirmAnima",this.endTurn.node).getComponent(cc.Animation),this.mUICtrl.interactable=!1,this.endTurn.interactable=!1,this.timeSpine.enabled=!1,this.mBtnAnima.node.active=!1,this.mBtnAnima.node.setLocalZOrder(-2),this.returnButton.node.on("click",this.ReturnButtonOnClick,this),this.ResultOkFlag.active=!1,this.ResultErrFlag.active=!1,setTimeout(function(){f.default.getGlobal().localPlayer.OnExit(0)},2e3)},e.prototype.start=function(){cc.game.setFrameRate(30),setTimeout(function(){f.default.getGlobal().localPlayer.OnExit(0),f.default.getGlobal().audioEngine.PlayBackgroundMusic()},1e3),this.init().catch(function(e){cc.error("[ChessPlay.start] ",e.message,e.stack)}),this.resetBtnStatus()},e.prototype.resetBtnStatus=function(){2==this.gameType?this.countChessBtn.active=!0:this.countChessBtn.active=!1,1==this.gameType||5==this.gameType||6==this.gameType?this.timeLable.node.parent.active=!0:this.timeLable.node.parent.active=!1,2==this.gameType?this.stepLable.node.parent.active=!1:this.stepLable.node.parent.active=!0},e.prototype.update=function(e){},e.prototype.onDestroy=function(){this.cleanup()},e.prototype.onDropChess=function(e){this.mState==d.STATE_CHESSING&&(this.userDropChess(e),this.mUICtrl.hideMark())},e.prototype.onTouchBoard=function(e){this.mState==d.STATE_CHESSING&&this.mUICtrl.showMark(e,this.mChessBoard.canPass(m.UnitType.UNIT_TYPE_BLACK,e))},e.prototype.onTouchingBoard=function(e){this.mState==d.STATE_CHESSING&&this.mUICtrl.showMark(e,this.mChessBoard.canPass(m.UnitType.UNIT_TYPE_BLACK,e))},e.prototype.onStepItem=function(){this.mState==d.STATE_CHESSING&&(this.stepLimit+=f.default.getGlobal().resourceMgr.getItemCfg().item_step_add,f.default.getGlobal().localPlayer.useStepItem(),this.refreshUI(),f.default.getGlobal().audioEngine.PlayButtonSound(),this.stepAnima.play())},e.prototype.onTimeItem=function(){var e=this;this.mState==d.STATE_CHESSING&&(this.timeLimitSesc+=f.default.getGlobal().resourceMgr.getItemCfg().item_time_add,f.default.getGlobal().localPlayer.useTimeItem(),this.refreshUI(),f.default.getGlobal().audioEngine.PlayButtonSound(),this.timeAnima.play(),this.timeSpine.enabled=!0,this.timeSpine.addAnimation(0,"animation",!1),this.timeSpine.setCompleteListener(function(){e.node.isValid&&(e.timeSpine.enabled=!1)}))},e.prototype.checkCurrentInDestChess=function(){var n=this,o=!1;return this.mCfg.destChess.forEach(function(e,t){n.mCurrentUnconfirm.index.x==e.x&&n.mCurrentUnconfirm.index.y==e.y&&(o=!0)}),o},e.prototype.removeCurrentInDestChess=function(){var n=this;return this.mDestChess.forEach(function(e,t){n.mCurrentUnconfirm.index.x==e.x&&n.mCurrentUnconfirm.index.y==e.y&&n.mDestChess.splice(t,1)}),!1},e.prototype.onCountChess=function(){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(e){switch(e.label){case 0:return 2!=this.gameType?[3,2]:(t="listAction="+this.mChessBoard.chessData,[4,f.default.getGlobal().netWork.httpRequest.post(m.HTTP_PLAY_CHESS_AI_HOST,m.HTTP_PLAY_CHESS_RESULT,t)]);case 1:return n=e.sent(),this.mcountChessNode.getComponent("UICountChess").initCountChessInfo(n),this.mcountChessNode.active=!0,o=JSON.parse(n),console.log("responseText",o),0!=o.error.returnCode?[2]:null==o.data?[2]:null==o.data.blackList||null==o.data.whiteList?[2]:(0<o.data.blackList.length-o.data.whiteList.length-3.75?this.countChessReuslt=!0:this.countChessReuslt=!1,[3,3]);case 2:this.gameType,e.label=3;case 3:return[2]}})})},e.prototype.onCountSureBtn=function(){this.mcountChessNode.active=!1,this.countChessReuslt?this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_QI_OUT):this.onWin(m.Turn.WHITE_TURN,m.Reason.REASON_QI_OUT)},e.prototype.onCountFailBtn=function(){this.mcountChessNode.active=!1},e.prototype.onNextTurn=function(){return __awaiter(this,void 0,void 0,function(){var t,n,o,r=this;return __generator(this,function(e){switch(e.label){case 0:return this.mState!=d.STATE_CHESSING?[2]:1!=this.gameType?[3,1]:(this.checkCurrentInDestChess()?(f.default.getGlobal().audioEngine.PlayConfirmButtonSound(),this.totalMS++):this.dianjiNotCanPassHandler(),this.tryResolveUserOpt(),[3,10]);case 1:return 2!=this.gameType?[3,5]:this.mChessBoard.hasQiChessAround(this.mCurrentUnconfirm)?[4,this.httpServerTakeoutChess("B")]:[3,3];case 2:return e.sent(),this.tryResolveUserOpt(),[3,4];case 3:this.dianjiNotCanPassHandler(),e.label=4;case 4:return[3,10];case 5:return 5!=this.gameType?[3,9]:this.mTotalMS>=this.timeLimitSesc?(this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_REACH_DEST),[3,8]):[3,6];case 6:return[4,this.httpServerTakeoutChess("B",!0)];case 7:e.sent(),this.tryResolveUserOpt(),e.label=8;case 8:return[3,10];case 9:6==this.gameType?this.checkRoundHasBlockOrBlackChess()?(this.mCPUSplitAI.trySplit(),t=this.mCPUSplitAI.getMapFlagCount(),this.totalMS=t,this.tryResolveUserOpt()):this.dianjiNotCanPassHandler():3==this.gameType||4==this.gameType?this.checkCurrentBlackHasOtherBlackChess()?this.tryResolveUserOpt():this.dianjiNotCanPassHandler():this.tryResolveUserOpt(),e.label=10;case 10:return 1!=this.gameType&&f.default.getGlobal().audioEngine.PlayConfirmButtonSound(),n=this.mChessBoard.blackChess[this.mChessBoard.blackChess.length-1],3==this.gameType&&(null!=(o=this.mChessBoard.getUnits(n.unit.index))&&o.uType==m.UnitType.UNIT_TYPE_DEST&&this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_REACH_DEST),m.OPTIONAL_DIR.find(function(e){var t=r.mChessBoard.getUnits(cc.pAdd(n.unit.index,e));return!!t&&t.uType==m.UnitType.UNIT_TYPE_DEST})&&this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_REACH_DEST)),[2]}})})},e.prototype.checkCurrentBlackHasOtherBlackChess=function(){return this.mChessBoard.checkChessLineToLine(m.UnitType.UNIT_TYPE_BLACK)},e.prototype.checkRoundHasBlockOrBlackChess=function(){return this.mChessBoard.hasQiChessroundDir9(this.mCurrentUnconfirm)},e.prototype.onPlayAgain=function(){f.default.getGlobal().audioEngine.PlayButtonSound(),this.checkOutNode.active=!1,this.playerAgain()},e.prototype.onReturnToMain=function(){f.default.getGlobal().audioEngine.PlayButtonSound(),this.finishChessing(),m.FadeIn(m.LevelMapKey+f.default.getGlobal().getData(m.ChapterID)),f.default.getGlobal().localPlayer.OnExit(3)},e.prototype.onNextMission=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return f.default.getGlobal().audioEngine.PlayButtonSound(),this.checkOutNode.active=!1,this.cleanup(),[4,this.setUp(!0)];case 1:return e.sent(),this.play().catch(function(e){cc.error("[ChessPlay.onPlayAgain] ",e.message,e.stack)}),[2]}})})},e.prototype.ReturnButtonOnClick=function(e){f.default.getGlobal().audioEngine.PlayCloseButtonSound(),this.finishChessing(),m.FadeIn(m.LevelMapKey+f.default.getGlobal().getData(m.ChapterID)),f.default.getGlobal().localPlayer.OnExit(1)},e.prototype.OnQianMoTouch=function(){this.qianMo.setAnimation(0,"animation2",!1),this.qianMo.addAnimation(0,"animation",!0)},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return this.mMissCfgFiles=f.default.getGlobal().getData(m.GameIDs),t=Number.parseInt(this.getMissCfgFiles(!0)),console.log("chess play is init  mission---"+t),this.mCurrentChaper=Math.floor(t/100),this.gameType=Math.floor(t/1e5),f.default.getGlobal().cacheData(m.GameType,this.gameType),this.mCurrentMission=t,n=this.mBG,[4,f.default.getGlobal().resourceMgr.getChessBG(this.mCurrentChaper)];case 1:return n.spriteFrame=e.sent(),this.chessElement.showElement(this.mCurrentChaper),[4,this.setUp(!1)];case 2:return e.sent(),this.play().catch(function(e){cc.error("[ChessPlay.init] ",e.message,e.stack)}),[2]}})})},e.prototype.setChapterAndGameType=function(){},e.prototype.refreshUI=function(){this.refreshStepUI(),this.refreshItem(),this.refreshTimeUI()},e.prototype.refreshStepUI=function(){this.stepLable.string=this.totalStep+"/"+this.stepLimit},e.prototype.refreshTimeUI=function(){this.timeLable.string=this.totalMS+"/"+this.timeLimitSesc},e.prototype.refreshItem=function(){this.stepItem.interactable=f.default.getGlobal().localPlayer.hasStepItem(),this.timeItem.interactable=f.default.getGlobal().localPlayer.hasTimeItem()},e.prototype.play=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 1!=this.gameType&&5!=this.gameType&&6!=this.gameType?[3,2]:(6==this.gameType&&(this.mCPUSplitAI=this.getComponent(g.default)),[4,this.DianJiTypePlay()]);case 1:return e.sent(),[3,4];case 2:return[4,this.DuJieAndChiziPlay()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.DuJieAndChiziPlay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.mUICtrl.interactable=!1,[4,this.mBoardPreset.presetChess()];case 1:return e.sent(),this.setGameContentInfo(),1==this.gameType?this.mCPUSplitAI=this.getComponent(c.default):2==this.gameType?this.mCPUSplitAI=this.getComponent(u.default):3==this.gameType?(this.mCPUSplitAI=this.getComponent(l.default),this.mCPUSplitAI.initData()):4==this.gameType?this.mCPUSplitAI=this.getComponent(a.default):5==this.gameType&&(this.mCPUSplitAI=this.getComponent(c.default)),[4,this.showGreeting()];case 2:e.sent(),this.onStarChess(),e.label=3;case 3:return this.onBeginTurn(this.mCurrentTurn),this.mCurrentTurn!=m.Turn.BLACK_TURN?[3,5]:[4,this.doUserChess()];case 4:return e.sent(),[3,7];case 5:return[4,this.doCPUChess()];case 6:e.sent(),e.label=7;case 7:this.checkWinner(),this.onEndTurn(this.mCurrentTurn),this.mCurrentTurn=this.mCurrentTurn==m.Turn.BLACK_TURN?m.Turn.WHITE_TURN:m.Turn.BLACK_TURN,e.label=8;case 8:if(this.mState==d.STATE_CHESSING)return[3,3];e.label=9;case 9:return[2]}})})},e.prototype.AimTypePlay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.mUICtrl.interactable=!1,[4,this.mBoardPreset.presetChess()];case 1:return e.sent(),this.setGameContentInfo(),[4,this.showGreeting()];case 2:e.sent(),this.onStarChess(),e.label=3;case 3:return this.onBeginTurn(this.mCurrentTurn),[4,this.doUserChess()];case 4:e.sent(),this.onEndTurn(m.Turn.BLACK_TURN),e.label=5;case 5:if(this.mState==d.STATE_CHESSING)return[3,3];e.label=6;case 6:return[2]}})})},e.prototype.setGameContentInfo=function(){this.mChessBoard.content.length<=20?(this.mGameInfo1.string=this.mChessBoard.content,this.mGameInfo2.string=""):(this.mGameInfo1.string=this.mChessBoard.content.substr(0,20),this.mGameInfo2.string=this.mChessBoard.content.substr(20))},e.prototype.DianJiTypePlay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.mUICtrl.interactable=!1,[4,this.mBoardPreset.presetChess()];case 1:return e.sent(),this.setGameContentInfo(),[4,this.showGreeting()];case 2:e.sent(),this.onStarChess(),e.label=3;case 3:return this.onBeginTurn(this.mCurrentTurn),[4,this.doUserChess()];case 4:e.sent(),this.onEndTurn(m.Turn.BLACK_TURN),e.label=5;case 5:if(this.mState==d.STATE_CHESSING)return[3,3];e.label=6;case 6:return[2]}})})},e.prototype.showGreeting=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return cc.log("[ChessPlay.showGreeting]"),[2]})})},e.prototype.onStarChess=function(){this.mStartTime=f.default.getGlobal().gameInfo.elapsedTime,this.mState=d.STATE_CHESSING},e.prototype.RequestResolve=function(e){var t=JSON.parse(e);if(console.log("responseText",t),0==t.error.returnCode&&null!=t.data&&"W"==t.data[0]){var n=t.data[2].charCodeAt()-97,o=t.data[3].charCodeAt()-97,r=f.default.getGlobal().resourceMgr.getWhiteChess(),i=cc.v2(n,o);this.mChessBoard.addUnit(r,i)}},e.prototype.doCPUChess=function(){return __awaiter(this,void 0,void 0,function(){var n,t,o,r,i,s=this;return __generator(this,function(e){switch(e.label){case 0:return this.mState!=d.STATE_CHESSING?[2]:(this.mUICtrl.interactable=!1,this.endTurn.interactable=!1,this.mBtnSprite.spriteFrame=this.btnSprites[2],this.mBtnTextSprite.spriteFrame=this.btnTextSprites[2],this.mBtnAnima.stop(),this.mBtnAnima.node.active=!1,console.log("do cpu chesss ---start ----- aaaaaaa---"),n=null,2!=this.gameType?[3,3]:(t="listAction="+this.mChessBoard.chessData,[4,f.default.getGlobal().netWork.httpRequest.post(m.HTTP_PLAY_CHESS_AI_HOST,m.HTTP_PLAY_CHESS_AI_METHOD,t)]));case 1:return o=e.sent(),console.log("mAides---",o),this.RequestResolve(o),[4,this.httpServerTakeoutChess("W")];case 2:return e.sent(),[2];case 3:n=this.mCPUSplitAI.trySplit(),e.label=4;case 4:return n?(4!=this.gameType&&5!=this.gameType||null!=(r=this.mChessBoard.getUnits(n.index))&&r.uType==m.UnitType.UNIT_TYPE_DEST&&this.onWin(this.cpuTurn,m.Reason.REASON_REACH_DEST),null==n.chess?[3,6]:[4,n.chess.splitTo(n.index)]):[3,8];case 5:return i=e.sent(),this.mChessBoard.addUnit(i,n.index),[3,7];case 6:this.mChessBoard.addUnit(f.default.getGlobal().resourceMgr.getWhiteChess(),n.index),e.label=7;case 7:return f.default.getGlobal().audioEngine.PlayWhiteButtonSound(),4!=this.gameType&&5!=this.gameType||m.OPTIONAL_DIR.find(function(e){var t=s.mChessBoard.getUnits(cc.pAdd(n.index,e));return!!t&&t.uType==m.UnitType.UNIT_TYPE_DEST})&&this.onWin(this.cpuTurn,m.Reason.REASON_REACH_DEST),[3,9];case 8:this.onWin(this.userTurn,m.Reason.REASON_QI_OUT),e.label=9;case 9:return cc.log("[ChessPlay.doCPUChess] finished."),[2]}})})},e.prototype.doUserChess=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return this.mState!=d.STATE_CHESSING?[2]:(this.mUICtrl.interactable=!0,this.endTurn.interactable=!1,this.mBtnSprite.spriteFrame=this.btnSprites[0],this.mBtnTextSprite.spriteFrame=this.btnTextSprites[0],cc.log("[ChessPlay.doUserChess]"),[2,new Promise(function(e,t){n.mResolveDoBlackChess=e,console.log("resolve---",e)})])})})},e.prototype.userDropChess=function(e){this.mChessBoard.canPass(m.UnitType.UNIT_TYPE_BLACK,e)&&(this.mCurrentUnconfirm?this.mChessBoard.takeOut(this.mCurrentUnconfirm):(this.endTurn.interactable=!0,this.mBtnSprite.spriteFrame=this.btnSprites[1],this.mBtnTextSprite.spriteFrame=this.btnTextSprites[1],this.mBtnAnima.node.active=!0,this.mBtnAnima.play(),this.mCurrentUnconfirm=f.default.getGlobal().resourceMgr.getBlackChess()),f.default.getGlobal().audioEngine.PlayBlackButtonSound(),this.mChessBoard.addUnit(this.mCurrentUnconfirm,e))},e.prototype.onEndTurn=function(e){cc.log("[ChessPlay.onEndTurn] ",e),e==this.userTurn&&this.totalStep++},e.prototype.onBeginTurn=function(e){cc.log("[ChessPlay.onBeginTurn] ",e)},e.prototype.dianjiNotCanPassHandler=function(){var e=this;this.mCurrentUnconfirm&&(this.mUICtrl.showMark(this.mCurrentUnconfirm.index,this.mChessBoard.canPass(m.UnitType.UNIT_TYPE_BLACK,this.mCurrentUnconfirm.index)),this.mChessBoard.takeOut(this.mCurrentUnconfirm,!0),setTimeout(function(){e.mUICtrl.hideMark()},200)),this.mCurrentUnconfirm=null},e.prototype.httpServerTakeoutChess=function(o,r){return void 0===r&&(r=!1),__awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="listAction="+this.mChessBoard.chessData+"&color="+o,console.log("提子请求：---",this.mChessBoard.chessData),[4,f.default.getGlobal().netWork.httpRequest.post(m.HTTP_PLAY_CHESS_AI_HOST,m.HTTP_PLAY_CHESS_TAKE_CHESS,t)];case 1:return n=e.sent(),console.log("httpServerTakeoutChess---666666-----"),this.taskOutChessHandler(n,r),[2]}})})},e.prototype.taskOutChessHandler=function(n,o){return void 0===o&&(o=!1),__awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(e){return console.log("taskOutChessHandler----start----77777"),t=JSON.parse(n),console.log("responseText",t),0!=t.error.returnCode||null==t.data||0==t.data.length||(t.data.forEach(function(e){var t=e[2].charCodeAt()-97,n=e[3].charCodeAt()-97,o=cc.v2(t,n),r=i.mChessBoard.getUnits(o);i.mChessBoard.takeOut(r,!0)}),5==this.gameType&&o&&(this.totalMS+=t.data.length)),[2]})})},e.prototype.sleep=function(n){return new Promise(function(e,t){setTimeout(function(){e("enough sleep~")},n)})},e.prototype.tryResolveUserOpt=function(){this.mResolveDoBlackChess&&(console.log("mResolveDoBlackChess--",this.mResolveDoBlackChess),this.mResolveDoBlackChess(),this.mResolveDoBlackChess=null,this.mUICtrl.interactable=!1,this.mCurrentUnconfirm&&this.mCurrentUnconfirm.node.emit(m.UnitEvent.ON_CONFIRM),this.mCurrentUnconfirm=null,console.log("tryResolveUserOpt end-----000000"))},e.prototype.checkWinner=function(){this.mState==d.STATE_CHESSING&&(0<this.mChessBoard.whiteChess.length&&!this.mChessBoard.whiteHasQi()?this.onWin(m.Turn.BLACK_TURN,m.Reason.REASON_QI_OUT):0<this.mChessBoard.blackChess.length&&!this.mChessBoard.blackHasQi()?this.onWin(m.Turn.WHITE_TURN,m.Reason.REASON_QI_OUT):this.checkStepCount())},e.prototype.onWin=function(e,t){var n=this;this.mState=d.STATE_FINISHED,this.checkOutNode.active=!0;var o={chaper:this.mCurrentChaper,mission:this.mCurrentMission,originalStars:0,gotStars:0,deltaGolds:0},r=0;e==this.userTurn?(r=this.totalStep<=this.mCfg.greatST[0]&&this.totalSecs<this.mCfg.greatST[1]?3:this.totalStep<=this.mCfg.greatST[0]?2:1,!0,this.checkoutUI.showWin(r,this.cfgIndex==this.startCfgIndex)):(r=0,!1,this.checkoutUI.showLose(t)),o.gotStars=r;var i=f.default.getGlobal().resourceMgr.getChapterCfg(this.mCurrentChaper).boss_mission==this.mCurrentMission;o.deltaGolds=i?r*f.default.getGlobal().resourceMgr.getGameCfg().player_cfg.boss_mission_win_gold_per_star:r*f.default.getGlobal().resourceMgr.getGameCfg().player_cfg.normal_mission_win_gold_per_star;var s=f.default.getGlobal().localPlayer.info.missions.find(function(e){return e.chapterID==n.mCurrentChaper&&e.missionID==n.mCurrentMission});s?(o.originalStars=s.stars,s.stars<r?s.stars=r:r=s.stars):(o.originalStars=0,f.default.getGlobal().localPlayer.info.missions.push(y.protocol.Mission.create({chapterID:this.mCurrentChaper,missionID:this.mCurrentMission,stars:r}))),f.default.getGlobal().localPlayer.info.lastPlayMission.chapterID=this.mCurrentChaper,f.default.getGlobal().localPlayer.info.lastPlayMission.missionID=this.mCurrentMission,f.default.getGlobal().localPlayer.info.lastPlayMission.stars=r,f.default.getGlobal().cacheData(m.MISSION_CACHE_DATA_KEY,o);var a=o.gotStars>o.originalStars?o.gotStars-o.originalStars:0;if(0<a){var c=f.default.getGlobal().localPlayer.info.missions.reduce(function(e,t){return e+t.stars},0),l=f.default.getGlobal().resourceMgr.getMaxUnlock(c-a),u=f.default.getGlobal().resourceMgr.getMaxUnlock(c);if(l<u){var h=f.default.getGlobal().getData(m.UNLOCK_CHAPTERS_CACHE_KEY);h||(h=new Array);for(var p=l+1;p<=u;p++)h.push(p);f.default.getGlobal().cacheData(m.UNLOCK_CHAPTERS_CACHE_KEY,h),h.forEach(function(e){return cc.log("unlock ",e,".")})}}this.tryResolveUserOpt()},e.prototype.showTimeAlert=function(){var e=cc.sequence(cc.scaleTo(.5,1.02,1.02),cc.scaleTo(.3,1,1)),t=cc.sequence(cc.tintTo(.5,255,100,100),cc.tintTo(.3,255,50,50)),n=cc.repeatForever(cc.spawn(e,t));this.timeAlert.node.runAction(n)},e.prototype.stopAlert=function(){this.timeAlert.node.stopAllActions(),this.timeAlert.node.color=cc.Color.WHITE,this.timeAlert.node.scaleX=1,this.timeAlert.node.scaleY=1,this.mAlertShowing=!1},e.prototype.playerAgain=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.resetBtnStatus(),this.cleanup(),[4,this.setUp(!1)];case 1:return e.sent(),this.play().catch(function(e){cc.error("[ChessPlay.onPlayAgain] ",e.message,e.stack)}),[2]}})})},e.prototype.finishChessing=function(){this.mState=d.STATE_FINISHED,this.cleanup()},e.prototype.getMissCfgFiles=function(e){return-1==this.cfgIndex&&(this.cfgIndex=Math.floor(Math.random()*this.mMissCfgFiles.length),this.startCfgIndex=this.cfgIndex),e&&this.cfgIndex++,this.cfgIndex>=this.mMissCfgFiles.length&&(this.cfgIndex=0),this.mMissCfgFiles[this.cfgIndex]},e.prototype.setUp=function(o){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.getMissCfgFiles(o),n=this,[4,f.default.getGlobal().resourceMgr.getMissionData(t)];case 1:return n.mCfg=e.sent(),this.mBoardPreset.setup(this.mCfg,t),this.mDestChess=this.mCfg.destChess.concat(),this.mState=d.STATE_INITED,this.mClean=!1,this.mTotalMS=0,this.mTotalSteps=0,this.mStartTime=0,this.mCurrentTurn=this.userTurn,this.stepLimit=this.mCfg.limtST[0],this.timeLimitSesc=this.mCfg.limtST[1],this.mCurrentUnconfirm=null,this.mResolveDoBlackChess=null,this.endTurn.interactable=!1,this.refreshUI(),this.ResultOkFlag.active=!1,this.ResultErrFlag.active=!1,[2]}})})},e.prototype.cleanup=function(){this.mClean||(this.tryResolveUserOpt(),this.mChessBoard.cleanup(),this.unscheduleAllCallbacks(),this.node.stopAllActions(),this.stopAlert(),this.mBtnAnima.stop(),this.mBtnAnima.node.active=!1,this.mClean=!0)},__decorate([v],e.prototype,"timeLimitSesc",void 0),__decorate([v],e.prototype,"stepLimit",void 0),__decorate([v({type:cc.Enum(m.Turn)})],e.prototype,"userTurn",void 0),__decorate([v(cc.Label)],e.prototype,"timeLable",void 0),__decorate([v(cc.Label)],e.prototype,"stepLable",void 0),__decorate([v(cc.Button)],e.prototype,"stepItem",void 0),__decorate([v(cc.Button)],e.prototype,"timeItem",void 0),__decorate([v(cc.Button)],e.prototype,"endTurn",void 0),__decorate([v(cc.Node)],e.prototype,"checkOutNode",void 0),__decorate([v({type:h.default})],e.prototype,"checkoutUI",void 0),__decorate([v(cc.Sprite)],e.prototype,"timeAlert",void 0),__decorate([v],e.prototype,"alertBoundSecs",void 0),__decorate([v],e.prototype,"refreshTimeIntevalMS",void 0),__decorate([v(cc.Animation)],e.prototype,"stepAnima",void 0),__decorate([v(cc.Animation)],e.prototype,"timeAnima",void 0),__decorate([v(sp.Skeleton)],e.prototype,"timeSpine",void 0),__decorate([v(cc.Button)],e.prototype,"returnButton",void 0),__decorate([v(p.default)],e.prototype,"chessElement",void 0),__decorate([v(sp.Skeleton)],e.prototype,"qianMo",void 0),__decorate([v({type:[cc.SpriteFrame]})],e.prototype,"btnSprites",void 0),__decorate([v({type:[cc.SpriteFrame]})],e.prototype,"btnTextSprites",void 0),__decorate([v(cc.Node)],e.prototype,"ResultOkFlag",void 0),__decorate([v(cc.Node)],e.prototype,"ResultErrFlag",void 0),__decorate([v(cc.Node)],e.prototype,"mcountChessNode",void 0),__decorate([v(cc.Label)],e.prototype,"mGameInfo1",void 0),__decorate([v(cc.Label)],e.prototype,"mGameInfo2",void 0),__decorate([v(cc.Node)],e.prototype,"countChessBtn",void 0),e=__decorate([_,I("Game/GameLogic/Chess/ChessPlay")],e)}(cc.Component);n.default=P,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../../Net/ProtoBuf/Msg":"Msg","../../UI/Chess/UIBoardCtrl":"UIBoardCtrl","../../UI/Chess/UICheckOut":"UICheckOut","./AI/AimAIPrefer":"AimAIPrefer","./AI/BesiegeAIPrefer":"BesiegeAIPrefer","./AI/NearestPrefer":"NearestPrefer","./AI/NewestPrefer":"NewestPrefer","./AI/PlayChessPrefer":"PlayChessPrefer","./BoardPreset":"BoardPreset","./ChessBoard":"ChessBoard","./ChessElement":"ChessElement"}],CommonDef:[function(e,t,n){"use strict";var o,r,i,s,a,c,l;cc._RF.push(t,"c187eI9OWpJXoB0de7wgXmd","CommonDef"),Object.defineProperty(n,"__esModule",{value:!0}),(o=n.BorderLayer||(n.BorderLayer={}))[o.CHESS_LEAYER=1]="CHESS_LEAYER",o[o.CHESS_LEAYER_MAX=19]="CHESS_LEAYER_MAX",o[o.MARK_LEAYER=20]="MARK_LEAYER",(r=n.UnitType||(n.UnitType={}))[r.UNIT_TYPE_WHITE=1]="UNIT_TYPE_WHITE",r[r.UNIT_TYPE_DEST=2]="UNIT_TYPE_DEST",r[r.UNIT_TYPE_BLACK=3]="UNIT_TYPE_BLACK",r[r.UNIT_TYPE_BLOCK=4]="UNIT_TYPE_BLOCK",r[r.UNIT_TYPE_FLAG=5]="UNIT_TYPE_FLAG",(i=n.UnitState||(n.UnitState={}))[i.UNIT_STATE_INVALID=0]="UNIT_STATE_INVALID",i[i.UNIT_STATE_ON_BOARD=1]="UNIT_STATE_ON_BOARD",i[i.UNIT_STATE_OFF_BOARD=2]="UNIT_STATE_OFF_BOARD",(s=n.Turn||(n.Turn={}))[s.BLACK_TURN=1]="BLACK_TURN",s[s.WHITE_TURN=2]="WHITE_TURN",(a=n.UnitEvent||(n.UnitEvent={})).ON_PUT_IN="ON_PUT_IN",a.ON_TAKE_OUT="ON_TAKE_OUT",a.ON_CONFIRM="ON_CONFIRM",a.ON_REUSE="ON_REUSE",a.ON_UNUSE="ON_UNUSE",(c=n.Reason||(n.Reason={}))[c.REASON_TIME_OUT=0]="REASON_TIME_OUT",c[c.REASON_STEP_OUT=1]="REASON_STEP_OUT",c[c.REASON_QI_OUT=2]="REASON_QI_OUT",c[c.REASON_REACH_DEST=3]="REASON_REACH_DEST",(l=n.ChessModel||(n.ChessModel={}))[l.CHESS_MODEL_AROUND=1]="CHESS_MODEL_AROUND",l[l.CHESS_MODEL_RUN_AWAY=2]="CHESS_MODEL_RUN_AWAY";var u=cc.v2(-1,-1);n.INVALID_INDEX=u;var h=[cc.v2(0,1),cc.v2(0,-1),cc.v2(-1,0),cc.v2(1,0)];n.OPTIONAL_DIR=h;var p=[cc.v2(1,0),cc.v2(0,1),cc.v2(-1,0),cc.v2(0,-1)];n.OPTIONAL_DIR_1=p;var d=[cc.v2(0,1),cc.v2(1,0),cc.v2(-1,0),cc.v2(1,0)];n.OPTIONAL_DIR_2=d;var m=[cc.v2(0,1),cc.v2(-1,0),cc.v2(1,0),cc.v2(0,1)];n.OPTIONAL_DIR_3=m;var f=[cc.v2(-1,0),cc.v2(0,1),cc.v2(0,-1),cc.v2(1,0)];n.OPTIONAL_DIR_4=f;var y=[cc.v2(-1,0),cc.v2(0,-1),cc.v2(0,1),cc.v2(1,0)];n.OPTIONAL_DIR_5=y;var g=[cc.v2(0,-1),cc.v2(-1,0),cc.v2(1,0),cc.v2(0,1)];n.OPTIONAL_DIR_6=g;var C=[cc.v2(0,-1),cc.v2(1,0),cc.v2(-1,0),cc.v2(0,1)];n.OPTIONAL_DIR_7=C;var _=[cc.v2(1,0),cc.v2(0,-1),cc.v2(0,1),cc.v2(-1,0)];n.OPTIONAL_DIR_8=_;var v=[cc.v2(1,0),cc.v2(1,1),cc.v2(0,1),cc.v2(-1,1),cc.v2(-1,0),cc.v2(-1,-1),cc.v2(0,-1),cc.v2(1,-1)];n.OPTIONAL_DIR_9=v;n.OnGlodChangeKey="OnGoldChange";n.OnPowerChangeKey="OnPowerChange";var I;n.OnGotAchievementKey="OnGotAchievement",(I=n.PromptType||(n.PromptType={}))[I.Invalid=0]="Invalid",I[I.GoldInsufficient=1]="GoldInsufficient",I[I.PowerInsufficient=2]="PowerInsufficient",I[I.ExperienceInsufficient=3]="ExperienceInsufficient";n.OnPromptKey="OnPrompt";n.PREFABS_RES_PATH="Prefabs/Chess/";n.LevelMaxStars=3;var P="";n.SceneKey=P;var b=.5;n.SceneFadeTime=b;n.GateID="GateID";n.GameIDs="GameIDs";n.ChapterID="ChapterID";n.LevelID="LevelID";n.GameType="GameType";n.IsGuideKey="IsGuide";n.MusicVolumeKey="MusicVolume";n.SoundVolumeKey="SoundVolume";n.OnMapChangeKey="OnMapChange";n.OnLevelChangKey="OnLevelChange";n.LoadingSceneKey="Loading";n.MainSceneKey="Main";n.GuideSceneKey="Guide";n.ChessSceneKey="Chess";n.LevelMapKey="LevelMap";n.MISSION_CACHE_DATA_KEY="MISSION_CACHE_DATA_KEY";n.UNLOCK_CHAPTERS_CACHE_KEY="UNLOCK_CHAPTERS_CACHE_KEY";n.HTTP_SERVER_HOST="https://consumer.xswq361.cn";n.HTTP_PLAY_CHESS_AI_HOST="https://consumer.xswq361.cn/";n.WEB_SOCKET_IP="consumer.xswq361.cn:9898/WeiQi";n.HTTP_PLAY_CHESS_AI_METHOD="consumerXSWQ/GodController/DoAI";n.HTTP_PLAY_CHESS_TAKE_CHESS="consumerXSWQ/GodController/takeChess";n.HTTP_PLAY_CHESS_RESULT="consumerXSWQ/GodController/getCompleteResult";n.HTTP_GET_USER_INFO="consumerXSWQ/UserInfoController/getUserInfo",n.LoadingScene=function(e){n.SceneKey=P=e,cc.director.loadScene(e)},n.FadeIn=function(o){cc.loader.loadRes("Prefabs/Loading/BG",function(e,t){var n=cc.instantiate(t);n.opacity=0,cc.director.getScene().getChildByName("Canvas").addChild(n),n.runAction(cc.sequence(cc.fadeIn(b),cc.callFunc(function(){cc.director.loadScene(o)})))})},n.SetTimeOut=function(e,t,n,o){void 0===n&&(n=null);var r=cc.delayTime(t),i=null;return i=o?cc.repeat(cc.sequence(r,cc.callFunc(e)),o):cc.repeatForever(cc.sequence(r,cc.callFunc(e))),n.runAction(i),i},cc._RF.pop()},{}],ConfirmAnimation:[function(e,t,n){"use strict";cc._RF.push(t,"56f299b9+pB96r1S/7L1hZl","ConfirmAnimation"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animaName="BlackChessUnconfirm",e.mAnima=null,e.mConfirmed=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.mAnima=this.getComponent(cc.Animation),this.node.on(o.UnitEvent.ON_PUT_IN,this.onPutBoard,this),this.node.on(o.UnitEvent.ON_TAKE_OUT,this.onTakeOutBoard,this),this.node.on(o.UnitEvent.ON_CONFIRM,this.onConfirm,this),this.node.on(o.UnitEvent.ON_UNUSE,this.onUnuse,this)},e.prototype.start=function(){},e.prototype.onPutBoard=function(){if(!this.mConfirmed){var e=this.mAnima.playAdditive(this.animaName);e.wrapMode=cc.WrapMode.PingPong,e.repeatCount=1/0}this.node.opacity=255},e.prototype.onTakeOutBoard=function(){},e.prototype.onUnuse=function(){this.mConfirmed=!1,this.mAnima.targetOff(this),this.unscheduleAllCallbacks()},e.prototype.onConfirm=function(){this.mConfirmed=!0,this.mAnima.getAnimationState(this.animaName).stop(),this.node.opacity=255},__decorate([s],e.prototype,"animaName",void 0),e=__decorate([i,a("Game/GameLogic/Chess/ConfirmAnimation")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],DestChess:[function(e,t,n){"use strict";cc._RF.push(t,"d77035jJ7FG/6gyqgaegjUy","DestChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Unit"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.belongChapter=0,e.mUnit=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this.mUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mUnit=this.getComponent(o.default)},e.prototype.start=function(){},e.prototype.onPutBoard=function(){},e.prototype.onTakeOutBoard=function(){},e=__decorate([i,s("Game/GameLogic/Chess/DestChess")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"./Unit":"Unit"}],FadeOutPage:[function(e,t,n){"use strict";cc._RF.push(t,"41c5f+V8zBJ25GgGXs7/h1z","FadeOutPage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=null,e}return __extends(e,t),e.prototype.onLoad=function(){var e=this;this.bg.node.runAction(cc.sequence(cc.fadeOut(o.SceneFadeTime),cc.callFunc(function(){e.node.active=!1})))},__decorate([s(cc.Sprite)],e.prototype,"bg",void 0),e=__decorate([i,a("Game/UI/Page/FadeOutPage")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],FlagChess:[function(e,t,n){"use strict";cc._RF.push(t,"1fddaYmPmFNZbjF+81zFj94","FlagChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Unit"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.belongChapter=0,e.mUnit=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this.mUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mUnit=this.getComponent(o.default)},e.prototype.start=function(){},e.prototype.onPutBoard=function(){},e.prototype.onTakeOutBoard=function(){},e=__decorate([i,s("Game/GameLogic/Chess/BlockChess")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"./Unit":"Unit"}],GameGlobal:[function(e,t,n){"use strict";cc._RF.push(t,"64f06QiHM9KuY6MtdepXRbM","GameGlobal"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./GameSettings/GameInfo"),r=e("./Net/NetWork"),i=e("./ResourcesCtrl/ResourceMgr"),s=e("./GameLogic/Player/LocalPlayer"),a=e("./GameSettings/Localization"),c=e("./Manager/AudioEngineManager"),l=e("./Common/CommonDef"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.executionOrder,m=u.menu,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.debugMode=!0,e.firstSceneName="",e.initFinished=new Array,e.mInited=!1,e.mGameInfo=null,e.mNetWork=null,e.mResourceMgr=null,e.mLocalPlayer=null,e.mLocalization=null,e.mAudioEngine=null,e.mDataCache=new Map,e}return __extends(e,t),(n=e).getGlobal=function(){return n.gGlobal?n.gGlobal:(cc.error("[GameGlobal.getGlobal] inital game first."),null)},Object.defineProperty(e.prototype,"gameInfo",{get:function(){return this.mInited?this.mGameInfo:(cc.error("[GameGlobal.gameInfo] inital game first."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"netWork",{get:function(){return this.mInited?this.mNetWork:(cc.error("[GameGlobal.netWork] inital game first."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourceMgr",{get:function(){return this.mInited?this.mResourceMgr:(cc.error("[GameGlobal.resourceMgr] inital game first."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localPlayer",{get:function(){return this.mInited?this.mLocalPlayer:(cc.error("[GameGlobal.localPlayer] inital game first."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localization",{get:function(){return this.mInited?this.mLocalization:(cc.error("[GameGlobal.localization] inital game first."),null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioEngine",{get:function(){return this.mInited?this.mAudioEngine:(cc.error("[GameGlobal.localization] inital game first."),null)},enumerable:!0,configurable:!0}),e.prototype.cacheData=function(e,t){this.mDataCache.set(e,t)},e.prototype.getData=function(e){return this.mDataCache.get(e)},e.prototype.hasData=function(e){return this.mDataCache.has(e)},e.prototype.popData=function(e){var t=this.mDataCache.get(e);return this.mDataCache.delete(e),t},e.prototype.onLoad=function(){cc._initDebugSetting(cc.DebugMode.INFO),cc.log("[GameGlobal.onLoad] game on load."),cc.game.addPersistRootNode(this.node),cc.loader.setAutoReleaseRecursively(this.node.uuid,!1),this.init().catch(function(e){cc.error("[GameGlobal.onLoad]",e.message)})},e.prototype.start=function(){},e.prototype.onDestroy=function(){cc.info("[GameGlobal.onDestroy] game closing.")},e.prototype.hideMainBg=function(){this.node.getChildByName("bgMain").active=!1},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return cc.info("inital game."),cc.game.on(cc.game.EVENT_HIDE,this.onGameHide,this),cc.game.on(cc.game.EVENT_SHOW,this.onGameShow,this),this.mGameInfo=this.getComponentInChildren(o.default),this.mNetWork=this.getComponentInChildren(r.default),this.mNetWork.initNetWork(),this.mResourceMgr=this.getComponentInChildren(i.default),this.mLocalPlayer=this.getComponentInChildren(s.default),this.mLocalization=this.getComponentInChildren(a.default),this.mAudioEngine=this.getComponentInChildren(c.default),this.mAudioEngine.LoadBGMusic().catch(function(e){cc.error("[AudioEngine.LoadBGMusic]",e.message)}),[4,this.mResourceMgr.init()];case 1:return e.sent(),cc.info("inital game success."),(n.gGlobal=this).mInited=!0,0<this.initFinished.length&&this.initFinished.forEach(function(e){return e.emit([])}),this.firstSceneName&&0<this.firstSceneName.length?[4,this.connectAndLoad()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.connectAndLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,n.getGlobal().netWork.connectTo()];case 1:return e.sent(),[4,n.getGlobal().localPlayer.login(16444131)];case 2:return e.sent(),cc.sys.localStorage.getItem(l.IsGuideKey),l.LoadingScene(l.ChessSceneKey),[2]}})})},e.prototype.onGameHide=function(e){cc.log("[GameGlobal.onGameHide] game hide.")},e.prototype.onGameShow=function(e){cc.log("[GameGlobal.onGameShow] game show.")},e.gGlobal=null,__decorate([p],e.prototype,"debugMode",void 0),__decorate([p],e.prototype,"firstSceneName",void 0),__decorate([p({type:[cc.Component.EventHandler]})],e.prototype,"initFinished",void 0),e=n=__decorate([h,d(-10),m("Game/GameGlobal")],e);var n}(cc.Component);n.default=f,cc._RF.pop()},{"./Common/CommonDef":"CommonDef","./GameLogic/Player/LocalPlayer":"LocalPlayer","./GameSettings/GameInfo":"GameInfo","./GameSettings/Localization":"Localization","./Manager/AudioEngineManager":"AudioEngineManager","./Net/NetWork":"NetWork","./ResourcesCtrl/ResourceMgr":"ResourceMgr"}],GameInfo:[function(e,t,n){"use strict";cc._RF.push(t,"f9140j4YUdLLY0b8D5ZBXfa","GameInfo"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showStats=!0,e.autoFullScreen=!0,e.mGameStartTime=cc.sys.now(),e}return __extends(e,t),Object.defineProperty(e.prototype,"elapsedTime",{get:function(){return cc.sys.now()-this.mGameStartTime},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){cc.director.setDisplayStats(this.showStats),cc.sys.platform!=cc.sys.WECHAT_GAME&&cc.view.enableAutoFullScreen(this.autoFullScreen),cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE),cc.view.adjustViewPort(!0)},e.prototype.start=function(){},__decorate([i],e.prototype,"showStats",void 0),__decorate([i],e.prototype,"autoFullScreen",void 0),e=__decorate([r,s("Game/GameSettings/GameInfo")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],GuidePage:[function(e,t,n){"use strict";cc._RF.push(t,"73897KADq1Mtq4dskAizbv8","GuidePage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=e("../../GameGlobal"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.guide1=null,e.guide2=null,e.promptButton=null,e.prompt=null,e}return __extends(e,t),e.prototype.start=function(){r.default.getGlobal().audioEngine.PlayBackgroundMusic(),this.ShowGuide1()},e.prototype.ShowGuide1=function(){var e=this;this.guide1.node.active=!0;var t=cc.scaleTo(.5,1,1),n=cc.delayTime(.5);this.guide1.node.runAction(cc.sequence(t,n,cc.callFunc(function(){e.prompt.string="下一页",e.promptButton.node.active=!0,e.promptButton.node.on("click",function(){r.default.getGlobal().audioEngine.PlayButtonSound(),e.promptButton.node.active=!1,e.HideGuide1()})})))},e.prototype.HideGuide1=function(){var e=this,t=cc.scaleTo(.5,1,0);this.guide1.node.runAction(cc.sequence(t,cc.callFunc(function(){e.guide1.node.active=!1,e.ShowGuide2()})))},e.prototype.ShowGuide2=function(){var e=this;this.guide2.node.active=!0;var t=cc.scaleTo(.5,1,1),n=cc.delayTime(.5);this.guide2.node.runAction(cc.sequence(t,n,cc.callFunc(function(){e.prompt.string="进入游戏",e.promptButton.node.active=!0,e.promptButton.node.on("click",function(){cc.sys.localStorage.setItem(o.IsGuideKey,1),r.default.getGlobal().audioEngine.PlayButtonSound(),o.FadeIn(o.MainSceneKey)})})))},__decorate([a(cc.Sprite)],e.prototype,"guide1",void 0),__decorate([a(cc.Sprite)],e.prototype,"guide2",void 0),__decorate([a(cc.Button)],e.prototype,"promptButton",void 0),__decorate([a(cc.Label)],e.prototype,"prompt",void 0),e=__decorate([s,c("Game/UI/Page/GuidePage")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal"}],Heap:[function(e,t,n){"use strict";cc._RF.push(t,"9953fyHbSJCDY/3jfzK45a1","Heap"),Object.defineProperty(n,"__esModule",{value:!0});var c=function(e,t){return e<t?-1:t<e?1:0},l=function(e,t,n,o){var r,i,s;for(null==o&&(o=c),r=e[n];t<n&&o(r,i=e[s=n-1>>1])<0;)e[n]=i,n=s;return e[n]=r},u=function(e,t,n){var o,r,i,s,a;for(null==n&&(n=c),r=e.length,i=e[a=t],o=2*t+1;o<r;)(s=o+1)<r&&!(n(e[o],e[s])<0)&&(o=s),e[t]=e[o],o=2*(t=o)+1;return e[t]=i,l(e,a,t,n)},o=function(n,e){var t,o,r,i,s,a;for(null==e&&(e=c),s=[],o=0,r=(i=function(){a=[];for(var e=0,t=Math.floor(n.length/2);0<=t?e<t:t<e;0<=t?e++:e--)a.push(e);return a}.apply(this).reverse()).length;o<r;o++)t=i[o],s.push(u(n,t,e));return s},r=function(e,t){var n,o;return null==t&&(t=c),n=e.pop(),e.length?(o=e[0],e[0]=n,u(e,0,t)):o=n,o},i=function(e,t,n){var o;return null==n&&(n=c),e.length&&n(e[0],t)<0&&(t=(o=[e[0],t])[0],e[0]=o[1],u(e,0,n)),t},s=function(){function t(e){this.mData=new Array,this.mCmp=e||c}return t.prototype.push=function(e){var t,n,o;t=this.mData,n=e,null==(o=this.mCmp)&&(o=c),t.push(n),l(t,0,t.length-1,o)},t.prototype.pop=function(){return r(this.mData,this.mCmp)},t.prototype.top=function(){return this.mData[0]},t.prototype.replace=function(e){return t=this.mData,n=e,null==(o=this.mCmp)&&(o=c),r=t[0],t[0]=n,u(t,0,o),r;var t,n,o,r},t.prototype.pushpop=function(e){return i(this.mData,e,this.mCmp)},t.prototype.heapify=function(){o(this.mData,this.mCmp)},t.prototype.updateItem=function(e){(function(e,t,n){var o;if(null==n&&(n=c),-1!==(o=e.indexOf(t)))l(e,0,o,n),u(e,o,n)})(this.mData,e,this.mCmp)},t.prototype.empty=function(){return 0===this.mData.length},t.prototype.size=function(){return this.mData.length},t.prototype.toArray=function(){return this.mData.slice(0)},t.prototype.copy=function(){var e=new t;return e.mCmp=this.mCmp,e.mData=this.mData.slice(0),e},t.prototype.clear=function(){this.mData.splice(0)},t}();n.default=s,cc._RF.pop()},{}],HttpConnection:[function(e,t,n){"use strict";cc._RF.push(t,"ca2f2d3M1tIOY6u/leZBb+1","HttpConnection"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.url="http://210.12.48.108",e.mHttpReq=new XMLHttpRequest,e.mCurrentRequestResolve=null,e.mCurrentRequestReject=null,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.mHttpReq.onreadystatechange=function(e){t.onStateChanged()}},e.prototype.start=function(){},e.prototype.onDestroy=function(){this.mHttpReq.onreadystatechange=function(){}},e.prototype.post=function(t,o,r){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return console.log("http connection is url "+t+"method---"+o),this.mHttpReq.open("POST",t+o,!0),this.mHttpReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.mHttpReq.send(r),[2,new Promise(function(e,t){n.mCurrentRequestResolve=e,n.mCurrentRequestReject=t})]})})},e.prototype.get=function(t,o,r){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return console.log("http connection is url "+t+"method---"+o),console.log("http url is  "+t+o+r),this.mHttpReq.open("GET",t+o,!0),this.mHttpReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.mHttpReq.send(r),[2,new Promise(function(e,t){n.mCurrentRequestResolve=e,n.mCurrentRequestReject=t})]})})},e.prototype.onStateChanged=function(){400<=this.mHttpReq.status&&(this.mCurrentRequestReject(new Error("http response code "+this.mHttpReq.status+".")),this.mCurrentRequestReject=null,this.mCurrentRequestResolve=null),4==this.mHttpReq.readyState&&200<=this.mHttpReq.status&&this.mHttpReq.status<400&&(this.mCurrentRequestResolve(this.mHttpReq.responseText),this.mCurrentRequestReject=null,this.mCurrentRequestResolve=null)},__decorate([i],e.prototype,"url",void 0),e=__decorate([r,s("Game/Net/HttpConnection")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],ICoder:[function(e,t,n){"use strict";cc._RF.push(t,"79494uWVW1Ep5uxLgzGckm/","ICoder"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],LevelButton:[function(e,t,n){"use strict";cc._RF.push(t,"9e75eV44BFLRbqOnlggLN/u","LevelButton"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=e("../Other/LevelStar"),i=e("../../GameGlobal"),s=e("./UnlockButton"),a=cc._decorator,c=a.ccclass,l=a.property,u=a.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stars=null,e.buttonSprite=null,e.buttonIcon=null,e.buttonLockIcon=null,e.unlockButton=null,e.chapterId=0,e.levelId=0,e.levelButton=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.levelButton=this.getComponent(cc.Button)},e.prototype.Init=function(e,t){cc.log("关卡ID:"+t),this.chapterId=e,this.levelId=t;var n=i.default.getGlobal().localPlayer.GetLevelStars(this.chapterId,this.levelId);0==n?1==this.levelId?this.SetLock(!1):0==i.default.getGlobal().localPlayer.GetLevelStars(this.chapterId,this.levelId-1)?this.SetLock(!0):this.SetLock(!1):this.SetLock(!1);this.SetStars(n)},e.prototype.LevelButtonOnClick=function(e){i.default.getGlobal().audioEngine.PlayButtonSound();var t=new cc.Event.EventCustom(o.OnLevelChangKey,!0);t.setUserData(this),this.node.dispatchEvent(t)},e.prototype.SetLock=function(e){e?(this.buttonSprite.spriteFrame=this.buttonLockIcon,this.levelButton.node.off("click",function(){})):(this.buttonSprite.spriteFrame=this.buttonIcon,this.levelButton.node.on("click",this.LevelButtonOnClick,this))},e.prototype.SetStars=function(e){this.stars.Init(e)},e.prototype.SetUnlockEffect=function(){var e=this;return cc.sequence(cc.delayTime(0),cc.callFunc(function(){e.unlockButton.PlayUnlock(),e.SetLock(!1)}))},__decorate([l(r.default)],e.prototype,"stars",void 0),__decorate([l(cc.Sprite)],e.prototype,"buttonSprite",void 0),__decorate([l(cc.SpriteFrame)],e.prototype,"buttonIcon",void 0),__decorate([l(cc.SpriteFrame)],e.prototype,"buttonLockIcon",void 0),__decorate([l(s.default)],e.prototype,"unlockButton",void 0),e=__decorate([c,u("Game/UI/Button/LevelButton")],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../Other/LevelStar":"LevelStar","./UnlockButton":"UnlockButton"}],LevelMap:[function(e,t,n){"use strict";cc._RF.push(t,"7a42f24GFBMwJL607e3xfXX","LevelMap"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Button/LevelButton"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levels=new Array,e}return __extends(e,t),e.prototype.start=function(){},__decorate([s({type:o.default})],e.prototype,"levels",void 0),e=__decorate([i,a("Game/UI/Other/LevelMap")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../Button/LevelButton":"LevelButton"}],LevelPage:[function(e,t,n){"use strict";cc._RF.push(t,"1c996R0n3RIb4P+wIzey/ns","LevelPage"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../Button/LevelButton"),i=e("../Other/LevelMap"),s=e("../../Common/CommonDef"),a=e("../../GameGlobal"),o=e("./BasePage"),c=e("../Role/XiaoTian"),l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chapterId=-1,e.username=null,e.energy=null,e.gold=null,e.levelScrollView=null,e.npc=null,e.playNode=null,e.playButton=null,e.returnButton=null,e.occlusion=null,e.levelMap=null,e.currentLevel=null,e.levelButtons=null,e.currentIndex=0,e.targetIndex=0,e.playButtonOffset=210,e.npcOffset=10,e.npcMoveSpeed=250,e.onOcclusionShow=null,e.onOcclusionHide=null,e.onDeltaData=null,e.onNPCMove=null,e}return __extends(e,t),e.prototype.start=function(){a.default.getGlobal().audioEngine.PlayBackgroundMusic(),a.default.getGlobal().audioEngine.PlaySceneMusic(this.chapterId),a.default.getGlobal().localPlayer.AddObserverList(this.node),this.HidePlayButton(),this.levelMap=this.levelScrollView.getComponent(i.default),this.levelButtons=this.levelMap.levels,this.node.on(s.OnLevelChangKey,this.OnLevelChange,this),this.node.on(s.OnGlodChangeKey,this.OnGlodChange,this),this.node.on(s.OnPowerChangeKey,this.OnPowerChange,this),this.playButton.node.on("click",this.PlayButtonOnClick,this),this.returnButton.node.on("click",this.ReturnButtonOnClick,this),cc.game.setFrameRate(60),this.Init().catch(function(e){cc.error("[LevelPage.onLoad]",e.message)}),this.RegisterPrompt()},e.prototype.onDestroy=function(){a.default.getGlobal().localPlayer.RemoveObserverList(this.node),this.DestroyBaseActions(),this.DestroyActions()},e.prototype.OnLevelChange=function(e){var t=e.getUserData();this.currentLevel!=t&&(this.HidePlayButton(),this.NPCMove(t)),e.stopPropagation()},e.prototype.OnGlodChange=function(e){cc.log("OnGlodChange"),this.SetGold()},e.prototype.OnPowerChange=function(e){cc.log("OnPowerChange"),this.energy.string=a.default.getGlobal().localPlayer.info.power.toString()+":"+a.default.getGlobal().resourceMgr.getGameCfg().player_cfg.power_upper_limit},e.prototype.Init=function(){return __awaiter(this,void 0,void 0,function(){var t,n,o=this;return __generator(this,function(e){switch(e.label){case 0:return cc.log("章节ID:"+this.chapterId),this.username.string=a.default.getGlobal().localPlayer.info.name,this.energy.string=a.default.getGlobal().localPlayer.info.power.toString()+":"+a.default.getGlobal().resourceMgr.getGameCfg().player_cfg.power_upper_limit,this.levelButtons.length!=a.default.getGlobal().localPlayer.GetChapterLevels(this.chapterId)&&cc.error("关卡数据与预制件关卡数据数量不一致，关卡："+cc.director.getScene().name+"\t关卡数量："+a.default.getGlobal().localPlayer.GetChapterLevels(this.chapterId)+"\t预制件关卡数量："+this.levelMap.levels.length),[4,a.default.getGlobal().localPlayer.GetChapterLevelData(this.chapterId).forEach(function(e){o.levelButtons[e.id-1].getComponent(r.default).Init(o.chapterId,e.id)})];case 1:return e.sent(),this.SetScene(),this.SetGold(),(t=a.default.getGlobal().popData(s.MISSION_CACHE_DATA_KEY))&&t.chaper==this.chapterId&&0<t.gotStars&&(t.gotStars>t.originalStars?(this.levelButtons[t.mission-1].SetStars(t.originalStars),this.gold.string=(this.GetGold()-t.deltaGolds).toString(),0==t.originalStars&&this.levelButtons.length>t.mission&&(this.levelButtons[t.mission].SetLock(!0),this.levelButtons[t.mission].SetStars(0)),this.occlusion.node.active=!0,n=cc.delayTime(.5),this.onOcclusionShow=cc.sequence(cc.scaleTo(.5,1,1),cc.callFunc(function(){o.onDeltaData=cc.sequence(o.levelButtons[t.mission-1].stars.SetStarsEffect(t.originalStars,t.gotStars),o.SetGoldEffect(t.deltaGolds),o.SetCurrentGold(),o.SetNextLevel(t.mission),n,cc.callFunc(function(){o.OnDeltaDataEffectComplete(t.mission)})),o.node.runAction(o.onDeltaData)})),this.occlusion.node.runAction(this.onOcclusionShow)):this.OnDeltaDataEffectComplete(t.mission)),[2]}})})},e.prototype.SetGoldEffect=function(e){var t=this,n=cc.delayTime(.01),o=this.GetGold()-e;return cc.repeat(cc.sequence(n,cc.callFunc(function(){o++,t.gold.string=o.toString()})),e)},e.prototype.SetCurrentGold=function(){var e=this,t=cc.delayTime(.01);return cc.sequence(t,cc.callFunc(function(){e.SetGold()}))},e.prototype.SetNextLevel=function(e){var t=null;if(this.levelButtons.length>e){var n=a.default.getGlobal().localPlayer.GetLevelStars(this.chapterId,e+1);n&&0!=n||(t=this.levelButtons[e].SetUnlockEffect())}return t},e.prototype.OnDeltaDataEffectComplete=function(e){var t=this;this.onOcclusionHide=cc.sequence(cc.scaleTo(.5,1,1.5),cc.callFunc(function(){t.occlusion.node.active=!1})),this.occlusion.node.runAction(this.onOcclusionHide),this.levelButtons.length>e&&this.node.emit(s.OnLevelChangKey,this.levelButtons[e])},e.prototype.SetGold=function(){this.gold.string=this.GetGold().toString()},e.prototype.GetGold=function(){return a.default.getGlobal().localPlayer.info.golds},e.prototype.SetScene=function(){var e=a.default.getGlobal().localPlayer.info.lastPlayMission,t=0,n=!1;if(e?this.chapterId==e.chapterID&&(this.currentLevel=this.levelButtons[e.missionID-1],t=e.missionID-1,n=!0):cc.error("未获取到玩家数据[lastPlayMission]"),this.npc.node.parent=this.levelScrollView.content,this.playNode.parent=this.levelScrollView.content,n){var o=this.currentLevel.node.getPosition();o.y+=this.npcOffset,this.npc.node.position=o,this.npc.PlayIdle(),this.SetPlayButton()}if(0<t){var r=this.levelScrollView.getComponent(i.default).levels[t].node.getPosition();r.x-=cc.Canvas.instance.designResolution.width/2,this.levelScrollView.scrollToOffset(r,0)}},e.prototype.NPCMove=function(e){this.npc.node.active?this.OnNPCOut(e):this.OnNPCEnter(e)},e.prototype.OnNPCOut=function(e){var t=this,n=this.npc.PlayOut(),o=cc.delayTime(n);this.onNPCMove=cc.sequence(o,cc.callFunc(function(){t.OnNPCEnter(e)})),this.npc.node.runAction(this.onNPCMove)},e.prototype.OnNPCEnter=function(e){var t=this;this.currentLevel=e;var n=this.currentLevel.node.getPosition();n.y+=this.npcOffset,this.npc.node.position=n;var o=this.npc.PlayEnter(),r=cc.delayTime(o);this.onNPCMove=cc.sequence(r,cc.callFunc(function(){t.npc.PlayIdle(),t.SetPlayButton()})),this.npc.node.runAction(this.onNPCMove)},e.prototype.OnNPCMove=function(t){var n=this;this.currentIndex=this.levelButtons.indexOf(this.currentLevel),this.targetIndex=this.levelButtons.indexOf(t),this.currentIndex!=this.targetIndex&&(this.currentIndex>this.targetIndex?this.currentIndex--:this.currentIndex++);var e=this.levelButtons[this.currentIndex].node.getPosition();e.y+=this.npcOffset;var o=cc.pDistance(e,this.npc.node.getPosition())/this.npcMoveSpeed;if(0<o){var r=cc.moveTo(o,e);this.onNPCMove=cc.sequence(r,cc.callFunc(function(e){n.currentIndex!=n.targetIndex?(n.currentLevel=n.levelButtons[n.currentIndex],n.OnNPCMove(t)):(n.currentLevel=t,n.SetPlayButton(),cc.log("移动完毕"))})),this.npc.node.runAction(this.onNPCMove)}},e.prototype.SetPlayButton=function(){var e=this.currentLevel.node.getPosition();this.playNode.setPosition(e.x,e.y+this.playButtonOffset),this.playNode.active=!0},e.prototype.HidePlayButton=function(){this.playNode.active=!1},e.prototype.PlayButtonOnClick=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return a.default.getGlobal().audioEngine.PlayStartGameSound(),a.default.getGlobal().localPlayer.isExperimentalUser&&3<this.chapterId?((t=new cc.Event.EventCustom(s.OnPromptKey,!1)).setUserData(s.PromptType.ExperienceInsufficient),this.node.dispatchEvent(t),[2]):(cc.log("当前关卡："+this.currentIndex+1),a.default.getGlobal().cacheData(s.ChapterID,this.chapterId),a.default.getGlobal().cacheData(s.LevelID,this.currentLevel.levelId),[4,a.default.getGlobal().localPlayer.startMission(this.chapterId,this.currentLevel.levelId)]);case 1:return e.sent(),s.FadeIn(s.ChessSceneKey),[2]}})})},e.prototype.ReturnButtonOnClick=function(e){a.default.getGlobal().audioEngine.PlayCloseButtonSound(),s.FadeIn(s.MainSceneKey)},e.prototype.DestroyActions=function(){this.onOcclusionShow,this.onOcclusionHide,this.onDeltaData,this.onNPCMove},__decorate([h],e.prototype,"chapterId",void 0),__decorate([h(cc.Label)],e.prototype,"username",void 0),__decorate([h(cc.Label)],e.prototype,"energy",void 0),__decorate([h(cc.Label)],e.prototype,"gold",void 0),__decorate([h(cc.ScrollView)],e.prototype,"levelScrollView",void 0),__decorate([h(c.default)],e.prototype,"npc",void 0),__decorate([h(cc.Node)],e.prototype,"playNode",void 0),__decorate([h(cc.Button)],e.prototype,"playButton",void 0),__decorate([h(cc.Button)],e.prototype,"returnButton",void 0),__decorate([h(cc.Sprite)],e.prototype,"occlusion",void 0),e=__decorate([u,p("Game/UI/Page/LevelPage")],e)}(o.default);n.default=d,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../Button/LevelButton":"LevelButton","../Other/LevelMap":"LevelMap","../Role/XiaoTian":"XiaoTian","./BasePage":"BasePage"}],LevelStar:[function(e,t,n){"use strict";cc._RF.push(t,"85bc9INBYxL+IsuqEw2TTg0","LevelStar"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stars=new Array,e}return __extends(e,t),e.prototype.Init=function(e){cc.log("stars:"+e);for(var t=0;t<this.stars.length;t++)this.stars[t].node.active=t<e},e.prototype.SetStarsEffect=function(e,t){var n=this,o=0,r=cc.delayTime(.3);return cc.repeat(cc.sequence(r,cc.callFunc(function(){n.stars[e+o].node.active=!0,o++})),t-e)},__decorate([i({type:[cc.Sprite]})],e.prototype,"stars",void 0),e=__decorate([r,s("Game/UI/Other/LevelStar")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],LoadingPage:[function(e,t,n){"use strict";cc._RF.push(t,"10747lfrxJAgYuB5ecVTjCI","LoadingPage"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../Common/CommonDef"),o=e("../../GameGlobal"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.progress=null,e.progressLabel=null,e.currentProgress=0,e.actualProgress=0,e}return __extends(e,t),e.prototype.onLoad=function(){var e=this;r.SetTimeOut(function(){e.currentProgress<e.actualProgress&&(e.currentProgress+=.01,e.progress.progress=e.currentProgress,e.progressLabel.node.color!=cc.Color.BLUE&&.5<e.currentProgress&&(e.progressLabel.node.color=cc.Color.BLUE),e.progressLabel.string=Number.parseInt(""+100*e.currentProgress)+"%"),1<=e.currentProgress&&(cc.director.loadScene(r.SceneKey),o.default.getGlobal().localPlayer.OnExit(0))},.01,this.node)},e.prototype.start=function(){o.default.getGlobal().audioEngine.PlayBackgroundMusic(),this.LoadScene()},e.prototype.onDestroy=function(){this.node.stopAllActions()},e.prototype.LoadScene=function(){var o=this;cc.log("[LoadingPage.LoadScene] loading "+r.SceneKey),cc.loader.loadRes("Scenes/"+r.SceneKey,cc.SceneAsset,function(e,t,n){o.actualProgress=e/t},function(e,t){o.actualProgress=1})},__decorate([a(cc.ProgressBar)],e.prototype,"progress",void 0),__decorate([a(cc.Label)],e.prototype,"progressLabel",void 0),e=__decorate([s,c("Game/UI/Page/LoadingPage")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal"}],LocalPlayer:[function(e,t,n){"use strict";cc._RF.push(t,"551e5a34JVP95R03gAis0om","LocalPlayer"),Object.defineProperty(n,"__esModule",{value:!0});var g=e("../../Net/ProtoBuf/Msg"),C=e("../../GameGlobal"),o=e("../../Common/CommonDef"),_=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mInfo=null,e.mLogin=!1,e.mUseStepItem=!1,e.mUseTimeItem=!1,e.observerList=new Array,e.mUserID=void 0,e.mToken=void 0,e.mUserName=void 0,e.mUserKind=void 0,e.mGateId=void 0,e.mGameIds=[],e.mChapterId=void 0,e.mMissionId=void 0,e}return __extends(e,t),Object.defineProperty(e.prototype,"platOK",{get:function(){return!(!this.mUserID||!this.mUserName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLogin",{get:function(){return this.mLogin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){if(!this.isLogin)throw new Error("[LocalPlayer.info] player not login.");return this.mInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExperimentalUser",{get:function(){return null!=this.mUserKind&&0==this.mUserKind},enumerable:!0,configurable:!0}),e.prototype.login=function(u){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,i,s,a,c,l=this;return __generator(this,function(e){switch(e.label){case 0:if(cc.sys.isBrowser){if(t=window.location.search,n=new Map,-1!=t.indexOf("?"))for(o=t.substr(1),r=o.split("&"),i=0;i<r.length;i++)n.set(r[i].split("=")[0],unescape(r[i].split("=")[1]));n.has("userid")&&n.has("username")&&(this.mUserID=Number.parseInt(n.get("userid")),this.mUserName=decodeURIComponent(n.get("username"))),n.has("kind")&&(this.mUserKind=Number.parseInt(n.get("kind"))),n.has("gateid")&&(this.mGateId=Number.parseInt(n.get("gateid")),0<this.mGateId&&C.default.getGlobal().cacheData(_.GateID,this.mGateId)),n.has("gameid")&&(0<(s=n.get("gameid")).length&&(this.mGameIds=s.split(",")),0<this.mGameIds.length&&C.default.getGlobal().cacheData(_.GameIDs,this.mGameIds)),n.has("token")&&(this.mToken=n.get("token"))}return this.platOK&&(u=this.mUserID),a=g.protocol.PlayerLoginReq.create({playerUID:u}),[4,C.default.getGlobal().netWork.request(a,g.protocol.PlayerLoginRes,"Game.LoginPlayer").catch(function(e){cc.error("[LocalPlayer.login] failed . It's caused by ",e.message)})];case 1:return(c=e.sent())&&(this.mInfo=c.info,this.platOK&&(this.mInfo.name=this.mUserName),this.mLogin=!0,this.schedule(function(){l.refreshData()},C.default.getGlobal().resourceMgr.getGameCfg().player_cfg.recover_power_interval_secs+1,cc.macro.REPEAT_FOREVER)),[4,this.startMission(this.mChapterId,this.mMissionId)];case 2:return e.sent(),"token="+this.mToken+"&userid="+this.mUserID,[2]}})})},e.prototype.hasStepItem=function(){if(!this.isLogin)throw new Error("[LocalPlayer.hasStepItem] player not login.");return this.mInfo.hasStepItem},e.prototype.hasTimeItem=function(){if(!this.isLogin)throw new Error("[LocalPlayer.hasTimeItem] player not login.");return this.mInfo.hasTiemItem},e.prototype.useTimeItem=function(){if(!this.isLogin)throw new Error("[LocalPlayer.useTimeItem] player not login.");this.hasTimeItem()&&(this.mInfo.hasTiemItem=!1,this.mUseTimeItem=!0)},e.prototype.useStepItem=function(){if(!this.isLogin)throw new Error("[LocalPlayer.useStepItem] player not login.");this.hasStepItem()&&(this.mInfo.hasStepItem=!1,this.mUseStepItem=!0)},e.prototype.missionCheckOut=function(p,d,m,f,y){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,i,s,a,c,l,u,h;return __generator(this,function(e){switch(e.label){case 0:if(!this.isLogin)throw new Error("[LocalPlayer.missionCheck] player not login.");return t=g.protocol.MissionCheckOutReq.create({playerUID:this.mInfo.playerUID,useStepItem:this.mUseStepItem,useTimeItem:this.mUseTimeItem,misson:g.protocol.Mission.create({chapterID:p,missionID:d,stars:m}),isPlayerWin:y}),[4,C.default.getGlobal().netWork.request(t,g.protocol.MissionCheckOutRes,"Game.MissionCheckOut").catch(function(e){cc.error("[LocalPlayer.missionCheck] failed . It's caused by ",e.message)})];case 1:return(n=e.sent())?this.platOK?(o=this.info.missions.reduce(function(e,t){return e+t.stars},0),r=this.info.missions.reduce(function(e,t){return e+(0<t.stars?1:0)},0),i="advanceNum="+r+"&starNum="+o+"&userId="+this.mUserID,[4,C.default.getGlobal().netWork.httpRequest.post(_.HTTP_SERVER_HOST,"/gobangteach/GoGameController/updateGameData",i)]):[3,4]:[3,5];case 2:if(s=e.sent(),cc.log("[LocalPlayer.missionCheckOut] platform http response ",s),3!=m)return[3,4];if(!(f<3))return[3,4];for(a=!0,c=this.info.missions,l=C.default.getGlobal().resourceMgr.getChapterDataConfig(p).missions,u=function(e){var t=l[e],n=c.find(function(e){return e.chapterID==p&&e.missionID==t.id});if(!n||3!=n.stars)return a=!1,"break"},h=0;h<l.length&&"break"!==u(h);h++);return a?(cc.log("[ChessPlay.onWin] go achievement ",p),[4,this.gotAchievement(p)]):[3,4];case 3:e.sent(),e.label=4;case 4:this.updateInfo(n.currentInfo),e.label=5;case 5:return[2]}})})},e.prototype.buyItem=function(o){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:if(!this.isLogin)throw new Error("[LocalPlayer.buyItem] player not login.");return t=g.protocol.BuyItemReq.create({playerUID:this.mInfo.playerUID,itype:o}),[4,C.default.getGlobal().netWork.request(t,g.protocol.BuyItemRes,"Game.BuyItem").catch(function(e){cc.error("[LocalPlayer.buyItem] failed . It's caused by ",e.message)})];case 1:return(n=e.sent())&&this.updateInfo(n.currentInfo),[2]}})})},e.prototype.startMission=function(o,r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:if(!this.isLogin)throw new Error("[LocalPlayer.enterMission] player not login.");return t=g.protocol.MissionReq.create({playerUID:this.info.playerUID,misson:g.protocol.Mission.create({chapterID:o,missionID:r})}),[4,C.default.getGlobal().netWork.request(t,g.protocol.MissionRes,"Game.StartMission").catch(function(e){cc.error("[LocalPlayer.startMission] failed . It's caused by ",e.message)})];case 1:return(n=e.sent())&&this.updateInfo(n.currentInfo),[2]}})})},e.prototype.updateInfo=function(e){this.mInfo.golds=e.golds,this.mInfo.hasStepItem=e.hasStepItem,this.mInfo.hasTiemItem=e.hasTiemItem,this.mInfo.power=e.power,this.ObserverListOnEvents()},e.prototype.AddObserverList=function(e){-1==this.observerList.indexOf(e)&&this.observerList.push(e)},e.prototype.RemoveObserverList=function(e){var t=this.observerList.indexOf(e);-1<t&&this.observerList.splice(t,1)},e.prototype.ObserverListOnEvents=function(t){this.observerList&&0<this.observerList.length&&this.observerList.forEach(function(e){e.emit(o.OnGlodChangeKey),e.emit(o.OnPowerChangeKey),e.emit(o.OnGotAchievementKey,t)})},e.prototype.GetHasTotalStars=function(){var t=0;return this.info.missions.forEach(function(e){t+=e.stars}),t},e.prototype.GetHasChapterStars=function(t){var n=0;return this.info.missions.forEach(function(e){e.chapterID==t&&(n+=e.stars)}),n},e.prototype.GetChapterLevels=function(e){return this.GetChapterLevelData(e).length},e.prototype.GetChapterLevelData=function(e){return C.default.getGlobal().resourceMgr.getChapterDataConfig(e).missions},e.prototype.GetChapterStars=function(e){return this.GetChapterLevels(e)*o.LevelMaxStars},e.prototype.GetChapter=function(e){return C.default.getGlobal().resourceMgr.getChapterCfg(e)},e.prototype.OnExit=function(e){cc.sys.isBrowser&&cc.sys.isMobile&&(window.location.href="myschema://go?a="+Math.floor(e),console.log("game--OnExit---",e))},e.prototype.OnPlayeAudio=function(e){console.log("OnPlayeAudio---",e),cc.sys.isBrowser&&cc.sys.isMobile&&(window.location.href="myschema://go?a=13&music="+e)},e.prototype.GetLevelStars=function(t,n){var e=this.info.missions.find(function(e){return e.chapterID==t&&e.missionID==n});return e?e.stars:0},e.prototype.gotAchievement=function(r){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(e){switch(e.label){case 0:switch(t=null,r){case 1:t="CRMJ";break;case 2:t="AYSL";break;case 3:t="XSZL";break;case 4:t="YLTX";break;case 5:t="SMLZ";break;case 6:t="SQJZT";break;case 7:t="HSQY";break;case 8:t="TCHS";break;case 9:t="HHXK";break;default:return[2]}return n="achievement="+t+"&userId="+this.mUserID,[4,C.default.getGlobal().netWork.httpRequest.post(_.HTTP_SERVER_HOST,"/gobangteach/GoGameController/updateGameAchievement",n)];case 1:return o=e.sent(),this.ObserverListOnEvents(r),cc.log("[LocalPlayer.gotAchievement] platform http response ",o),[2]}})})},e.prototype.refreshData=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=g.protocol.RefreshDataReq.create({playerUID:this.mInfo.playerUID}),[4,C.default.getGlobal().netWork.request(t,g.protocol.RefreshDataRes,"Game.RefreshData").catch(function(e){cc.error("[LocalPlayer.refreshData] failed . It's caused by ",e.message)})];case 1:return(n=e.sent())&&(cc.log("[LocalPlayer.refreshData]"),this.updateInfo(n.currentInfo)),[2]}})})},e=__decorate([i,s("Game/GameLogic/Player/LocalPlayer")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../../Net/ProtoBuf/Msg":"Msg"}],Localization:[function(e,t,n){"use strict";cc._RF.push(t,"6b11aNk52dBxanvHmUjvyH7","Localization"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mStringTable=new Map,e.language=n.LANGUAGE_CH,e}return __extends(e,t),(n=e).prototype.onLoad=function(){this.mStringTable.set(n.UI_BATTLE_FIRST_ROUND_VALUE,["先手值:","first round:"])},e.prototype.getString=function(e){var t=this.mStringTable.get(e);return t?t[this.language-1]:"NOT FOUND"},e.prototype.start=function(){},e.LANGUAGE_CH=1,e.LANGUAGE_EN=2,e.UI_BATTLE_FIRST_ROUND_VALUE="UI_BATTLE_FIRST_ROUND_VALUE",__decorate([i],e.prototype,"language",void 0),e=n=__decorate([r,s("Game/GameSettings/Localization")],e);var n}(cc.Component);n.default=a,cc._RF.pop()},{}],MainPage:[function(e,t,n){"use strict";cc._RF.push(t,"16381TnyedL/pzMO1mib3sT","MainPage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=e("../../GameGlobal"),i=e("../Button/MapButton"),s=e("../Role/XiaoTian"),a=cc._decorator,c=a.ccclass,l=a.property,u=a.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.username=null,e.energy=null,e.gold=null,e.shopButton=null,e.setButton=null,e.levels=new Array,e.npc=null,e.shopPage=null,e.setPage=null,e.occlusion=null,e.npcOffset=5,e.onOcclusionShow=null,e.onOcclusionHide=null,e.onDeltaData=null,e}return __extends(e,t),e.prototype.onLoad=function(){var e=this;r.default.getGlobal().audioEngine.LoadSound(),r.default.getGlobal().localPlayer.AddObserverList(this.node),this.node.on(o.OnMapChangeKey,this.OnMapChange,this),this.node.on(o.OnGlodChangeKey,this.OnGlodChange,this),this.node.on(o.OnPowerChangeKey,this.OnPowerChange,this),this.shopButton.node.on("click",function(){r.default.getGlobal().audioEngine.PlayButtonSound(),e.shopPage.active=!0},this),this.setButton.node.on("click",function(){r.default.getGlobal().audioEngine.PlayButtonSound(),e.setPage.active=!0},this)},e.prototype.start=function(){var t=this;this.username.string=r.default.getGlobal().localPlayer.info.name,this.energy.string=r.default.getGlobal().localPlayer.info.power.toString()+":"+r.default.getGlobal().resourceMgr.getGameCfg().player_cfg.power_upper_limit,this.gold.string=r.default.getGlobal().localPlayer.info.golds.toString(),this.SetNPCPosition(),cc.game.setFrameRate(30);var e=r.default.getGlobal().popData(o.UNLOCK_CHAPTERS_CACHE_KEY);e&&(e.forEach(function(e){t.levels.length>=e&&t.levels[e-1].SetLock(!0)}),this.occlusion.node.active=!0,this.onOcclusionShow=cc.sequence(cc.scaleTo(.5,1,1),cc.callFunc(function(){t.onDeltaData=cc.sequence(t.SetNextMap(e),cc.callFunc(function(){t.OnDeltaDataEffectComplete()})),t.node.runAction(t.onDeltaData)})),this.occlusion.node.runAction(this.onOcclusionShow))},e.prototype.onDestroy=function(){r.default.getGlobal().localPlayer.RemoveObserverList(this.node)},e.prototype.SetNextMap=function(e){var t=this,n=new Array,o=null;return 1==e.length&&this.levels.length>=e[0]?o=this.levels[e[0]-1].SetUnlockEffect():(e.forEach(function(e){t.levels.length>=e&&n.push(t.levels[e-1].SetUnlockEffect())}),o=cc.spawn(n)),null==o&&(o=cc.delayTime(.1)),o},e.prototype.OnDeltaDataEffectComplete=function(){var e=this;cc.log("关卡增量数据显示完成！！！"),this.onOcclusionHide=cc.sequence(cc.scaleTo(.5,1,1.5),cc.callFunc(function(){e.occlusion.node.active=!1})),this.occlusion.node.runAction(this.onOcclusionHide)},e.prototype.OnMapChange=function(e){var t=e.getUserData();o.FadeIn(o.LevelMapKey+t),e.stopPropagation()},e.prototype.OnGlodChange=function(e){cc.log("OnGlodChange"),this.gold.string=r.default.getGlobal().localPlayer.info.golds.toString()},e.prototype.OnPowerChange=function(e){cc.log("OnPowerChange"),this.energy.string=r.default.getGlobal().localPlayer.info.power.toString()+":"+r.default.getGlobal().resourceMgr.getGameCfg().player_cfg.power_upper_limit},e.prototype.SetNPCPosition=function(){var e=r.default.getGlobal().localPlayer.info.lastPlayMission;if(e){var t=this.levels[e.chapterID-1].node.getPosition();t.y+=this.npcOffset,this.npc.node.position=t,this.npc.PlayIdle()}else cc.error("未获取到玩家数据[lastPlayMission]")},__decorate([l(cc.Label)],e.prototype,"username",void 0),__decorate([l(cc.Label)],e.prototype,"energy",void 0),__decorate([l(cc.Label)],e.prototype,"gold",void 0),__decorate([l(cc.Button)],e.prototype,"shopButton",void 0),__decorate([l(cc.Button)],e.prototype,"setButton",void 0),__decorate([l({type:[i.default]})],e.prototype,"levels",void 0),__decorate([l(s.default)],e.prototype,"npc",void 0),__decorate([l(cc.Node)],e.prototype,"shopPage",void 0),__decorate([l(cc.Node)],e.prototype,"setPage",void 0),__decorate([l(cc.Sprite)],e.prototype,"occlusion",void 0),e=__decorate([c,u("Game/UI/Page/MainPage")],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../Button/MapButton":"MapButton","../Role/XiaoTian":"XiaoTian"}],MapButton:[function(e,t,n){"use strict";cc._RF.push(t,"d40fedaeElFTJ4CYFqFpyqo","MapButton"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=e("../../GameGlobal"),i=e("./UnlockButton"),s=cc._decorator,a=s.ccclass,c=s.property,l=s.menu,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.starLabel=null,e.mapIndex=0,e.buttonSprite=null,e.buttonIcon=null,e.buttonLockIcon=null,e.unlockButton=null,e.mapButton=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mapButton=this.getComponent(cc.Button),this.Init()},e.prototype.Init=function(){},e.prototype.MapButtonOnClick=function(e){r.default.getGlobal().audioEngine.PlayButtonSound();var t=new cc.Event.EventCustom(o.OnMapChangeKey,!0),n=this.mapIndex;t.setUserData(n),this.node.dispatchEvent(t)},e.prototype.SetLock=function(e){e?(this.buttonSprite.spriteFrame=this.buttonLockIcon,this.mapButton.node.off("click",function(){})):(this.buttonSprite.spriteFrame=this.buttonIcon,this.mapButton.node.on("click",this.MapButtonOnClick,this))},e.prototype.SetUnlockEffect=function(){var e=this.unlockButton.PlayUnlock(),t=cc.delayTime(e);return this.SetLock(!1),cc.sequence(t,cc.callFunc(function(){}))},__decorate([c(cc.Label)],e.prototype,"starLabel",void 0),__decorate([c(cc.Integer)],e.prototype,"mapIndex",void 0),__decorate([c(cc.Sprite)],e.prototype,"buttonSprite",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"buttonIcon",void 0),__decorate([c(cc.SpriteFrame)],e.prototype,"buttonLockIcon",void 0),__decorate([c(i.default)],e.prototype,"unlockButton",void 0),e=__decorate([a,l("Game/UI/Button/MapButton")],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","./UnlockButton":"UnlockButton"}],"Msg.d":[function(e,t,n){"use strict";cc._RF.push(t,"a432c7UdxRE7pBgBCmkX4L6","Msg.d"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){var t,n;(n=t||(t={}))[n.NULL=0]="NULL",n[n.REQUEST=1]="REQUEST",n[n.RESPONSE=2]="RESPONSE",n[n.NOTIFY=3]="NOTIFY",n[n.PUSH=4]="PUSH",n[n.HEARTBEAT=5]="HEARTBEAT";var o,r;(r=o||(o={}))[r.ITEM_TYPE_INVALID=0]="ITEM_TYPE_INVALID",r[r.ITEM_TYPE_STEP=1]="ITEM_TYPE_STEP",r[r.ITEM_TYPE_TIME=2]="ITEM_TYPE_TIME"}(n.protocol||(n.protocol={})),cc._RF.pop()},{}],Msg:[function(e,t,n){"use strict";cc._RF.push(t,"79ca2nfgt5FIbdVj16h4y3X","Msg");var o,r,i,s,a,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=protobuf,u=l.Reader,h=l.Writer,p=l.util,d=l.roots.default||(l.roots.default={});d.protocol=((a={}).Head=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.msgType=0,t.prototype.command="",t.prototype.sequence=0,t.prototype.extend=p.newBuffer([]),t.prototype.error="",t.prototype.customError="",t.prototype.errorForDebug="",t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.msgType&&e.hasOwnProperty("msgType")&&t.uint32(8).int32(e.msgType),null!=e.command&&e.hasOwnProperty("command")&&t.uint32(18).string(e.command),null!=e.sequence&&e.hasOwnProperty("sequence")&&t.uint32(24).int32(e.sequence),null!=e.extend&&e.hasOwnProperty("extend")&&t.uint32(34).bytes(e.extend),null!=e.error&&e.hasOwnProperty("error")&&t.uint32(42).string(e.error),null!=e.customError&&e.hasOwnProperty("customError")&&t.uint32(50).string(e.customError),null!=e.errorForDebug&&e.hasOwnProperty("errorForDebug")&&t.uint32(58).string(e.errorForDebug),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.Head;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.msgType=e.int32();break;case 2:o.command=e.string();break;case 3:o.sequence=e.int32();break;case 4:o.extend=e.bytes();break;case 5:o.error=e.string();break;case 6:o.customError=e.string();break;case 7:o.errorForDebug=e.string();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.msgType&&e.hasOwnProperty("msgType"))switch(e.msgType){default:return"msgType: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:}return null!=e.command&&e.hasOwnProperty("command")&&!p.isString(e.command)?"command: string expected":null!=e.sequence&&e.hasOwnProperty("sequence")&&!p.isInteger(e.sequence)?"sequence: integer expected":null!=e.extend&&e.hasOwnProperty("extend")&&!(e.extend&&"number"==typeof e.extend.length||p.isString(e.extend))?"extend: buffer expected":null!=e.error&&e.hasOwnProperty("error")&&!p.isString(e.error)?"error: string expected":null!=e.customError&&e.hasOwnProperty("customError")&&!p.isString(e.customError)?"customError: string expected":null!=e.errorForDebug&&e.hasOwnProperty("errorForDebug")&&!p.isString(e.errorForDebug)?"errorForDebug: string expected":null},t.fromObject=function(e){if(e instanceof d.protocol.Head)return e;var t=new d.protocol.Head;switch(e.msgType){case"NULL":case 0:t.msgType=0;break;case"REQUEST":case 1:t.msgType=1;break;case"RESPONSE":case 2:t.msgType=2;break;case"NOTIFY":case 3:t.msgType=3;break;case"PUSH":case 4:t.msgType=4;break;case"HEARTBEAT":case 5:t.msgType=5}return null!=e.command&&(t.command=String(e.command)),null!=e.sequence&&(t.sequence=0|e.sequence),null!=e.extend&&("string"==typeof e.extend?p.base64.decode(e.extend,t.extend=p.newBuffer(p.base64.length(e.extend)),0):e.extend.length&&(t.extend=e.extend)),null!=e.error&&(t.error=String(e.error)),null!=e.customError&&(t.customError=String(e.customError)),null!=e.errorForDebug&&(t.errorForDebug=String(e.errorForDebug)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.msgType=t.enums===String?"NULL":0,n.command="",n.sequence=0,n.extend=t.bytes===String?"":[],n.error="",n.customError="",n.errorForDebug=""),null!=e.msgType&&e.hasOwnProperty("msgType")&&(n.msgType=t.enums===String?d.protocol.MsgType[e.msgType]:e.msgType),null!=e.command&&e.hasOwnProperty("command")&&(n.command=e.command),null!=e.sequence&&e.hasOwnProperty("sequence")&&(n.sequence=e.sequence),null!=e.extend&&e.hasOwnProperty("extend")&&(n.extend=t.bytes===String?p.base64.encode(e.extend,0,e.extend.length):t.bytes===Array?Array.prototype.slice.call(e.extend):e.extend),null!=e.error&&e.hasOwnProperty("error")&&(n.error=e.error),null!=e.customError&&e.hasOwnProperty("customError")&&(n.customError=e.customError),null!=e.errorForDebug&&e.hasOwnProperty("errorForDebug")&&(n.errorForDebug=e.errorForDebug),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.MsgType=(o={},(r=Object.create(o))[o[0]="NULL"]=0,r[o[1]="REQUEST"]=1,r[o[2]="RESPONSE"]=2,r[o[3]="NOTIFY"]=3,r[o[4]="PUSH"]=4,r[o[5]="HEARTBEAT"]=5,r),a.Mission=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.chapterID=0,t.prototype.missionID=0,t.prototype.stars=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.chapterID&&e.hasOwnProperty("chapterID")&&t.uint32(8).uint32(e.chapterID),null!=e.missionID&&e.hasOwnProperty("missionID")&&t.uint32(16).uint32(e.missionID),null!=e.stars&&e.hasOwnProperty("stars")&&t.uint32(24).uint32(e.stars),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.Mission;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.chapterID=e.uint32();break;case 2:o.missionID=e.uint32();break;case 3:o.stars=e.uint32();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!==(void 0===e?"undefined":c(e))||null===e?"object expected":null!=e.chapterID&&e.hasOwnProperty("chapterID")&&!p.isInteger(e.chapterID)?"chapterID: integer expected":null!=e.missionID&&e.hasOwnProperty("missionID")&&!p.isInteger(e.missionID)?"missionID: integer expected":null!=e.stars&&e.hasOwnProperty("stars")&&!p.isInteger(e.stars)?"stars: integer expected":null},t.fromObject=function(e){if(e instanceof d.protocol.Mission)return e;var t=new d.protocol.Mission;return null!=e.chapterID&&(t.chapterID=e.chapterID>>>0),null!=e.missionID&&(t.missionID=e.missionID>>>0),null!=e.stars&&(t.stars=e.stars>>>0),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.chapterID=0,n.missionID=0,n.stars=0),null!=e.chapterID&&e.hasOwnProperty("chapterID")&&(n.chapterID=e.chapterID),null!=e.missionID&&e.hasOwnProperty("missionID")&&(n.missionID=e.missionID),null!=e.stars&&e.hasOwnProperty("stars")&&(n.stars=e.stars),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.PlayerInfo=function(){function t(e){if(this.missions=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.prototype.name="",t.prototype.icon="",t.prototype.golds=0,t.prototype.hasStepItem=!1,t.prototype.hasTiemItem=!1,t.prototype.power=0,t.prototype.missions=p.emptyArray,t.prototype.lastPlayMission=null,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),null!=e.icon&&e.hasOwnProperty("icon")&&t.uint32(26).string(e.icon),null!=e.golds&&e.hasOwnProperty("golds")&&t.uint32(32).uint32(e.golds),null!=e.hasStepItem&&e.hasOwnProperty("hasStepItem")&&t.uint32(40).bool(e.hasStepItem),null!=e.hasTiemItem&&e.hasOwnProperty("hasTiemItem")&&t.uint32(48).bool(e.hasTiemItem),null!=e.power&&e.hasOwnProperty("power")&&t.uint32(56).uint32(e.power),null!=e.missions&&e.missions.length)for(var n=0;n<e.missions.length;++n)d.protocol.Mission.encode(e.missions[n],t.uint32(74).fork()).ldelim();return null!=e.lastPlayMission&&e.hasOwnProperty("lastPlayMission")&&d.protocol.Mission.encode(e.lastPlayMission,t.uint32(82).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.PlayerInfo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;case 2:o.name=e.string();break;case 3:o.icon=e.string();break;case 4:o.golds=e.uint32();break;case 5:o.hasStepItem=e.bool();break;case 6:o.hasTiemItem=e.bool();break;case 7:o.power=e.uint32();break;case 9:o.missions&&o.missions.length||(o.missions=[]),o.missions.push(d.protocol.Mission.decode(e,e.uint32()));break;case 10:o.lastPlayMission=d.protocol.Mission.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high)))return"playerUID: integer|Long expected";if(null!=e.name&&e.hasOwnProperty("name")&&!p.isString(e.name))return"name: string expected";if(null!=e.icon&&e.hasOwnProperty("icon")&&!p.isString(e.icon))return"icon: string expected";if(null!=e.golds&&e.hasOwnProperty("golds")&&!p.isInteger(e.golds))return"golds: integer expected";if(null!=e.hasStepItem&&e.hasOwnProperty("hasStepItem")&&"boolean"!=typeof e.hasStepItem)return"hasStepItem: boolean expected";if(null!=e.hasTiemItem&&e.hasOwnProperty("hasTiemItem")&&"boolean"!=typeof e.hasTiemItem)return"hasTiemItem: boolean expected";if(null!=e.power&&e.hasOwnProperty("power")&&!p.isInteger(e.power))return"power: integer expected";if(null!=e.missions&&e.hasOwnProperty("missions")){if(!Array.isArray(e.missions))return"missions: array expected";for(var t=0;t<e.missions.length;++t)if(n=d.protocol.Mission.verify(e.missions[t]))return"missions."+n}var n;return null!=e.lastPlayMission&&e.hasOwnProperty("lastPlayMission")&&(n=d.protocol.Mission.verify(e.lastPlayMission))?"lastPlayMission."+n:null},t.fromObject=function(e){if(e instanceof d.protocol.PlayerInfo)return e;var t=new d.protocol.PlayerInfo;if(null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),null!=e.name&&(t.name=String(e.name)),null!=e.icon&&(t.icon=String(e.icon)),null!=e.golds&&(t.golds=e.golds>>>0),null!=e.hasStepItem&&(t.hasStepItem=Boolean(e.hasStepItem)),null!=e.hasTiemItem&&(t.hasTiemItem=Boolean(e.hasTiemItem)),null!=e.power&&(t.power=e.power>>>0),e.missions){if(!Array.isArray(e.missions))throw TypeError(".protocol.PlayerInfo.missions: array expected");t.missions=[];for(var n=0;n<e.missions.length;++n){if("object"!==c(e.missions[n]))throw TypeError(".protocol.PlayerInfo.missions: object expected");t.missions[n]=d.protocol.Mission.fromObject(e.missions[n])}}if(null!=e.lastPlayMission){if("object"!==c(e.lastPlayMission))throw TypeError(".protocol.PlayerInfo.lastPlayMission: object expected");t.lastPlayMission=d.protocol.Mission.fromObject(e.lastPlayMission)}return t},t.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.missions=[]),t.defaults){if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;n.name="",n.icon="",n.golds=0,n.hasStepItem=!1,n.hasTiemItem=!1,n.power=0,n.lastPlayMission=null}if(null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.icon&&e.hasOwnProperty("icon")&&(n.icon=e.icon),null!=e.golds&&e.hasOwnProperty("golds")&&(n.golds=e.golds),null!=e.hasStepItem&&e.hasOwnProperty("hasStepItem")&&(n.hasStepItem=e.hasStepItem),null!=e.hasTiemItem&&e.hasOwnProperty("hasTiemItem")&&(n.hasTiemItem=e.hasTiemItem),null!=e.power&&e.hasOwnProperty("power")&&(n.power=e.power),e.missions&&e.missions.length){n.missions=[];for(var r=0;r<e.missions.length;++r)n.missions[r]=d.protocol.Mission.toObject(e.missions[r],t)}return null!=e.lastPlayMission&&e.hasOwnProperty("lastPlayMission")&&(n.lastPlayMission=d.protocol.Mission.toObject(e.lastPlayMission,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.PlayerLoginReq=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.PlayerLoginReq;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!==(void 0===e?"undefined":c(e))||null===e?"object expected":null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high))?"playerUID: integer|Long expected":null},t.fromObject=function(e){if(e instanceof d.protocol.PlayerLoginReq)return e;var t=new d.protocol.PlayerLoginReq;return null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;return null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.PlayerLoginRes=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.info=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.info&&e.hasOwnProperty("info")&&d.protocol.PlayerInfo.encode(e.info,t.uint32(10).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.PlayerLoginRes;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.info=d.protocol.PlayerInfo.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.info&&e.hasOwnProperty("info")){var t=d.protocol.PlayerInfo.verify(e.info);if(t)return"info."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.PlayerLoginRes)return e;var t=new d.protocol.PlayerLoginRes;if(null!=e.info){if("object"!==c(e.info))throw TypeError(".protocol.PlayerLoginRes.info: object expected");t.info=d.protocol.PlayerInfo.fromObject(e.info)}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.info=null),null!=e.info&&e.hasOwnProperty("info")&&(n.info=d.protocol.PlayerInfo.toObject(e.info,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.MissionReq=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.prototype.misson=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),null!=e.misson&&e.hasOwnProperty("misson")&&d.protocol.Mission.encode(e.misson,t.uint32(18).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.MissionReq;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;case 2:o.misson=d.protocol.Mission.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high)))return"playerUID: integer|Long expected";if(null!=e.misson&&e.hasOwnProperty("misson")){var t=d.protocol.Mission.verify(e.misson);if(t)return"misson."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.MissionReq)return e;var t=new d.protocol.MissionReq;if(null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),null!=e.misson){if("object"!==c(e.misson))throw TypeError(".protocol.MissionReq.misson: object expected");t.misson=d.protocol.Mission.fromObject(e.misson)}return t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;n.misson=null}return null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),null!=e.misson&&e.hasOwnProperty("misson")&&(n.misson=d.protocol.Mission.toObject(e.misson,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.MissionRes=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.currentInfo=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&d.protocol.PlayerInfo.encode(e.currentInfo,t.uint32(10).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.MissionRes;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.currentInfo=d.protocol.PlayerInfo.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.currentInfo&&e.hasOwnProperty("currentInfo")){var t=d.protocol.PlayerInfo.verify(e.currentInfo);if(t)return"currentInfo."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.MissionRes)return e;var t=new d.protocol.MissionRes;if(null!=e.currentInfo){if("object"!==c(e.currentInfo))throw TypeError(".protocol.MissionRes.currentInfo: object expected");t.currentInfo=d.protocol.PlayerInfo.fromObject(e.currentInfo)}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.currentInfo=null),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&(n.currentInfo=d.protocol.PlayerInfo.toObject(e.currentInfo,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.RefreshDataReq=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.RefreshDataReq;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!==(void 0===e?"undefined":c(e))||null===e?"object expected":null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high))?"playerUID: integer|Long expected":null},t.fromObject=function(e){if(e instanceof d.protocol.RefreshDataReq)return e;var t=new d.protocol.RefreshDataReq;return null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;return null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.RefreshDataRes=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.currentInfo=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&d.protocol.PlayerInfo.encode(e.currentInfo,t.uint32(10).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.RefreshDataRes;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.currentInfo=d.protocol.PlayerInfo.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.currentInfo&&e.hasOwnProperty("currentInfo")){var t=d.protocol.PlayerInfo.verify(e.currentInfo);if(t)return"currentInfo."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.RefreshDataRes)return e;var t=new d.protocol.RefreshDataRes;if(null!=e.currentInfo){if("object"!==c(e.currentInfo))throw TypeError(".protocol.RefreshDataRes.currentInfo: object expected");t.currentInfo=d.protocol.PlayerInfo.fromObject(e.currentInfo)}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.currentInfo=null),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&(n.currentInfo=d.protocol.PlayerInfo.toObject(e.currentInfo,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.MissionCheckOutReq=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.prototype.isPlayerWin=!1,t.prototype.misson=null,t.prototype.useStepItem=!1,t.prototype.useTimeItem=!1,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),null!=e.isPlayerWin&&e.hasOwnProperty("isPlayerWin")&&t.uint32(16).bool(e.isPlayerWin),null!=e.misson&&e.hasOwnProperty("misson")&&d.protocol.Mission.encode(e.misson,t.uint32(26).fork()).ldelim(),null!=e.useStepItem&&e.hasOwnProperty("useStepItem")&&t.uint32(32).bool(e.useStepItem),null!=e.useTimeItem&&e.hasOwnProperty("useTimeItem")&&t.uint32(40).bool(e.useTimeItem),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.MissionCheckOutReq;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;case 2:o.isPlayerWin=e.bool();break;case 3:o.misson=d.protocol.Mission.decode(e,e.uint32());break;case 4:o.useStepItem=e.bool();break;case 5:o.useTimeItem=e.bool();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high)))return"playerUID: integer|Long expected";if(null!=e.isPlayerWin&&e.hasOwnProperty("isPlayerWin")&&"boolean"!=typeof e.isPlayerWin)return"isPlayerWin: boolean expected";if(null!=e.misson&&e.hasOwnProperty("misson")){var t=d.protocol.Mission.verify(e.misson);if(t)return"misson."+t}return null!=e.useStepItem&&e.hasOwnProperty("useStepItem")&&"boolean"!=typeof e.useStepItem?"useStepItem: boolean expected":null!=e.useTimeItem&&e.hasOwnProperty("useTimeItem")&&"boolean"!=typeof e.useTimeItem?"useTimeItem: boolean expected":null},t.fromObject=function(e){if(e instanceof d.protocol.MissionCheckOutReq)return e;var t=new d.protocol.MissionCheckOutReq;if(null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),null!=e.isPlayerWin&&(t.isPlayerWin=Boolean(e.isPlayerWin)),null!=e.misson){if("object"!==c(e.misson))throw TypeError(".protocol.MissionCheckOutReq.misson: object expected");t.misson=d.protocol.Mission.fromObject(e.misson)}return null!=e.useStepItem&&(t.useStepItem=Boolean(e.useStepItem)),null!=e.useTimeItem&&(t.useTimeItem=Boolean(e.useTimeItem)),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;n.isPlayerWin=!1,n.misson=null,n.useStepItem=!1,n.useTimeItem=!1}return null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),null!=e.isPlayerWin&&e.hasOwnProperty("isPlayerWin")&&(n.isPlayerWin=e.isPlayerWin),null!=e.misson&&e.hasOwnProperty("misson")&&(n.misson=d.protocol.Mission.toObject(e.misson,t)),null!=e.useStepItem&&e.hasOwnProperty("useStepItem")&&(n.useStepItem=e.useStepItem),null!=e.useTimeItem&&e.hasOwnProperty("useTimeItem")&&(n.useTimeItem=e.useTimeItem),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.MissionCheckOutRes=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.currentInfo=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&d.protocol.PlayerInfo.encode(e.currentInfo,t.uint32(10).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.MissionCheckOutRes;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.currentInfo=d.protocol.PlayerInfo.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.currentInfo&&e.hasOwnProperty("currentInfo")){var t=d.protocol.PlayerInfo.verify(e.currentInfo);if(t)return"currentInfo."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.MissionCheckOutRes)return e;var t=new d.protocol.MissionCheckOutRes;if(null!=e.currentInfo){if("object"!==c(e.currentInfo))throw TypeError(".protocol.MissionCheckOutRes.currentInfo: object expected");t.currentInfo=d.protocol.PlayerInfo.fromObject(e.currentInfo)}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.currentInfo=null),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&(n.currentInfo=d.protocol.PlayerInfo.toObject(e.currentInfo,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.ItemType=(i={},(s=Object.create(i))[i[0]="ITEM_TYPE_INVALID"]=0,s[i[1]="ITEM_TYPE_STEP"]=1,s[i[2]="ITEM_TYPE_TIME"]=2,s),a.BuyItemReq=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.playerUID=p.Long?p.Long.fromBits(0,0,!0):0,t.prototype.itype=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.playerUID&&e.hasOwnProperty("playerUID")&&t.uint32(8).uint64(e.playerUID),null!=e.itype&&e.hasOwnProperty("itype")&&t.uint32(16).int32(e.itype),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.BuyItemReq;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.playerUID=e.uint64();break;case 2:o.itype=e.int32();break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.playerUID&&e.hasOwnProperty("playerUID")&&!(p.isInteger(e.playerUID)||e.playerUID&&p.isInteger(e.playerUID.low)&&p.isInteger(e.playerUID.high)))return"playerUID: integer|Long expected";if(null!=e.itype&&e.hasOwnProperty("itype"))switch(e.itype){default:return"itype: enum value expected";case 0:case 1:case 2:}return null},t.fromObject=function(e){if(e instanceof d.protocol.BuyItemReq)return e;var t=new d.protocol.BuyItemReq;switch(null!=e.playerUID&&(p.Long?(t.playerUID=p.Long.fromValue(e.playerUID)).unsigned=!0:"string"==typeof e.playerUID?t.playerUID=parseInt(e.playerUID,10):"number"==typeof e.playerUID?t.playerUID=e.playerUID:"object"===c(e.playerUID)&&(t.playerUID=new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0))),e.itype){case"ITEM_TYPE_INVALID":case 0:t.itype=0;break;case"ITEM_TYPE_STEP":case 1:t.itype=1;break;case"ITEM_TYPE_TIME":case 2:t.itype=2}return t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(p.Long){var o=new p.Long(0,0,!0);n.playerUID=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else n.playerUID=t.longs===String?"0":0;n.itype=t.enums===String?"ITEM_TYPE_INVALID":0}return null!=e.playerUID&&e.hasOwnProperty("playerUID")&&("number"==typeof e.playerUID?n.playerUID=t.longs===String?String(e.playerUID):e.playerUID:n.playerUID=t.longs===String?p.Long.prototype.toString.call(e.playerUID):t.longs===Number?new p.LongBits(e.playerUID.low>>>0,e.playerUID.high>>>0).toNumber(!0):e.playerUID),null!=e.itype&&e.hasOwnProperty("itype")&&(n.itype=t.enums===String?d.protocol.ItemType[e.itype]:e.itype),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a.BuyItemRes=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.currentInfo=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=h.create()),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&d.protocol.PlayerInfo.encode(e.currentInfo,t.uint32(10).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new d.protocol.BuyItemRes;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.currentInfo=d.protocol.PlayerInfo.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!==(void 0===e?"undefined":c(e))||null===e)return"object expected";if(null!=e.currentInfo&&e.hasOwnProperty("currentInfo")){var t=d.protocol.PlayerInfo.verify(e.currentInfo);if(t)return"currentInfo."+t}return null},t.fromObject=function(e){if(e instanceof d.protocol.BuyItemRes)return e;var t=new d.protocol.BuyItemRes;if(null!=e.currentInfo){if("object"!==c(e.currentInfo))throw TypeError(".protocol.BuyItemRes.currentInfo: object expected");t.currentInfo=d.protocol.PlayerInfo.fromObject(e.currentInfo)}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.currentInfo=null),null!=e.currentInfo&&e.hasOwnProperty("currentInfo")&&(n.currentInfo=d.protocol.PlayerInfo.toObject(e.currentInfo,t)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,l.util.toJSONOptions)},t}(),a),t.exports=d,cc._RF.pop()},{}],NearestPrefer:[function(e,t,n){"use strict";cc._RF.push(t,"e4338wM2NZP5brawLTmllCS","NearestPrefer"),Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../../Common/CommonDef"),o=e("../ChessBoard"),r=e("../../../Common/PathFinding/Finder/AStarFinder"),i=e("./NewestPrefer"),s=cc._decorator,a=s.ccclass,c=(s.property,s.menu),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e.mPathFinder=null,e.mNewestPrefer=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mChessBoard=this.getComponentInChildren(o.default),this.mNewestPrefer=this.getComponent(i.default),this.mPathFinder=new r.default({allowDiagonal:!1,dontCrossCorners:!1,weight:1})},e.prototype.start=function(){},e.prototype.initData=function(){},e.prototype.post=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.httpServerSetpChess=function(){},e.prototype.httpServerTakeoutChess=function(){},e.prototype.getMapFlagCount=function(){},e.prototype.trySplit=function(){var o=this;if(0==this.mChessBoard.destChess.length)throw new Error("[NearestPrefer.trySplit] destination chess does not exsit.");if(0==this.mChessBoard.whiteChess.length){var r=new Array;if(this.mChessBoard.destChess.forEach(function(n){l.OPTIONAL_DIR.forEach(function(e){var t=cc.pAdd(e,n.unit.index);o.mChessBoard.canPass(l.UnitType.UNIT_TYPE_WHITE,t)&&r.push(t)})}),0<r.length)return{chess:null,index:r[Math.floor(Math.random()*r.length)]};var e=this.mChessBoard.canPassIndexes(l.UnitType.UNIT_TYPE_WHITE);return 0<e.length?{chess:null,index:e[Math.floor(Math.random()*e.length)]}:void 0}for(var t=null,n=0;n<this.mChessBoard.destChess.length;n++)for(var i=this.mChessBoard.destChess[n],s=0;s<this.mChessBoard.whiteChess.length;s++){var a=this.mChessBoard.whiteChess[s],c=this.mPathFinder.findPath(a.unit.index.x,a.unit.index.y,i.unit.index.x,i.unit.index.y,this.mChessBoard);this.mChessBoard.clearPath(),0<c.length&&(t?c.length<t.path.length&&(t={path:c,white:a}):t={path:c,white:a})}return t&&1<t.path.length?{chess:t.white,index:cc.v2(t.path[1][0],t.path[1][1])}:this.mNewestPrefer.trySplit()},e=__decorate([a,c("Game/GameLogic/AI/NearestPrefer")],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../../Common/CommonDef":"CommonDef","../../../Common/PathFinding/Finder/AStarFinder":"AStarFinder","../ChessBoard":"ChessBoard","./NewestPrefer":"NewestPrefer"}],NetWork:[function(e,t,n){"use strict";cc._RF.push(t,"f3515v/eRVL2JGqMtzYiSyD","NetWork"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./WSConnection"),p=e("./WSConnection");n.ConnectEvent=p.ConnectEvent,n.ConnEventData=p.ConnEventData;var d=e("./ProtoBufferCoder/ProtoBufCoder"),r=e("./HttpConnection"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mConns=new Map,e.mConnecting=new Map,e.mListener=new Map,e.mCurrentBlockedRequest=null,e.mConcurrentRequest=new Map,e.mHandle=new Map,e.mCurrentSeqID=1,e.mHttpReq=null,e.connectionPrefab=null,e.debugMessage=!0,e.emitCustomError=!0,e.checkPrototype=!0,e.defaultConnName="Game",e}return __extends(e,t),Object.defineProperty(e.prototype,"httpRequest",{get:function(){return this.mHttpReq},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){var n=this;this.node.on(p.ConnectEvent.CONNECT_TIMEOUT,function(e){n.emitEvent(e.detail),n.resetConnection(e.detail.connName),n.checkConnecting(e.detail,!1)}),this.node.on(p.ConnectEvent.CONNECTED,function(e){n.emitEvent(e.detail),n.checkConnecting(e.detail,!0)}),this.node.on(p.ConnectEvent.CONNECTION_ERROR,function(e){n.emitEvent(e.detail),n.resetConnection(e.detail.connName),n.checkConnecting(e.detail,!1)}),this.node.on(p.ConnectEvent.CONNECTION_CLOSED,function(e){n.emitEvent(e.detail),n.resetConnection(e.detail.connName),n.checkConnecting(e.detail,!1)}),this.node.on(p.ConnectEvent.MESSAGE,function(e){n.emitEvent(e.detail);var t=e.detail;n.onMessage(t.connName,t.data)}),this.node.on(p.ConnectEvent.CONNECTION_UNSTABLE,function(e){n.emitEvent(e.detail)}),this.node.on(p.ConnectEvent.CONNEECTION_GONEAWARY,function(e){n.emitEvent(e.detail)}),this.mHttpReq=this.getComponent(r.default)},e.prototype.start=function(){this.initNetWork()},e.prototype.initNetWork=function(){for(var e=0,t=this.getComponentsInChildren(o.default);e<t.length;e++){var n=t[e];this.addConnection(n)}},e.prototype.onDestroy=function(){this.mConnecting.clear(),this.mListener.clear(),this.mHandle.clear()},e.prototype.connectTo=function(r,i){return __awaiter(this,void 0,void 0,function(){var n,o,t;return __generator(this,function(e){r&&null!=r||(r=this.defaultConnName),t=new Promise(function(e,t){n=e,o=t});try{if(!this.mConns.has(r))throw new Error("[NetWork.connectionTo] cann't found connection "+r+".");this.mConns.get(r).connectTo(),this.mConnecting.set(r,{resolve:n,reject:o,node:i})}catch(e){o(e)}return[2,t]})})},e.prototype.buidConnection=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,null]})})},e.prototype.addListener=function(e,t){return t||(t=this.defaultConnName),!!this.mListener.has(t)&&(this.mListener.get(t).add(e),!0)},e.prototype.removeListener=function(e,t){return t||(t=this.defaultConnName),this.mListener.has(t)&&this.mListener.get(t).has(e)&&this.mListener.get(t).delete(e),!1},e.prototype.resetConnection=function(e){return e||(e=this.defaultConnName),!!this.mConns.has(e)&&this.tryResetConnection(this.mConns.get(e))},e.prototype.closeConnection=function(e){e||(e=this.defaultConnName),this.mConns.has(e)&&this.mConns.get(e).close()},e.prototype.request=function(s,a,c,l,u,h){return __awaiter(this,void 0,void 0,function(){var n,o,t,r,i;return __generator(this,function(e){if(l||(l=this.defaultConnName),null==s)throw new Error("[NetWork.request] arguments error");if(!this.mConns.has(l))throw new Error("[NetWork.request] connection "+l+" not found.");if(this.checkPrototype&&(!d.CheckTypeFunc(s.constructor)||!d.CheckTypeFunc(a)))throw new Error("[NetWork.request] check proto type failed. "+s.constructor.name+" or "+a.name);if(c||(c=s.constructor.name),void 0===h&&(h=!0),!0===h&&null!=this.mCurrentBlockedRequest)throw new Error("[NetWork.request] last requestion "+this.mCurrentBlockedRequest.ctx.cmd+" unresolved.");this.mCurrentSeqID++,t=new Promise(function(e,t){n=e,o=t});try{this.debugMessage&&cc.log("[NetWork.request] sequence ",this.mCurrentSeqID," command ",c," need block ",h),r=d.Coder.buildHead(d.MsgType.REQUEST,this.mCurrentSeqID,c,d.Coder.serialize(s)),this.mConns.get(l).send(r.serialize())}catch(e){o(e),u&&u(e,null)}return i={resolve:n,reject:o,cb:u,connName:l,handleType:a,cmd:c},h?(this.emitEvent({connName:l,eType:p.ConnectEvent.REQUEST_BLOCK,reason:p.ConnectEvent.REQUEST_BLOCK}),this.mCurrentBlockedRequest={seq:this.mCurrentSeqID,ctx:i}):this.mConcurrentRequest.set(this.mCurrentSeqID,i),[2,t]})})},e.prototype.push=function(e,t,n){if(n||(n=this.defaultConnName),this.checkPrototype&&!d.CheckTypeFunc(e.constructor))throw new Error("[NetWork.push] check proto type failed. "+e.constructor.name);if(!this.mConns.has(n))throw new Error("[NetWork.push] conn't found connection "+n+".");try{var o=d.Coder.buildHead(d.MsgType.PUSH,0,t,d.Coder.serialize(e));this.debugMessage&&cc.log("[NetWork.push] ",o),this.mConns.get(n).send(o.serialize(),!1)}catch(e){throw cc.warn("[NetWork.push] ",t," error ",e),e}},e.prototype.registerHandle=function(e,t,n,o){if(o||(o=this.defaultConnName),!this.mConns.has(o)||!this.mHandle.has(o))throw new Error("[NetWork.registerHandle] conn't found connection "+o);if(this.checkPrototype&&!d.CheckTypeFunc(t))throw new Error("[NetWork.registerHandle] check proto type failed. "+t.name);if(this.mHandle.get(o).has(e))throw new Error("[NetWork.registerHandle] command "+e+" already registed.");var r={resolve:null,reject:null,cb:n,connName:o,handleType:t,cmd:e};this.mHandle.get(o).set(e,r)},e.prototype.getRTT=function(e){e||(e=this.defaultConnName);var t=this.mConns.get(e);return t?t.rtt:o.default.MAX_RTT},e.prototype.checkConnecting=function(e,t){if(cc.log("[NetWork.checkConnecting] check connection ",e.connName,"."),this.mConnecting.has(e.connName)){var n=this.mConnecting.get(e.connName);t?n.resolve(e.connName):n.reject(new Error(e.reason)),n.node&&n.node.isValid&&n.node.emit(e.eType,e),this.mConnecting.delete(e.connName)}},e.prototype.tryResetConnection=function(e){if(e&&e.state!=o.default.INITIALED&&e.autoResetConnection){var t=e.node;cc.log("[NetWork.resetConnection] reset connection ",e.connName+"."),t.removeComponent(o.default),this.mConns.delete(e.connName);var n=t.addComponent(o.default);return n.setConfig(e),e.close(),this.mCurrentBlockedRequest=null,this.mConcurrentRequest.clear(),this.mConns.set(e.connName,n),this.emitEvent({connName:n.connName,eType:p.ConnectEvent.CONNECTION_RESET,reason:p.ConnectEvent.CONNECTION_RESET}),!0}return!1},e.prototype.emitEvent=function(t){this.mListener.has(t.connName)&&this.mListener.get(t.connName).forEach(function(e){e.isValid&&(cc.log("[NetWork.emitEvent] event type ",t.eType,t.reason),e.emit(t.eType,t))})},e.prototype.onMessage=function(e,t){var n=null;try{var o=d.Coder.headFormByteArray(t);if(o.msgType()==d.MsgType.HEARTBEAT){if(!this.mConns.has(e))return void cc.warn("[NetWork.onMessage] cann't find connection ",e," when heart beat.");this.mConns.get(e).onHeartBeat(o.sequence())}else if(o.msgType()==d.MsgType.NOTIFY){if(this.debugMessage&&cc.log("[NetWork.onMessage] notify receved ",o),!this.mHandle.has(e)||!this.mHandle.get(e).has(o.commond()))return void cc.warn("[NetWork.onMessage] cann't find register handle ",e," command ",o.commond(),".");var r=this.mHandle.get(e).get(o.commond());r.cb(d.Coder.buildProtocol(r.handleType,o.extend()))}else{if(o.msgType()!=d.MsgType.RESPONSE)return void cc.warn("[NetWork.onMessage] cann't recognize message type ",o.msgType(),".");if(this.mCurrentBlockedRequest&&o.sequence()==this.mCurrentBlockedRequest.seq)n=this.mCurrentBlockedRequest.ctx,this.mCurrentBlockedRequest=null,this.emitEvent({connName:n.connName,eType:p.ConnectEvent.RESPONSE_UNBLOCK,reason:p.ConnectEvent.RESPONSE_UNBLOCK});else{if(!this.mConcurrentRequest.has(o.sequence()))return void cc.warn("[NetWork.onMessage] cann't find request sequence ",o.sequence(),".");n=this.mConcurrentRequest.get(o.sequence()),this.mConcurrentRequest.delete(o.sequence())}if(this.debugMessage&&cc.log("[NetWork.onMessage] message response ",o),o.customError()&&0<o.customError().length&&this.emitCustomError&&this.emitEvent({connName:n.connName,eType:p.ConnectEvent.CUSTOM_ERROR,reason:p.ConnectEvent.CUSTOM_ERROR,data:o.errorForDebug()}),o.error()&&0<o.error().length){var i=new Error(o.error());return n.reject(i),void(n.cb&&n.cb(i,null))}var s=d.Coder.buildProtocol(n.handleType,o.extend());n.resolve(s),n.cb&&n.cb(null,s)}}catch(e){n&&(n.reject(e),n.cb&&n.cb(e,null)),cc.warn("[NetWork.onMessage] ",e.message)}},e.prototype.addConnection=function(e){return this.mConns.has(e.connName)||this.mListener.has(e.connName)||this.mHandle.has(e.connName)?(cc.warn("[NetWork.addConnection] connection ",e.connName," already exsit."),!1):(this.mConns.set(e.connName,e),this.mListener.set(e.connName,new Set),this.mHandle.set(e.connName,new Map),!0)},__decorate([a({type:cc.Prefab})],e.prototype,"connectionPrefab",void 0),__decorate([a({tooltip:"show request or push info on console if turn on this config."})],e.prototype,"debugMessage",void 0),__decorate([a({tooltip:"emit custom error event if turn on this config."})],e.prototype,"emitCustomError",void 0),__decorate([a],e.prototype,"checkPrototype",void 0),__decorate([a],e.prototype,"defaultConnName",void 0),e=__decorate([s,c("Game/Net/NetWork")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"./HttpConnection":"HttpConnection","./ProtoBufferCoder/ProtoBufCoder":"ProtoBufCoder","./WSConnection":"WSConnection"}],NewestPrefer:[function(e,t,n){"use strict";cc._RF.push(t,"cb524RAm+ZMiqipe/AUohX1","NewestPrefer"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../Common/CommonDef"),o=e("../ChessBoard"),r=cc._decorator,s=r.ccclass,a=(r.property,r.menu),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mChessBoard=this.getComponentInChildren(o.default)},e.prototype.start=function(){},e.prototype.initData=function(){},e.prototype.httpServerSetpChess=function(){},e.prototype.httpServerTakeoutChess=function(){},e.prototype.getMapFlagCount=function(){},e.prototype.trySplit=function(){var e=this.orderedWhiteChess();if(!(e&&0<e.length)){var t=this.mChessBoard.canPassIndexes(i.UnitType.UNIT_TYPE_WHITE);return 0<t.length?{chess:null,index:t[Math.floor(Math.random()*t.length)]}:void 0}for(var n=e.length-1;0<=n;n--){var o=e[n],r=this.qi(o.unit);if(0<r.length)return{chess:o,index:cc.pAdd(o.unit.index,r[Math.floor(Math.random()*r.length)])}}},e.prototype.post=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.qi=function(t){var n=this;return i.OPTIONAL_DIR.filter(function(e){return n.mChessBoard.canPass(t,cc.pAdd(t.index,e))},this)},e.prototype.orderedWhiteChess=function(){return this.mChessBoard.whiteChessOrderedByPutIn},e=__decorate([s,a("Game/GameLogic/AI/NewestPrefer")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../../Common/CommonDef":"CommonDef","../ChessBoard":"ChessBoard"}],PathFindingDef:[function(e,t,n){"use strict";var o;cc._RF.push(t,"4b92dAhtNBC8Z0xLP9D2OC4","PathFindingDef"),Object.defineProperty(n,"__esModule",{value:!0}),(o=n.DiagonalMovement||(n.DiagonalMovement={}))[o.Always=1]="Always",o[o.Never=2]="Never",o[o.IfAtMostOneObstacle=3]="IfAtMostOneObstacle",o[o.OnlyWhenNoObstacles=4]="OnlyWhenNoObstacles";n.manhattan=function(e,t){return e+t};n.euclidean=function(e,t){return Math.sqrt(e*e+t*t)};n.octile=function(e,t){var n=Math.SQRT2-1;return e<t?n*e+t:n*t+e};n.chebyshev=function(e,t){return Math.max(e,t)};var r=function(){};n.INode=r;var i=function(){};n.NodeBase=i,cc._RF.pop()},{}],PlayChessPrefer:[function(e,t,n){"use strict";cc._RF.push(t,"5295bUdpuZCx7jEv/9xJHXj","PlayChessPrefer"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../Common/CommonDef"),r=e("../ChessBoard"),s=e("../../../GameGlobal"),i=e("../WhiteChess"),a=cc._decorator,c=a.ccclass,l=(a.property,a.menu),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mChessBoard=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mChessBoard=this.getComponentInChildren(r.default)},e.prototype.start=function(){},e.prototype.getMapFlagCount=function(){},e.prototype.initData=function(){},e.prototype.post=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.httpServerSetpChess=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="listAction="+this.mChessBoard.chessData,[4,s.default.getGlobal().netWork.httpRequest.post(o.HTTP_PLAY_CHESS_AI_HOST,o.HTTP_PLAY_CHESS_AI_METHOD,t)];case 1:return n=e.sent(),console.log("mAides---",n),this.RequestResolve(n),[2]}})})},e.prototype.httpServerTakeoutChess=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="listAction="+this.mChessBoard.chessData,[4,s.default.getGlobal().netWork.httpRequest.post(o.HTTP_PLAY_CHESS_AI_HOST,o.HTTP_PLAY_CHESS_TAKE_CHESS,t)];case 1:return n=e.sent(),console.log("httpServerTakeoutChess---",n),this.taskOutChessHandler(n),[2]}})})},e.prototype.taskOutChessHandler=function(e){var t=JSON.parse(e);if(console.log("responseText",t),0==t.error.returnCode&&null!=t.data&&"W"==t.data[0]){var n=t.data[2].charCodeAt()-96,o=t.data[3].charCodeAt()-96,r=cc.v2(n,o),i=this.mChessBoard.getUnits(r);this.mChessBoard.takeOut(i)}},e.prototype.RequestResolve=function(e){var t=JSON.parse(e);if(console.log("responseText",t),0==t.error.returnCode&&null!=t.data&&"W"==t.data[0]){var n=t.data[2].charCodeAt()-96,o=t.data[3].charCodeAt()-96,r=s.default.getGlobal().resourceMgr.getWhiteChess(),i=cc.v2(n,o);this.mChessBoard.addUnit(r,i)}},e.prototype.trySplit=function(){if(0==this.mChessBoard.blackChess.length)throw new Error("[NearestPrefer.trySplit] destination chess does not exsit.");this.mChessBoard.chessData;var e=s.default.getGlobal().resourceMgr.getWhiteChess(),t=cc.v2(3,3);return this.mChessBoard.addUnit(e,t),{chess:e.node.getComponent(i.default),index:t}},e=__decorate([c,l("Game/GameLogic/AI/PlayChessPrefer")],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../../Common/CommonDef":"CommonDef","../../../GameGlobal":"GameGlobal","../ChessBoard":"ChessBoard","../WhiteChess":"WhiteChess"}],Preview:[function(e,t,n){"use strict";cc._RF.push(t,"d361b5txRRFqoOnGYLPlTYI","Preview"),Object.defineProperty(n,"__esModule",{value:!0});var c=e("./ChessBoard"),l=e("./BoardPreset"),u=e("../../GameGlobal"),o=e("../../UI/Chess/UIPreviewChapter"),r=e("../../UI/Chess/UIPreviewMission"),i=cc._decorator,s=i.ccclass,a=i.property,h=i.menu,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardView=null,e.chapterNode=null,e.missonNode=null,e.chapterProtoItem=null,e.missionProtoItem=null,e.boardProtoItem=null,e.returnBtn=null,e.currentChapter=null,e.currentMission=null,e.currentFile=null,e.mSelectedChapter=0,e.mSelectMission=0,e.mPool=new cc.NodePool,e.mChessBoardPool=new cc.NodePool,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){this.boardView.node.active=!1,this.chapterNode.active=!1,this.missonNode.active=!1,this.returnBtn.active=!1},e.prototype.onInitFinished=function(){var n=this;this.chapterNode.active=!0,u.default.getGlobal().resourceMgr.getMissionList().chapters.forEach(function(e){var t=cc.instantiate(n.chapterProtoItem);t.parent=n.chapterProtoItem.parent,t.getComponent(o.default).chapter=e.id,t.active=!0}),this.returnBtn.active=!0},e.prototype.onChapterSelect=function(e){var n=this;cc.log("[Preview.onChapterSelect] chapter ",e," selected.");var t=u.default.getGlobal().resourceMgr.getChapterDataConfig(e),o=this.missionProtoItem.parent;o.children.filter(function(e){return e.active}).forEach(function(e){return n.mPool.put(e)}),t.missions.forEach(function(e){0==n.mPool.size()&&n.mPool.put(cc.instantiate(n.missionProtoItem));var t=n.mPool.get();t.parent=o,t.getComponent(r.default).mission=e.id,t.active=!0}),this.chapterNode.active=!1,this.missonNode.active=!0,this.showCurrentChapter(e),this.showCurrentMission(0),this.showCurrentFile(null)},e.prototype.onMissionSelect=function(e){if(e!=this.mSelectMission){cc.log("[Preview.onMissionSelect] mission ",e," selected."),this.boardView.node.active=!0,this.showCurrentChapter(this.mSelectedChapter),this.showCurrentMission(e),this.showCurrentFile(null);var t=u.default.getGlobal().resourceMgr.getMissionDataConfig(this.mSelectedChapter,this.mSelectMission);this.showMissions(this.mSelectedChapter,e,t.cfgs).catch(function(e){return cc.log("[Preview.onMissionSelect]",e.message)})}},e.prototype.onReturn=function(){this.boardView.node.active=!1,this.chapterNode.active=!0,this.missonNode.active=!1,this.showCurrentChapter(0),this.showCurrentMission(0),this.showCurrentFile(null)},e.prototype.onPageTurn=function(){var e=this.boardView.getPages()[this.boardView.getCurrentPageIndex()];this.showCurrentFile(e.getComponentInChildren(l.default).file)},e.prototype.showCurrentChapter=function(e){this.mSelectedChapter=e,this.currentChapter.string=e?"current chapter : "+e:"current chapter : /"},e.prototype.showCurrentMission=function(e){this.mSelectMission=e,this.currentMission.string=e?"current mission : "+e:"current mission : /"},e.prototype.showCurrentFile=function(e){this.currentFile.string=e?"current config : "+e:"current config : /"},e.prototype.showMissions=function(e,t,a){return __awaiter(this,void 0,void 0,function(){var t,n,o,r,i,s=this;return __generator(this,function(e){switch(e.label){case 0:this.boardView.removeAllPages(),t=this.boardView.content,t.children.filter(function(e){return e.active}).forEach(function(e){return s.mChessBoardPool.put(e)}),n=0,e.label=1;case 1:return n<a.length?(o=null,(o=0==this.mChessBoardPool.size()?cc.instantiate(this.boardProtoItem):this.mChessBoardPool.get()).active=!0,this.boardView.addPage(o),o.getComponentInChildren(c.default).cleanup(),r=o.getComponentInChildren(l.default),[4,u.default.getGlobal().resourceMgr.getMissionData(a[n])]):[3,5];case 2:return i=e.sent(),r.setup(i,a[n]),[4,r.presetChess()];case 3:e.sent(),e.label=4;case 4:return n++,[3,1];case 5:return this.onPageTurn(),[2]}})})},__decorate([a(cc.PageView)],e.prototype,"boardView",void 0),__decorate([a(cc.Node)],e.prototype,"chapterNode",void 0),__decorate([a(cc.Node)],e.prototype,"missonNode",void 0),__decorate([a(cc.Node)],e.prototype,"chapterProtoItem",void 0),__decorate([a(cc.Node)],e.prototype,"missionProtoItem",void 0),__decorate([a(cc.Node)],e.prototype,"boardProtoItem",void 0),__decorate([a(cc.Node)],e.prototype,"returnBtn",void 0),__decorate([a(cc.Label)],e.prototype,"currentChapter",void 0),__decorate([a(cc.Label)],e.prototype,"currentMission",void 0),__decorate([a(cc.Label)],e.prototype,"currentFile",void 0),e=__decorate([s,h("Game/GameLogic/Chess/Preview")],e)}(cc.Component);n.default=p,cc._RF.pop()},{"../../GameGlobal":"GameGlobal","../../UI/Chess/UIPreviewChapter":"UIPreviewChapter","../../UI/Chess/UIPreviewMission":"UIPreviewMission","./BoardPreset":"BoardPreset","./ChessBoard":"ChessBoard"}],ProtoBufCoder:[function(e,t,n){"use strict";cc._RF.push(t,"aa094TTrJBMg6j1jKdLGPyQ","ProtoBufCoder"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../ProtoBuf/Msg");var s=function(){function e(e){this.mHead=e}return e.prototype.msgType=function(){return this.mHead.msgType},e.prototype.sequence=function(){return this.mHead.sequence},e.prototype.commond=function(){return this.mHead.command},e.prototype.error=function(){return this.mHead.error},e.prototype.customError=function(){return this.mHead.customError},e.prototype.errorForDebug=function(){return this.mHead.errorForDebug},e.prototype.extend=function(){return this.mHead.extend},e.prototype.serialize=function(){return i.protocol.Head.encode(this.mHead).finish()},e}();n.ProtoBufMessageHead=s;var o=function(){this.REQUEST=i.protocol.MsgType.REQUEST,this.RESPONSE=i.protocol.MsgType.RESPONSE,this.NOTIFY=i.protocol.MsgType.NOTIFY,this.PUSH=i.protocol.MsgType.PUSH,this.HEARTBEAT=i.protocol.MsgType.HEARTBEAT},r=new(function(){function e(){}return e.prototype.buildProtocol=function(e,t){var n=e.decode;if(!n)throw new Error("[ProtoBufProtoUtil.buildProtocol]  type "+e.name+" doesn't have decode function.");return n(t)},e.prototype.buildHead=function(e,t,n,o){var r=i.protocol.Head.create({msgType:e,sequence:t,command:n,extend:o});return new s(r)},e.prototype.serialize=function(e){var t=e.constructor.encode;if(!t)throw new Error("[ProtoBufProtoUtil.serialize<T>] @protoData isn't a protobuf.Message<T> data type , endcode function not found.");return t(e).finish()},e.prototype.headFormByteArray=function(e){var t=i.protocol.Head.decode(e);return new s(t)},e}());n.Coder=r;var a=new o;n.MsgType=a;var c=function(e){return e.create&&e.encode&&e.decode};n.CheckTypeFunc=c,cc._RF.pop()},{"../ProtoBuf/Msg":"Msg"}],RandomAnimation:[function(e,t,n){"use strict";cc._RF.push(t,"195f594X5xANYKzpu3an2cy","RandomAnimation"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.randomRepeat=2,e.randomTimeSpan=3,e.animaName="Chess",e.mAnima=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.mAnima=this.getComponent(cc.Animation),this.node.on(o.UnitEvent.ON_PUT_IN,this.onPutBoard,this),this.node.on(o.UnitEvent.ON_TAKE_OUT,this.onTakeOutBoard,this),this.node.on(o.UnitEvent.ON_UNUSE,this.onUnuse,this)},e.prototype.start=function(){},e.prototype.onDestroy=function(){this.node.targetOff(this)},e.prototype.onPutBoard=function(){cc.log("[RandomAnimation.onPutBoard]"),this.startRandomAnimation()},e.prototype.onTakeOutBoard=function(){this.mAnima.getAnimationState(this.animaName).stop()},e.prototype.onUnuse=function(){this.mAnima.targetOff(this),this.unscheduleAllCallbacks()},e.prototype.startRandomAnimation=function(){var e=this;this.scheduleOnce(function(){e.playAinimation(Math.floor(Math.random()*e.randomRepeat)+1,e.startRandomAnimation)},Math.random()*this.randomTimeSpan)},e.prototype.playAinimation=function(e,t){var n=this.mAnima.playAdditive(this.animaName);n.wrapMode=cc.WrapMode.Loop,n.repeatCount=e,this.mAnima.once("finished",t,this)},__decorate([s],e.prototype,"randomRepeat",void 0),__decorate([s],e.prototype,"randomTimeSpan",void 0),__decorate([s],e.prototype,"animaName",void 0),e=__decorate([i,a("Game/GameLogic/Chess/RandomAnimation")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],ResourceMgr:[function(e,t,n){"use strict";cc._RF.push(t,"94bf3oOnqdHEJ2jG1ErVIPL","ResourceMgr"),Object.defineProperty(n,"__esModule",{value:!0});var i=e("../GameLogic/Chess/Unit"),s=e("../Common/CommonDef"),a=e("../GameLogic/Chess/BlockChess"),c=e("../GameLogic/Chess/DestChess"),o=cc._decorator,r=o.ccclass,l=o.property,u=o.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.whitePrefab=null,e.blackPrefab=null,e.destPrefab=null,e.flagPrefab=null,e.missionListFile="Data/mission_list",e.gameConfigFile="Cfg/GameConfig",e.missonDataDir="Data/",e.mWiteChessPool=new cc.NodePool(i.default),e.mBlackChessPool=new cc.NodePool(i.default),e.mFlagChessPool=new cc.NodePool(i.default),e.mDestChessPool=new Map,e.mBolckChessPool=new Map,e.mMissionList=null,e.mGameCfg=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.asyncLoad(this.gameConfigFile)];case 1:return t=e.sent(),this.mGameCfg=cc.deserialize(t),[4,this.asyncLoad(this.missionListFile)];case 2:return n=e.sent(),this.mMissionList=cc.deserialize(n),[2]}})})},e.prototype.initChessPrefer=function(r){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=this).asyncLoad(this.getResourceByLessionId(r,s.UnitType.UNIT_TYPE_WHITE),cc.Prefab)];case 1:return t.whitePrefab=e.sent(),[4,(n=this).asyncLoad(this.getResourceByLessionId(r,s.UnitType.UNIT_TYPE_BLACK),cc.Prefab)];case 2:return n.blackPrefab=e.sent(),[4,(o=this).asyncLoad(this.getResourceMapFlag(),cc.Prefab)];case 3:return o.flagPrefab=e.sent(),[2]}})})},e.prototype.getResourceByLessionId=function(e,t){var n="";return t==s.UnitType.UNIT_TYPE_WHITE?n="WhiteChess_":t==s.UnitType.UNIT_TYPE_DEST?n="DestChess_":t==s.UnitType.UNIT_TYPE_BLACK?n="BlackChess_":t==s.UnitType.UNIT_TYPE_BLOCK&&(n="BlockChess_"),s.PREFABS_RES_PATH+n+e},e.prototype.getResourceMapFlag=function(){return s.PREFABS_RES_PATH+"BlackChessFlag"},e.prototype.getWhiteChess=function(){return 0==this.mWiteChessPool.size()?cc.instantiate(this.whitePrefab).getComponent(i.default):this.mWiteChessPool.get().getComponent(i.default)},e.prototype.getBlackChess=function(){return 0==this.mBlackChessPool.size()?cc.instantiate(this.blackPrefab).getComponent(i.default):this.mBlackChessPool.get().getComponent(i.default)},e.prototype.getFlagChess=function(){return 0==this.mFlagChessPool.size()?cc.instantiate(this.flagPrefab).getComponent(i.default):this.mFlagChessPool.get().getComponent(i.default)},e.prototype.getDestChess=function(r){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(e){switch(e.label){case 0:return n=t=null,this.mDestChessPool.has(r)?(t=this.mDestChessPool.get(r),[3,3]):[3,1];case 1:return[4,this.asyncLoad(this.getResourceByLessionId(r,s.UnitType.UNIT_TYPE_DEST),cc.Prefab)];case 2:o=e.sent(),t={prefab:o,pool:new cc.NodePool(i.default)},this.mDestChessPool.set(r,t),e.label=3;case 3:return(n=0==t.pool.size()?cc.instantiate(t.prefab):t.pool.get()).getComponent(c.default).belongChapter=r,[2,n.getComponent(i.default)]}})})},e.prototype.getBlockChess=function(r){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(e){switch(e.label){case 0:return n=t=null,this.mBolckChessPool.has(r)?(t=this.mBolckChessPool.get(r),[3,3]):[3,1];case 1:return[4,this.asyncLoad(this.getResourceByLessionId(r,s.UnitType.UNIT_TYPE_BLOCK),cc.Prefab)];case 2:o=e.sent(),t={prefab:o,pool:new cc.NodePool(i.default)},this.mBolckChessPool.set(r,t),e.label=3;case 3:return(n=0==t.pool.size()?cc.instantiate(t.prefab):t.pool.get()).getComponent(a.default).belongChapter=r,[2,n.getComponent(i.default)]}})})},e.prototype.putWhiteChess=function(e){this.mWiteChessPool.put(e.node)},e.prototype.putBlackChess=function(e){this.mBlackChessPool.put(e.node)},e.prototype.putFlagChess=function(e){this.mFlagChessPool.put(e.node)},e.prototype.putDestChess=function(e,t){this.mDestChessPool.has(e)&&this.mDestChessPool.get(e).pool.put(t.node)},e.prototype.putBlockChess=function(e,t){this.mBolckChessPool.has(e)&&this.mBolckChessPool.get(e).pool.put(t.node)},e.prototype.getItemCfg=function(){return this.mGameCfg.item_cfg},e.prototype.getMissionList=function(){return this.mMissionList},e.prototype.getGameCfg=function(){return this.mGameCfg},e.prototype.getChapterDataConfig=function(t){var e=this.mMissionList.chapters.find(function(e){return e.id==t});if(!e)throw Error("[ResourceMgr.getChapterDataConfig] chapter "+t+" not found.");return e},e.prototype.getMissionDataConfig=function(e,t){var n=this.getChapterDataConfig(e).missions.find(function(e){return e.id==t});if(!n)throw Error("[ResourceMgr.getMissionDataConfig] chapter "+e+" mission "+t+" not found.");return n},e.prototype.getMissionData=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.asyncLoad(this.missonDataDir+n)];case 1:return t=e.sent(),[2,cc.deserialize(t)]}})})},e.prototype.getChapterCfg=function(t){var e=this.mGameCfg.chapter_cfg.find(function(e){return e.chapter==t});return e||this.mGameCfg.chapter_cfg[0]},e.prototype.getChessBG=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return(t=this.getChapterCfg(n))?[2,this.asyncLoad(t.bg,cc.SpriteFrame)]:[2,new Promise(function(e,t){t(new Error("[ResourceMgr.getChessBG] chapter "+n+" bg not found."))})]})})},e.prototype.getMaxUnlock=function(e){for(var t=this.mGameCfg.chapter_cfg,n=0;n<t.length;n++){var o=t[n];if(e<o.unlock_stars)return o.chapter-1}return t[t.length-1].chapter},e.prototype.asyncLoad=function(t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,o){cc.loader.loadRes(t,r,function(e,t){e?o(e):n(t)})})]})})},__decorate([l(cc.Prefab)],e.prototype,"whitePrefab",void 0),__decorate([l(cc.Prefab)],e.prototype,"blackPrefab",void 0),__decorate([l(cc.Prefab)],e.prototype,"destPrefab",void 0),__decorate([l(cc.Prefab)],e.prototype,"flagPrefab",void 0),__decorate([l],e.prototype,"missionListFile",void 0),__decorate([l],e.prototype,"gameConfigFile",void 0),__decorate([l],e.prototype,"missonDataDir",void 0),e=__decorate([r,u("Game/ResourcesCtrl/ResourceMgr")],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../Common/CommonDef":"CommonDef","../GameLogic/Chess/BlockChess":"BlockChess","../GameLogic/Chess/DestChess":"DestChess","../GameLogic/Chess/Unit":"Unit"}],SIOConnection:[function(e,t,n){"use strict";cc._RF.push(t,"3cb8f0EhT1LO5lD2uJZENAW","SIOConnection"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=window.io.connect("http://192.168.1.130:7456");e.on("connect",function(){cc.log("connecting.")}),e.on("error",function(e){cc.error(e)}),e.on("receiveMessage",function(e){cc.log("recv data ",e,".")}),e.on("connected",function(){cc.log("connected."),e.send("socket.io send test.")})},t=__decorate([r],t)}(cc.Component));n.default=i,cc._RF.pop()},{}],SetPage:[function(e,t,n){"use strict";cc._RF.push(t,"098bbu626dGO6hc3IBfEIpA","SetPage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=e("../../GameGlobal"),i=e("./BasePage"),s=cc._decorator,a=s.ccclass,c=s.property,l=s.menu,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.musicSlider=null,e.musicProgressBar=null,e.soundSlider=null,e.soundProgressBar=null,e.closeButton=null,e.closeGameButton=null,e}return __extends(e,t),e.prototype.start=function(){var e=this;this.musicSlider.node.on("slide",this.OnSlide,this),this.soundSlider.node.on("slide",this.OnSlide,this),this.closeButton.node.on("click",function(){r.default.getGlobal().audioEngine.PlayReturnButtonSound(),e.PageOut()},this),this.closeGameButton.node.on("click",this.OnExit,this);var t=cc.sys.localStorage.getItem(o.MusicVolumeKey);t||(t=1),this.musicSlider.progress=t,this.musicProgressBar.progress=t;var n=cc.sys.localStorage.getItem(o.SoundVolumeKey);n||(n=1),this.soundSlider.progress=n,this.soundProgressBar.progress=n},e.prototype.OnSlide=function(e){var t=e.detail;if("Music"==t.node.parent.name){var n=t.progress;this.musicProgressBar.progress=n,r.default.getGlobal().audioEngine.SetMusicVolume(n)}else if("Sound"==t.node.parent.name){var o=t.progress;this.soundProgressBar.progress=o,r.default.getGlobal().audioEngine.SetSoundVolume(o)}},e.prototype.OnExit=function(){cc.sys.isBrowser&&(cc.sys.isMobile?window.location.href="https://test.xswq361.cn/gobangteach/gobangApp/html/home/index.html":window.location.href="https://test.xswq361.cn")},__decorate([c(cc.Slider)],e.prototype,"musicSlider",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"musicProgressBar",void 0),__decorate([c(cc.Slider)],e.prototype,"soundSlider",void 0),__decorate([c(cc.ProgressBar)],e.prototype,"soundProgressBar",void 0),__decorate([c(cc.Button)],e.prototype,"closeButton",void 0),__decorate([c(cc.Button)],e.prototype,"closeGameButton",void 0),e=__decorate([a,l("Game/UI/Page/SetPage")],e)}(i.default);n.default=u,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","./BasePage":"BasePage"}],ShopPage:[function(e,t,n){"use strict";cc._RF.push(t,"3742aYIa41IFKNnx+NIeuQf","ShopPage"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./BasePage"),r=e("../../GameGlobal"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.closeButton=null,e}return __extends(e,t),e.prototype.start=function(){var e=this;this.closeButton.node.on("click",function(){r.default.getGlobal().audioEngine.PlayReturnButtonSound(),e.PageOut()},this),this.RegisterPrompt()},__decorate([a(cc.Button)],e.prototype,"closeButton",void 0),e=__decorate([s,c("Game/UI/Page/ShopPage")],e)}(o.default);n.default=l,cc._RF.pop()},{"../../GameGlobal":"GameGlobal","./BasePage":"BasePage"}],SkillButton:[function(e,t,n){"use strict";cc._RF.push(t,"e921e8nNYNFgZ9n6vxvSTlI","SkillButton"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Net/ProtoBuf/Msg"),r=e("../../GameGlobal"),i=e("../../Common/CommonDef"),s=cc._decorator,a=s.ccclass,c=s.property,l=s.menu,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillName=null,e.skillIcon=null,e.skillGold=null,e.skillType=o.protocol.ItemType.ITEM_TYPE_INVALID,e.buyButton=null,e.selectIcon=null,e.gold=0,e.itemConfig=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.itemConfig=r.default.getGlobal().resourceMgr.getItemCfg(),this.buyButton.node.on("click",this.BuyButtonOnClick,this)},e.prototype.onEnable=function(){this.SetBuyButton()},e.prototype.onDisable=function(){this.selectIcon.node.active=!1,this.buyButton.node.active=!1},e.prototype.BuyButtonOnClick=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return r.default.getGlobal().audioEngine.PlayButtonSound(),r.default.getGlobal().localPlayer.info.golds<this.gold?((t=new cc.Event.EventCustom(i.OnPromptKey,!1)).setUserData(i.PromptType.GoldInsufficient),this.node.dispatchEvent(t),[3,3]):[3,1];case 1:return[4,r.default.getGlobal().localPlayer.buyItem(this.skillType)];case 2:e.sent(),this.selectIcon.node.active=!1,this.buyButton.node.active=!1,this.SetBuyButton(),e.label=3;case 3:return[2]}})})},e.prototype.SetBuyButton=function(){switch(this.skillType){case o.protocol.ItemType.ITEM_TYPE_STEP:this.gold=this.itemConfig.item_step_cost,r.default.getGlobal().localPlayer.hasStepItem()?this.selectIcon.node.active=!0:this.buyButton.node.active=!0;break;case o.protocol.ItemType.ITEM_TYPE_TIME:this.gold=this.itemConfig.item_time_cost,r.default.getGlobal().localPlayer.hasTimeItem()?this.selectIcon.node.active=!0:this.buyButton.node.active=!0}this.skillGold.string=this.gold.toString()},__decorate([c(cc.Label)],e.prototype,"skillName",void 0),__decorate([c(cc.Sprite)],e.prototype,"skillIcon",void 0),__decorate([c(cc.Label)],e.prototype,"skillGold",void 0),__decorate([c({type:cc.Enum(o.protocol.ItemType)})],e.prototype,"skillType",void 0),__decorate([c(cc.Button)],e.prototype,"buyButton",void 0),__decorate([c(cc.Sprite)],e.prototype,"selectIcon",void 0),e=__decorate([a,l("Game/UI/Button/SkillButton")],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal","../../Net/ProtoBuf/Msg":"Msg"}],UIBoardCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"98f50SLU7BJb5xNlluZcyJ/","UIBoardCtrl"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UIBoard"),r=e("../../Common/CommonDef"),i=cc._decorator,s=i.ccclass,a=i.property,c=i.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mark=null,e.invalidMark=null,e.dragThreshold=4,e.interactable=!0,e.eventDropChess=new Array,e.eventTouching=new Array,e.eventTouch=new Array,e.mUIBoard=null,e.mDownPoint=null,e.mDraging=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchDown,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchLeave,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchUp,this),this.mUIBoard=this.getComponent(o.default),this.mark.node.setLocalZOrder(r.BorderLayer.MARK_LEAYER),this.mark.enabled=!1,this.invalidMark.node.setLocalZOrder(r.BorderLayer.MARK_LEAYER),this.invalidMark.enabled=!1},e.prototype.start=function(){},e.prototype.onDestroy=function(){this.node.targetOff(this)},e.prototype.showMark=function(e,t){cc.pSameAs(e,r.INVALID_INDEX)?this.hideMark():t?(this.invalidMark.enabled=!1,this.mark.enabled=!0,this.mark.node.position=this.mUIBoard.getPosition(e)):(this.mark.enabled=!1,this.invalidMark.enabled=!0,this.invalidMark.node.position=this.mUIBoard.getPosition(e))},e.prototype.hideMark=function(){this.mark.enabled=!1,this.invalidMark.enabled=!1},e.prototype.onTouchDown=function(e){if(e.stopPropagation(),this.interactable){this.mDownPoint=e.getLocation();var t=this.mUIBoard.getNearestIndex(this.node.convertToNodeSpaceAR(e.getLocation()));0<this.eventTouch.length&&this.eventTouch.forEach(function(e){return e.emit([t])})}},e.prototype.onTouchMove=function(e){if(e.stopPropagation(),this.interactable&&(cc.pDistanceSQ(this.mDownPoint,e.getLocation())>this.dragThreshold*this.dragThreshold&&(this.mDraging=!0),this.mDraging)){var t=this.mUIBoard.getNearestIndex(this.node.convertToNodeSpaceAR(e.getLocation()));0<this.eventTouching.length&&this.eventTouching.forEach(function(e){return e.emit([t])})}},e.prototype.onTouchLeave=function(e){e.stopPropagation(),this.interactable&&(this.mDraging=!1)},e.prototype.onTouchUp=function(e){if(this.interactable){e.stopPropagation(),this.mDraging=!1;var t=this.mUIBoard.getNearestIndex(this.node.convertToNodeSpaceAR(e.getLocation()));0<this.eventDropChess.length&&this.eventDropChess.forEach(function(e){return e.emit([t])})}},__decorate([a(cc.Sprite)],e.prototype,"mark",void 0),__decorate([a(cc.Sprite)],e.prototype,"invalidMark",void 0),__decorate([a({range:[.1,5]})],e.prototype,"dragThreshold",void 0),__decorate([a],e.prototype,"interactable",void 0),__decorate([a({type:[cc.Component.EventHandler]})],e.prototype,"eventDropChess",void 0),__decorate([a({type:[cc.Component.EventHandler]})],e.prototype,"eventTouching",void 0),__decorate([a({type:[cc.Component.EventHandler]})],e.prototype,"eventTouch",void 0),e=__decorate([s,c("Game/UI/Chess/UIBoardCtrl")],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","./UIBoard":"UIBoard"}],UIBoard:[function(e,t,n){"use strict";cc._RF.push(t,"bd58aog6GlEHJ4nbVJ4aFHP","UIBoard"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mColumn=0,e.mRow=0,e.mPerX=0,e.mPerY=0,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.onDestroy=function(){},e.prototype.init=function(e,t){this.mColumn=e,this.mRow=t,this.mPerX=this.node.width/(this.mColumn-1),this.mPerY=this.node.height/(this.mRow-1)},e.prototype.getPosition=function(e){if(!(0<=e.x&&e.x<this.mColumn&&0<=e.y&&e.y<this.mRow))throw new Error("[UIBoard.getPosition] invalid index "+e.x+" - "+e.y+".");return cc.v2(e.x*this.mPerX,e.y*this.mPerY)},e.prototype.getNearestIndex=function(e){var t=cc.v2(o.INVALID_INDEX);return e.x<0||e.x>this.node.width||e.y<0||e.y>this.node.height||(t.x=Math.floor(e.x/this.mPerX),Math.abs(e.x-(t.x+1)*this.mPerX)<Math.abs(e.x-t.x*this.mPerX)&&t.x+1<this.mColumn&&(t.x+=1),t.y=Math.floor(e.y/this.mPerY),Math.abs(e.y-(t.y+1)*this.mPerY)<Math.abs(e.y-t.y*this.mPerY)&&t.y+1<this.mRow&&(t.y+=1)),t},e=__decorate([i,s("Game/UI/Chess/UIBoard")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],UICheckOut:[function(e,t,n){"use strict";cc._RF.push(t,"f67a2jckxNE5ozGBroeMYfR","UICheckOut"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../GameGlobal"),o=cc._decorator,i=o.ccclass,s=o.property,a=o.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activeStar=null,e.inActiveStar=null,e.stars=new Array,e.loseReason=null,e.reasons=new Array,e.winNextButton=null,e.winReturnButton=null,e.starsAnima=null,e.loseReason1111=null,e.winNode=null,e.loseNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.showLose=function(e){this.winNode.active=!1,this.loseNode.active=!0,this.loseReason.spriteFrame=this.reasons[e],r.default.getGlobal().audioEngine.PlayLoseSound()},e.prototype.showWin=function(e,t){t?(this.winNextButton.node.active=!1,this.winReturnButton.node.active=!0):(this.winNextButton.node.active=!0,this.winReturnButton.node.active=!1),this.winNode.active=!0,this.loseNode.active=!1;for(var n=0;n<this.stars.length;n++){var o=this.stars[n];o.spriteFrame=n<e?this.activeStar:this.inActiveStar}r.default.getGlobal().audioEngine.PlayWinSound(),this.starsAnima&&this.starsAnima.play()},__decorate([s(cc.SpriteFrame)],e.prototype,"activeStar",void 0),__decorate([s(cc.SpriteFrame)],e.prototype,"inActiveStar",void 0),__decorate([s({type:[cc.Sprite]})],e.prototype,"stars",void 0),__decorate([s(cc.Sprite)],e.prototype,"loseReason",void 0),__decorate([s({type:[cc.SpriteFrame]})],e.prototype,"reasons",void 0),__decorate([s(cc.Button)],e.prototype,"winNextButton",void 0),__decorate([s(cc.Button)],e.prototype,"winReturnButton",void 0),__decorate([s(cc.Animation)],e.prototype,"starsAnima",void 0),__decorate([s(cc.Sprite)],e.prototype,"loseReason1111",void 0),__decorate([s(cc.Node)],e.prototype,"winNode",void 0),__decorate([s(cc.Node)],e.prototype,"loseNode",void 0),e=__decorate([i,a("Game/UI/Chess/UICheckOut")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../GameGlobal":"GameGlobal"}],UICountChess:[function(e,t,n){"use strict";cc._RF.push(t,"98b84GeedlKmo66AVx7qEim","UICountChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../GameGlobal"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.leftName=null,e.leftIcon=null,e.leftFlag=null,e.leftScore=null,e.rightName=null,e.rightIcon=null,e.rightFlag=null,e.rightScore=null,e.whileNotice=null,e.blackNotice=null,e.resultValue=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.leftName.string="天线宝宝",this.rightName.string=o.default.getGlobal().localPlayer.info.name},e.prototype.start=function(){},e.prototype.initCountChessInfo=function(e){var t=JSON.parse(e);if(console.log("responseText",t),0==t.error.returnCode&&null!=t.data&&null!=t.data.blackList&&null!=t.data.whiteList){this.leftScore.string=t.data.whiteList.length,this.rightScore.string=t.data.blackList.length;var n=t.data.blackList.length-t.data.whiteList.length-3.75;0<n?(this.rightFlag.active=!0,this.leftFlag.active=!1,this.blackNotice.active=!0,this.whileNotice.active=!1):(this.rightFlag.active=!1,this.leftFlag.active=!0,this.whileNotice.active=!0,this.blackNotice.active=!1),this.resultValue.string=Math.abs(n).toString();var r="http://wx.qlogo.cn/mmopen/Po9mkm3Z42tolYpxUVpY6mvCmqalibOpcJ2jG3Qza5qgtibO1NLFNUF7icwCibxPicbGmkoiciaqKEIdvvveIBfEQqal8vkiavHIeqFT/0.jpg";cc.loader.load({url:r,type:"jpg"},function(n,o){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return n?console.log("图片下载失败",r,n):(this.rightIcon.spriteFrame.setTexture(o),(t=this.rightIcon.spriteFrame.getRect()).width=72,t.height=72,this.rightIcon.spriteFrame.setRect(t)),[2]})})}.bind(this))}},__decorate([s(cc.Label)],e.prototype,"leftName",void 0),__decorate([s(cc.Sprite)],e.prototype,"leftIcon",void 0),__decorate([s(cc.Node)],e.prototype,"leftFlag",void 0),__decorate([s(cc.Label)],e.prototype,"leftScore",void 0),__decorate([s(cc.Label)],e.prototype,"rightName",void 0),__decorate([s(cc.Sprite)],e.prototype,"rightIcon",void 0),__decorate([s(cc.Node)],e.prototype,"rightFlag",void 0),__decorate([s(cc.Label)],e.prototype,"rightScore",void 0),__decorate([s(cc.Node)],e.prototype,"whileNotice",void 0),__decorate([s(cc.Node)],e.prototype,"blackNotice",void 0),__decorate([s(cc.Label)],e.prototype,"resultValue",void 0),e=__decorate([i,a("Game/UI/Chess/UICountChess")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../GameGlobal":"GameGlobal"}],UILogin:[function(e,t,n){"use strict";cc._RF.push(t,"69610uTXiVL/Il/+5UeKGSs","UILogin"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../GameGlobal"),r=e("../../Common/CommonDef"),i=cc._decorator,s=i.ccclass,a=(i.property,i.menu),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){this.connectAndLoad().catch(function(e){cc.error("[UILogin.start]",e.message)})},t.prototype.connectAndLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o.default.getGlobal().netWork.connectTo()];case 1:return e.sent(),[4,o.default.getGlobal().localPlayer.login(16444131)];case 2:return e.sent(),cc.sys.localStorage.getItem(r.IsGuideKey),r.LoadingScene(r.ChessSceneKey),[2]}})})},t=__decorate([s,a("Game/UI/Login/UILogin")],t)}(cc.Component);n.default=c,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef","../../GameGlobal":"GameGlobal"}],UIPreviewChapter:[function(e,t,n){"use strict";cc._RF.push(t,"86b34Fu6CVIoJ7OFS00W/+d","UIPreviewChapter"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handle=new Array,e.mChapterName=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"chapter",{get:function(){return this.mChapter},set:function(e){this.mChapter=e,this.refreshName()},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mChapterName=this.getComponentInChildren(cc.Label),this.refreshName(),this.node.on("click",this.callback,this)},e.prototype.start=function(){},e.prototype.refreshName=function(){this.mChapterName&&(this.mChapterName.string="chapter: "+this.mChapter)},e.prototype.callback=function(e){var t=this;0<this.handle.length&&this.handle.forEach(function(e){e.emit([t.mChapter])})},__decorate([i({type:[cc.Component.EventHandler]})],e.prototype,"handle",void 0),e=__decorate([r,s("Game/UI/Chess/UIPreviewChapter")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],UIPreviewMission:[function(e,t,n){"use strict";cc._RF.push(t,"34146qzrb1Fs7ngciEkhU77","UIPreviewMission"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=o.property,s=o.menu,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handle=new Array,e.mMissionName=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"mission",{get:function(){return this.mMission},set:function(e){this.mMission=e,this.refreshName()},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mMissionName=this.getComponentInChildren(cc.Label),this.refreshName(),this.node.on("click",this.callback,this)},e.prototype.start=function(){},e.prototype.refreshName=function(){this.mMissionName&&(this.mMissionName.string="mission: "+this.mMission)},e.prototype.callback=function(e){var t=this;0<this.handle.length&&this.handle.forEach(function(e){e.emit([t.mMission])})},__decorate([i({type:[cc.Component.EventHandler]})],e.prototype,"handle",void 0),e=__decorate([r,s("Game/UI/Chess/UIPreviewMission")],e)}(cc.Component);n.default=a,cc._RF.pop()},{}],Unit:[function(e,t,n){"use strict";cc._RF.push(t,"9bcaftw68pBuZ4RZKNSNS8s","Unit"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../Common/CommonDef"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.uType=o.UnitType.UNIT_TYPE_WHITE,e.uState=o.UnitState.UNIT_STATE_INVALID,e.mIndex=cc.v2(o.INVALID_INDEX),e}return __extends(e,t),Object.defineProperty(e.prototype,"index",{get:function(){if(this.uState!=o.UnitState.UNIT_STATE_ON_BOARD)throw new Error("[Unit.index] invalid unit state "+this.uState+".");return this.mIndex},enumerable:!0,configurable:!0}),e.prototype.getIndex=function(){return this.mIndex},Object.defineProperty(e.prototype,"data",{get:function(){var e=null;return this.uType==o.UnitType.UNIT_TYPE_WHITE?e="W":this.uType!=o.UnitType.UNIT_TYPE_BLACK&&this.uType!=o.UnitType.UNIT_TYPE_BLOCK||(e="B"),e=e+"["+String.fromCharCode(this.mIndex.x+97)+String.fromCharCode(this.mIndex.y+97)+"]"},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.setup()},e.prototype.start=function(){},e.prototype.reuse=function(){this.setup(),this.node.emit(o.UnitEvent.ON_REUSE)},e.prototype.unuse=function(){this.cleanup(),this.node.emit(o.UnitEvent.ON_UNUSE)},e.prototype.setup=function(){this.mIndex=cc.v2(o.INVALID_INDEX),this.uState=o.UnitState.UNIT_STATE_INVALID,this.node.setLocalZOrder(o.BorderLayer.CHESS_LEAYER),this.node.on(o.UnitEvent.ON_PUT_IN,this.onPutInChessPoint,this),this.node.on(o.UnitEvent.ON_TAKE_OUT,this.onTakeOutChessPoint,this)},e.prototype.cleanup=function(){this.uState=o.UnitState.UNIT_STATE_INVALID,this.unscheduleAllCallbacks(),this.node.targetOff(this)},e.prototype.onPutInChessPoint=function(e){var t=e.detail.point;this.uState=o.UnitState.UNIT_STATE_ON_BOARD,this.mIndex=cc.v2(t.index),this.node.setLocalZOrder(o.BorderLayer.CHESS_LEAYER_MAX-this.mIndex.y)},e.prototype.onTakeOutChessPoint=function(){this.uState=o.UnitState.UNIT_STATE_OFF_BOARD,this.mIndex=cc.v2(o.INVALID_INDEX)},__decorate([s({type:cc.Enum(o.UnitType)})],e.prototype,"uType",void 0),__decorate([s({type:cc.Enum(o.UnitState)})],e.prototype,"uState",void 0),e=__decorate([i,a("Game/GameLogic/Chess/Unit")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../Common/CommonDef":"CommonDef"}],UnlockButton:[function(e,t,n){"use strict";cc._RF.push(t,"e9048laR4NGQ7K3BNmAZqF4","UnlockButton"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,r=o.ccclass,i=(o.property,o.menu),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spAnimation=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.spAnimation=this.node.getComponent(sp.Skeleton)},e.prototype.start=function(){this.node.active=!1},e.prototype.PlayUnlock=function(){this.node.active||(this.node.active=!0);var e="animation";return this.spAnimation.setAnimation(0,e,!1),this.spAnimation.findAnimation(e).duration},e=__decorate([r,i("Game/UI/Button/UnlockButton")],e)}(cc.Component);n.default=s,cc._RF.pop()},{}],WSConnection:[function(e,t,n){"use strict";cc._RF.push(t,"ae07ealY29Fm5NEGk5iJqbQ","WSConnection"),Object.defineProperty(n,"__esModule",{value:!0});var o,r,i=e("./ProtoBufferCoder/ProtoBufCoder"),s=e("../GameGlobal"),a=e("../Common/CommonDef"),c=cc._decorator,l=c.ccclass,u=c.property,h=c.menu;(r=o=n.ConnectEvent||(n.ConnectEvent={})).CONNECTED="CONNECTED",r.MESSAGE="MESSAGE",r.CONNECT_TIMEOUT="CONNECT_TIMEOUT",r.CONNECTION_ERROR="CONNECTION_ERROR",r.CONNECTION_CLOSED="CONNECTION_CLOSED",r.CONNECTION_UNSTABLE="CONNECTION_UNSTABLE",r.CONNEECTION_GONEAWARY="CONNEECTION_GONEAWARY",r.CONNECTION_RESET="CONNECTION_RESET",r.REQUEST_BLOCK="REQUEST_BLOCK",r.RESPONSE_UNBLOCK="RESPONSE_UNBLOCK",r.CUSTOM_ERROR="CUSTOM_ERROR";var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.connName="Game",e.address="127.0.0.1:7777",e.connectTimeoutSecs=30,e.heartBeatIntervalSecs=1,e.timeOutSecs=10,e.unstableSecs=5,e.checkIntervalSecs=.5,e.autoResetConnection=!0,e.keepAlive=!0,e.mSocket=null,e.mClean=!1,e.mNetWorkNode=null,e.mRTT=n.MAX_RTT,e.mLastSendTime=0,e.mLastRecvTime=0,e.needEmitUnstable=!0,e.needEmitGoneAway=!0,e}return __extends(e,t),n=e,Object.defineProperty(e.prototype,"state",{get:function(){return cc.sys.now,this.mSocket?this.mSocket.readyState:n.INITIALED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rtt",{get:function(){return this.isConnected?this.mRTT:n.MAX_RTT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.state==n.OPEN},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mNetWorkNode=this.node.parent,this.address=a.WEB_SOCKET_IP},e.prototype.onDestroy=function(){this.cleanUp()},e.prototype.setConfig=function(e){this.connName=e.connName,this.address=e.address,this.connectTimeoutSecs=e.connectTimeoutSecs,this.heartBeatIntervalSecs=e.heartBeatIntervalSecs,this.timeOutSecs=e.timeOutSecs,this.unstableSecs=e.unstableSecs,this.autoResetConnection=e.autoResetConnection,this.keepAlive=e.keepAlive,this.checkIntervalSecs=e.checkIntervalSecs},e.prototype.connectTo=function(){if(!this.address)throw new Error("[WSConnection.connectTo] address undefine.");if(this.address.trim(),0==this.address.length)throw new Error("[WSConnection.connectTo] addres invalid.");if(this.state!==n.INITIALED)throw new Error("[WSConnection.connectTo] connect to "+this.address+" error. current state "+this.state+".");this.connect(n.protocolPrefix.concat(this.address))},e.prototype.send=function(e,t){if(void 0===t&&(t=!0),!this.isConnected)throw new Error("[WSConnection.send] cann't send message now current state "+this.state+".");if(!e)throw new Error("[WSConnection.send] argument error , data are empty.");cc.sys.platform==cc.sys.WECHAT_GAME?this.mSocket.send(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)):this.mSocket.send(e),t&&(this.mLastSendTime=s.default.getGlobal().gameInfo.elapsedTime)},e.prototype.close=function(){this.cleanUp()},e.prototype.onHeartBeat=function(e){this.mLastRecvTime=s.default.getGlobal().gameInfo.elapsedTime},e.prototype.connect=function(e){var t=this;if(e.trim(),!e||0==e.length)throw new Error("[WSConnection._connect] url empty or null.");cc.log("connecting ",e,"...."),this.scheduleOnce(this.checkConnectTimeout,this.connectTimeoutSecs),this.mSocket=new WebSocket(e),this.mSocket.binaryType="arraybuffer",this.mSocket.onopen=function(e){t.onOpen(e)},this.mSocket.onclose=function(e){t.onClose(e)},this.mSocket.onerror=function(e){t.onError(e)},this.mSocket.onmessage=function(e){t.onMessage(e)}},e.prototype.onOpen=function(e){cc.log("[NetWork.onOpen] connect ",this.address," success.");var t={connName:this.connName,eType:o.CONNECTED,reason:o.CONNECTED};this.mNetWorkNode.emit(t.eType,t),this.schedule(this.watchDog,this.checkIntervalSecs)},e.prototype.onClose=function(e){cc.log("[WSConnection.onClose] websocket close ",e.reason," code ",e.code),this.cleanUp();var t={connName:this.connName,eType:o.CONNECTION_CLOSED,reason:e.reason};this.mNetWorkNode.emit(t.eType,t)},e.prototype.onError=function(e){cc.log("[WSConnection.onError]  websocket error cause by ",e.type),this.cleanUp();var t={connName:this.connName,eType:o.CONNECTION_ERROR,reason:"[WSConnection.onError]  websocket error cause by "+e.type};this.mNetWorkNode.emit(t.eType,t)},e.prototype.onMessage=function(e){var t={connName:this.connName,eType:o.MESSAGE,data:new Uint8Array(e.data)};this.mNetWorkNode.emit(t.eType,t),this.lastRequestRcved()||(this.mLastRecvTime=s.default.getGlobal().gameInfo.elapsedTime)},e.prototype.cleanUp=function(){this.mClean||(cc.log("[WSConnection.cleanUp] clean up websocket current state ",this.state,"."),this.unscheduleAllCallbacks(),this.state!=n.OPEN&&this.state!=n.CONNECTING||(cc.log("[WSConnection.cleanUp] close websocket actively , current socket state ",this.state,"."),this.mSocket.close()),this.mSocket&&(this.mSocket.onopen=function(){},this.mSocket.onclose=function(){},this.mSocket.onerror=function(){},this.mSocket.onmessage=function(){}),this.mClean=!0)},e.prototype.checkConnectTimeout=function(){if(this.mSocket.readyState!=n.OPEN){cc.log("connect ",this.address," time out.",this.mSocket.readyState),this.cleanUp();var e={connName:this.connName,eType:o.CONNECT_TIMEOUT,reason:o.CONNECT_TIMEOUT};this.mNetWorkNode.emit(e.eType,e)}},e.prototype.lastRequestRcved=function(){return 0<=this.mLastRecvTime-this.mLastSendTime},e.prototype.watchDog=function(){if(this.isConnected&&this.keepAlive){var e=s.default.getGlobal().gameInfo.elapsedTime;if(this.lastRequestRcved())this.mRTT=this.mLastRecvTime-this.mLastSendTime,e-this.mLastSendTime>1e3*this.heartBeatIntervalSecs&&(this.mLastSendTime=e,this.send(i.Coder.buildHead(i.MsgType.HEARTBEAT,e).serialize())),this.needEmitUnstable=!0,this.needEmitGoneAway=!0;else{if(e-this.mLastSendTime>1e3*this.unstableSecs&&this.needEmitUnstable){var t={connName:this.connName,eType:o.CONNECTION_UNSTABLE,reason:o.CONNECTION_UNSTABLE};this.mNetWorkNode.emit(t.eType,t),cc.log("[WSConnection.watchDog] net unstable."),this.needEmitUnstable=!1}if(e-this.mLastSendTime>1e3*this.timeOutSecs&&this.needEmitGoneAway){t={connName:this.connName,eType:o.CONNEECTION_GONEAWARY,reason:o.CONNEECTION_GONEAWARY};this.mNetWorkNode.emit(t.eType,t),cc.log("[WSConnection.watchDog] net gone away."),this.needEmitGoneAway=!1}this.mRTT=e-this.mLastSendTime}}},e.protocolPrefix="wss://",e.INITIALED=-1,e.CONNECTING=0,e.OPEN=1,e.CLOSING=2,e.CLOSED=3,e.CLOSE_CODE_CONNECT_TIMEOUT=4001,e.MAX_RTT=9999,__decorate([u],e.prototype,"connName",void 0),__decorate([u],e.prototype,"address",void 0),__decorate([u],e.prototype,"connectTimeoutSecs",void 0),__decorate([u],e.prototype,"heartBeatIntervalSecs",void 0),__decorate([u({tooltip:"emit CONNEECTION_GOAWARY event when request or heart beat are not response."})],e.prototype,"timeOutSecs",void 0),__decorate([u({tooltip:"emit CONNECTION_UNSTABLE event when request or heart beat are not response."})],e.prototype,"unstableSecs",void 0),__decorate([u({range:[0,.5]})],e.prototype,"checkIntervalSecs",void 0),__decorate([u({tooltip:"auto reset connection when something wrong."})],e.prototype,"autoResetConnection",void 0),__decorate([u],e.prototype,"keepAlive",void 0),e=n=__decorate([l,h("Game/Net/WSConnection")],e);var n}(cc.Component);n.default=p,cc._RF.pop()},{"../Common/CommonDef":"CommonDef","../GameGlobal":"GameGlobal","./ProtoBufferCoder/ProtoBufCoder":"ProtoBufCoder"}],WhiteChess:[function(e,t,n){"use strict";cc._RF.push(t,"b3244ECQBlGgrUOsdFb41da","WhiteChess"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Unit"),l=e("../../GameGlobal"),r=cc._decorator,i=r.ccclass,s=r.property,a=r.menu,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offset=70,e.mUnit=null,e.mAnima=null,e.mWhiteSplitMove=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this.mUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.mUnit=this.getComponent(o.default),this.mAnima=this.getComponent(cc.Animation),this.mWhiteSplitMove=cc.find("SplitSprite",this.node)},e.prototype.splitTo=function(s){var a,c=this,e=new Promise(function(e,t){a=e,t}),t=this.mAnima.playAdditive("Chess");return t.wrapMode=cc.WrapMode.Normal,t.repeatCount=1,this.mAnima.once("finished",function(){c.mWhiteSplitMove.active=!0,c.mWhiteSplitMove.position=cc.Vec2.ZERO;var e=cc.pSub(s,c.unit.index),t=cc.v2(e.x*c.offset,e.y*c.offset),n=cc.fadeTo(.5,255),o=cc.moveTo(.5,t),r=cc.callFunc(function(){c.mWhiteSplitMove.active=!1,a(l.default.getGlobal().resourceMgr.getWhiteChess())}),i=cc.sequence(cc.spawn(n,o),r);c.mWhiteSplitMove.runAction(i)}),e},__decorate([s],e.prototype,"offset",void 0),e=__decorate([i,a("Game/GameLogic/Chess/WhiteChess")],e)}(cc.Component);n.default=c,cc._RF.pop()},{"../../GameGlobal":"GameGlobal","./Unit":"Unit"}],XiaoTian:[function(e,t,n){"use strict";cc._RF.push(t,"0af60t1J5dINqgWPnWF3lhZ","XiaoTian"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../GameGlobal"),r=cc._decorator,i=r.ccclass,s=(r.property,r.menu),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spAnimation=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.spAnimation=this.node.getComponent(sp.Skeleton),this.node.active=!1},e.prototype.PlayIdle=function(){this.node.active||(this.node.active=!0);var e="animation";return this.spAnimation.setAnimation(0,e,!0),this.spAnimation.findAnimation(e).duration},e.prototype.PlayOut=function(){this.node.active||(this.node.active=!0),o.default.getGlobal().audioEngine.PlayDeliveryUpSound();var e="chuansong";return this.spAnimation.setAnimation(0,e,!1),this.spAnimation.findAnimation(e).duration},e.prototype.PlayEnter=function(){this.node.active||(this.node.active=!0),o.default.getGlobal().audioEngine.PlayDeliveryDownSound();var e="chuansong2";return this.spAnimation.setAnimation(0,e,!1),this.spAnimation.findAnimation(e).duration},e=__decorate([i,s("Game/UI/Role/XiaoTian")],e)}(cc.Component);n.default=a,cc._RF.pop()},{"../../GameGlobal":"GameGlobal"}],"es6-promise.auto":[function(W,n,o){(function(F,H){"use strict";cc._RF.push(n,"188c4db8vxOsZufxV/rdy3e","es6-promise.auto");var e,t,j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t=function(){function l(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,t=void 0,r=void 0,a=function(e,t){p[o]=e,p[o+1]=t,2===(o+=2)&&(r?r(d):C())};var e="undefined"!=typeof window?window:void 0,i=e||{},s=i.MutationObserver||i.WebKitMutationObserver,c="undefined"==typeof self&&void 0!==F&&"[object process]"==={}.toString.call(F),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(d,1)}}var p=new Array(1e3);function d(){for(var e=0;e<o;e+=2){(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0}o=0}var m,f,y,g,C=void 0;function _(e,t){var n=this,o=new this.constructor(P);void 0===o[I]&&R(o);var r=n._state;if(r){var i=arguments[r-1];a(function(){return L(r,o,i,n._result)})}else A(n,o,e,t);return o}function v(e){if(e&&"object"===(void 0===e?"undefined":j(e))&&e.constructor===this)return e;var t=new this(P);return D(t,e),t}c?C=function(){return F.nextTick(d)}:s?(f=0,y=new s(d),g=document.createTextNode(""),y.observe(g,{characterData:!0}),C=function(){g.data=f=++f%2}):u?((m=new MessageChannel).port1.onmessage=d,C=function(){return m.port2.postMessage(0)}):C=void 0===e&&"function"==typeof W?function(){try{var e=Function("return this")().require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(d)}:h()}catch(e){return h()}}():h();var I=Math.random().toString(36).substring(2);function P(){}var b=void 0,S=1,T=2,O={error:null};function E(e){try{return e.then}catch(e){return O.error=e,O}}function w(e,t,n){var o,r,i,s;t.constructor===e.constructor&&n===_&&t.constructor.resolve===v?(i=e,(s=t)._state===S?U(i,s._result):s._state===T?B(i,s._result):A(s,void 0,function(e){return D(i,e)},function(e){return B(i,e)})):n===O?(B(e,O.error),O.error=null):void 0===n?U(e,t):l(n)?(o=t,r=n,a(function(t){var n=!1,e=function(e,t,n,o){try{e.call(t,n,o)}catch(e){return e}}(r,o,function(e){n||(n=!0,o!==e?D(t,e):U(t,e))},function(e){n||(n=!0,B(t,e))},t._label);!n&&e&&(n=!0,B(t,e))},e)):U(e,t)}function D(e,t){var n,o;e===t?B(e,new TypeError("You cannot resolve a promise with itself")):(o=void 0===(n=t)?"undefined":j(n),null===n||"object"!==o&&"function"!==o?U(e,t):w(e,t,E(t)))}function N(e){e._onerror&&e._onerror(e._result),M(e)}function U(e,t){e._state===b&&(e._result=t,e._state=S,0!==e._subscribers.length&&a(M,e))}function B(e,t){e._state===b&&(e._state=T,e._result=t,a(N,e))}function A(e,t,n,o){var r=e._subscribers,i=r.length;e._onerror=null,r[i]=t,r[i+S]=n,r[i+T]=o,0===i&&e._state&&a(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o=void 0,r=void 0,i=e._result,s=0;s<t.length;s+=3)o=t[s],r=t[s+n],o?L(n,o,r,i):r(i);e._subscribers.length=0}}function L(e,t,n,o){var r=l(n),i=void 0,s=void 0,a=void 0,c=void 0;if(r){if((i=function(e,t){try{return e(t)}catch(e){return O.error=e,O}}(n,o))===O?(c=!0,s=i.error,i.error=null):a=!0,t===i)return void B(t,new TypeError("A promises callback cannot return that same promise."))}else i=o,a=!0;t._state!==b||(r&&a?D(t,i):c?B(t,s):e===S?U(t,i):e===T&&B(t,i))}var G=0;function R(e){e[I]=G++,e._state=void 0,e._result=void 0,e._subscribers=[]}var k=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(P),this.promise[I]||R(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?U(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&U(this.promise,this._result))):B(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===b&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,o=n.resolve;if(o===v){var r=E(t);if(r===_&&t._state!==b)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===x){var i=new n(P);w(i,t,r),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(o(t),e)},e.prototype._settledAt=function(e,t,n){var o=this.promise;o._state===b&&(this._remaining--,e===T?B(o,n):this._result[t]=n),0===this._remaining&&U(o,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;A(e,void 0,function(e){return n._settledAt(S,t,e)},function(e){return n._settledAt(T,t,e)})},e}();var x=function(){function t(e){this[I]=G++,this._result=this._state=void 0,this._subscribers=[],P!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){D(t,e)},function(e){B(t,e)})}catch(e){B(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})},t}();return x.prototype.then=_,x.all=function(e){return new k(this,e).promise},x.race=function(r){var i=this;return n(r)?new i(function(e,t){for(var n=r.length,o=0;o<n;o++)i.resolve(r[o]).then(e,t)}):new i(function(e,t){return t(new TypeError("You must pass an array to race."))})},x.resolve=v,x.reject=function(e){var t=new this(P);return B(t,e),t},x._setScheduler=function(e){r=e},x._setAsap=function(e){a=e},x._asap=a,x.polyfill=function(){var e=void 0;if(void 0!==H)e=H;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=x},(x.Promise=x).polyfill(),x},"object"===((e=void 0)===o?"undefined":j(o))&&void 0!==n?n.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t(),cc._RF.pop()}).call(this,W("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],linkedlist:[function(e,t,n){"use strict";cc._RF.push(t,"84078NFtglGe4Ec+4Ja2VBZ","linkedlist"),Object.defineProperty(n,"__esModule",{value:!0});var s=e("./linkednode"),o=function(){function e(){this.length=0,this.head=null,this.length=0,this.head=null}return e.prototype.append=function(e){var t=new s.Node(e);if(null===this.head)this.head=t;else{for(var n=this.head;n.next;)n=n.next;n.next=t}this.length++},e.prototype.insert=function(e,t){var n=new s.Node(t);if(-1<e&&e<=this.length){var o=this.head,r=void 0,i=0;if(0===e)n.next=o,this.head=n;else{for(;i++<e;)o=(r=o).next;n.next=o,r.next=n}return this.length++,!0}return!1},e.prototype.removeAt=function(e){if(-1<e&&e<this.length){var t=this.head,n=void 0,o=0;if(0===e)this.head=t.next;else{for(;o++<e;)t=(n=t).next;n.next=t.next}return this.length--,t.element}return null},e.prototype.remove=function(e){var t=this.indexOf(e);return this.removeAt(t)},e.prototype.indexOf=function(e){for(var t=this.head,n=0;t;){if(e===t.element)return n;n++,t=t.next}return-1},e.prototype.isEmpty=function(){return 0===this.size()},e.prototype.size=function(){return this.length},e.prototype.getHead=function(){return this.head},e.prototype.toString=function(){for(var e=this.head,t="";e;)t+=e.element+(e.next?"--\x3e":""),e=e.next;return t},e}();n.default=o,cc._RF.pop()},{"./linkednode":"linkednode"}],linkednode:[function(e,t,n){"use strict";cc._RF.push(t,"22c0c8zBwxDU5zJtjq34You","linkednode"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t){void 0===t&&(t=null),this.element=null,this.next=null,this.prevs=null,this.element=e,this.next=t,this.prevs=new Array},r=function(r){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var o=r.call(this,e,t)||this;return o.prev=null,o.prev=n,o}return __extends(e,r),e}(n.Node=o);n.DoublyNode=r,cc._RF.pop()},{}]},{},["Heap","CharSetConv","CommonDef","PathFindingDef","AStarFinder","linkedlist","linkednode","GameGlobal","AimAIPrefer","BesiegeAIPrefer","NearestPrefer","NewestPrefer","PlayChessPrefer","BlackChess","BlockChess","BoardPreset","ChessBoard","ChessElement","ChessPlay","ConfirmAnimation","DestChess","FlagChess","Preview","RandomAnimation","Unit","WhiteChess","LocalPlayer","GameInfo","Localization","AudioEngineManager","HttpConnection","ICoder","NetWork","Msg.d","Msg","ProtoBufCoder","SIOConnection","WSConnection","ResourceMgr","es6-promise.auto","LevelButton","MapButton","SkillButton","UnlockButton","UIBoard","UIBoardCtrl","UICheckOut","UICountChess","UIPreviewChapter","UIPreviewMission","UILogin","LevelMap","LevelStar","AchievementPage","BasePage","FadeOutPage","GuidePage","LevelPage","LoadingPage","MainPage","SetPage","ShopPage","XiaoTian"]);